/* twilio-sync.js 0.7.5
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.
*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Twilio||(t.Twilio={})).Sync=e()}}(function(){var e,t,r;return function(){function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return e}()({1:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=n(i),s=e("babel-runtime/helpers/createClass"),a=n(s);Object.defineProperty(r,"__esModule",{value:!0});var u=e("karibu"),c=function(){function e(t,r){(0,o.default)(this,e),this.value=t,this.revision=r||0}return(0,a.default)(e,[{key:"isValid",get:function(){return!0}}]),e}(),l=function(){function e(t){(0,o.default)(this,e),this.revision=t}return(0,a.default)(e,[{key:"isValid",get:function(){return!1}}]),e}(),f=function(){function e(){(0,o.default)(this,e),this.items=new u.TreeMap}return(0,a.default)(e,[{key:"store",value:function(e,t,r){var n=this.items.get(e);return n&&n.revision>r?n.isValid?n.value:null:(this.items.set(e,new c(t,r)),t)}},{key:"delete",value:function(e,t){var r=this.items.get(e);(!r||r.revision<t)&&this.items.set(e,new l(t))}},{key:"isKnown",value:function(e,t){var r=this.items.get(e);return r&&r.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}}]),e}();r.Cache=f,r.default=f},{"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,karibu:204}],2:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return e._subscribe(),e}function o(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};R.validateOptionalTtl(e.ttl);var t=e.mode||(e.id?"open_or_create":"create_new");return(0,b.default)({},e,{mode:t})}return{mode:"create_new"}}var s=e("babel-runtime/regenerator"),a=n(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=n(u),l=e("babel-runtime/helpers/classCallCheck"),f=n(l),h=e("babel-runtime/helpers/createClass"),p=n(h),d=e("babel-runtime/helpers/possibleConstructorReturn"),_=n(d),v=e("babel-runtime/helpers/inherits"),m=n(v),y=e("babel-runtime/helpers/extends"),b=n(y),g=e("babel-runtime/core-js/promise"),k=n(g),w=function(e,t,r,n){return new(r||(r=k.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var x=e("events"),C=e("xxhashjs"),j=e("twilsock"),E=e("twilio-transport"),S=e("twilio-ems-client"),T=e("twilio-notifications"),R=e("./utils"),A=e("./logger"),O=e("./configuration"),I=e("./subscriptions"),P=e("./router"),M=e("./network"),F=e("./syncdocument"),D=e("./synclist"),L=e("./syncmap"),N=e("./clientInfo"),U=e("./entitiesCache"),B=e("./services/storage"),q=e("./utils"),z=e("./utils/deferred"),W=e("./syncerror"),V=e("./streams/syncstream"),H="data_sync",G=e("../package.json").version,Q=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,f.default)(this,t);var n=(0,_.default)(this,(t.__proto__||(0,c.default)(t)).call(this));if(!e)throw new Error("Sync library needs a valid Twilio token to be passed");r.hasOwnProperty("logLevel")&&A.default.setLevel(r.logLevel),n.productId=r.productId=r.productId||H;var i=r.twilsockClient=r.twilsockClient||new j(e,r),o=r.transport=r.transport||new E.Transport(r.twilsockClient,{concurrentHttpRequestLimit:20}),s=r.emsClient=r.emsClient||new S.EmsClient(r),a=r.notificationsClient=r.notificationsClient||new T(e,r),u=new O.Configuration(null,r),l=new M.Network(n.productId,new N.ClientInfo(G),u,o),h=new B.SessionStorage(u);n.localStorageId=null,n.fpaToken=e,n.authData=new z.Deferred,n.authData.promise.then(function(e){return n.handleEmsResponse(e)}),s.once("response",function(e){return n.authData.update(e)}),s.setToken(e).catch(function(e){A.default.warn("Failed to set token",e)}),i.connect(),n.services={config:u,twilsock:i,notifications:a,network:l,emsClient:s,storage:h,router:null,subscriptions:null};var p=new I.Subscriptions(n.services),d=new P.Router({config:u,subscriptions:p,notifications:a});return n.services.router=d,n.services.subscriptions=p,n.entities=new U.EntitiesCache,a.on("connectionStateChanged",function(){n.emit("connectionStateChanged",n.services.notifications.connectionState)}),n}return(0,m.default)(t,e),(0,p.default)(t,[{key:"handleEmsResponse",value:function(e){this.services.config.updateToken(e.token);try{var t=e.identity,r=e.serviceSids[this.productId],n=C.h64().update("TW::"+t+"::"+r).digest().toString(16);this.services.storage.updateStorageId(n)}catch(e){A.default.error("Failed to initialize persistent storage",e)}}},{key:"ensureReady",value:function(){return w(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authData.promise;case 2:case"end":return e.stop()}},e,this)}))}},{key:"storeRootInSessionCache",value:function(e,t,r){if(this.services.config.sessionStorageEnabled&&t){var n=q.deepClone(r);e!==D.SyncList.type&&e!==L.SyncMap.type||(n.last_event_id=null,delete n.items),this.services.storage.store(e,t,n)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return w(this,void 0,void 0,a.default.mark(function n(){var i,o;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return",null);case 2:return i=new R.UriBuilder(e).pathSegment(t).queryParam("Include",r?"items":void 0).build(),n.next=5,this.services.network.get(i);case 5:return o=n.sent,n.abrupt("return",o.body);case 7:case"end":return n.stop()}},n,this)}))}},{key:"_createDocument",value:function(e,t,r){var n={unique_name:e,data:t||{}};return"number"==typeof r&&(n.ttl=r),this.services.network.post(this.services.config.documentsUri,n).then(function(e){return e.body.data=n.data,e.body})}},{key:"_getDocument",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(F.SyncDocument.type,e)||this._get(this.services.config.documentsUri,e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"_createList",value:function(e,t,r,n){var i={unique_name:e,purpose:t,context:r};return"number"==typeof n&&(i.ttl=n),this.services.network.post(this.services.config.listsUri,i).then(function(e){return e.body})}},{key:"_getList",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(D.SyncList.type,e)||this._get(this.services.config.listsUri,e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"_createMap",value:function(e,t){var r={unique_name:e};return"number"==typeof t&&(r.ttl=t),this.services.network.post(this.services.config.mapsUri,r).then(function(e){return e.body})}},{key:"_getMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w(this,void 0,void 0,a.default.mark(function r(){return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.readRootFromSessionCache(L.SyncMap.type,e)||this._get(this.services.config.mapsUri,e,t));case 1:case"end":return r.stop()}},r,this)}))}},{key:"_getStream",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(V.SyncStream.type,e)||this._get(this.services.config.streamsUri,e,!1));case 1:case"end":return t.stop()}},t,this)}))}},{key:"_createStream",value:function(e,t){return w(this,void 0,void 0,a.default.mark(function r(){var n,i,o;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n={unique_name:e},"number"==typeof t&&(n.ttl=t),r.next=4,this.services.network.post(this.services.config.streamsUri,n);case 4:return i=r.sent,o=i.body,r.abrupt("return",o);case 7:case"end":return r.stop()}},r,this)}))}},{key:"getCached",value:function(e,t){return e?this.entities.get(e,t)||null:null}},{key:"removeFromCacheAndSession",value:function(e,t,r){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,r)}},{key:"document",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){var r,n,s,u,c=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(r=o(e),n=void 0,"create_new"!==r.mode){t.next=10;break}return t.next=7,this._createDocument(r.id,r.value,r.ttl);case 7:n=t.sent,t.next=40;break;case 10:if(!(s=this.getCached(r.id,F.SyncDocument.type))){t.next=15;break}return t.abrupt("return",s);case 15:return t.prev=15,t.next=18,this._getDocument(r.id);case 18:n=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t.catch(15),404===t.t0.status&&"open_existing"!==r.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createDocument(r.id,r.value,r.ttl);case 30:n=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t.catch(27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.document(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(F.SyncDocument.type,r.id,n),u=new F.SyncDocument(this.services,n,function(e,t,r){return c.removeFromCacheAndSession(e,t,r)}),u=this.entities.store(u),t.abrupt("return",i(u));case 44:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}))}},{key:"map",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){var r,n,s,u,c=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(r=o(e),n=void 0,"create_new"!==r.mode){t.next=10;break}return t.next=7,this._createMap(r.id,r.ttl);case 7:n=t.sent,t.next=40;break;case 10:if(!(s=this.getCached(r.id,L.SyncMap.type))){t.next=15;break}return t.abrupt("return",s);case 15:return t.prev=15,t.next=18,this._getMap(r.id,r.includeItems);case 18:n=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t.catch(15),404===t.t0.status&&"open_existing"!==r.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createMap(r.id,r.ttl);case 30:n=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t.catch(27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.map(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(L.SyncMap.type,r.id,n),u=new L.SyncMap(this.services,n,function(e,t,r){return c.removeFromCacheAndSession(e,t,r)}),u=this.entities.store(u),t.abrupt("return",i(u));case 44:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}))}},{key:"list",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){var r,n,s,u,c=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(r=o(e),n=void 0,"create_new"!==r.mode){t.next=10;break}return t.next=7,this._createList(r.id,r.purpose,r.context,r.ttl);case 7:n=t.sent,t.next=40;break;case 10:if(!(s=this.getCached(r.id,D.SyncList.type))){t.next=15;break}return t.abrupt("return",s);case 15:return t.prev=15,t.next=18,this._getList(r.id);case 18:n=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t.catch(15),404===t.t0.status&&"open_existing"!==r.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createList(r.id,r.purpose,r.context,r.ttl);case 30:n=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t.catch(27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.list(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(D.SyncList.type,r.id,n),u=new D.SyncList(this.services,n,function(e,t,r){return c.removeFromCacheAndSession(e,t,r)}),u=this.entities.store(u),t.abrupt("return",i(u));case 44:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}))}},{key:"stream",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){var r,n,s,u,c,l=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:if(r=o(e),n=void 0,"create_new"!==r.mode){t.next=10;break}return t.next=7,this._createStream(r.id,r.ttl);case 7:n=t.sent,t.next=40;break;case 10:if(!(s=this.getCached(r.id,V.SyncStream.type))){t.next=15;break}return t.abrupt("return",s);case 15:return t.prev=15,t.next=18,this._getStream(r.id);case 18:n=t.sent,t.next=40;break;case 21:if(t.prev=21,t.t0=t.catch(15),404===t.t0.status&&"open_existing"!==r.mode){t.next=27;break}throw t.t0;case 27:return t.prev=27,t.next=30,this._createStream(r.id,r.ttl);case 30:n=t.sent,t.next=40;break;case 33:if(t.prev=33,t.t1=t.catch(27),409!==t.t1.status){t.next=39;break}return t.abrupt("return",this.stream(e));case 39:throw t.t1;case 40:return this.storeRootInSessionCache(V.SyncStream.type,r.id,n),u=function(e,t,r){return l.removeFromCacheAndSession(e,t,r)},c=new V.SyncStream(this.services,n,u),c=this.entities.store(c),t.abrupt("return",i(c));case 45:case"end":return t.stop()}},t,this,[[15,21],[27,33]])}))}},{key:"shutdown",value:function(){return w(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}},e,this)}))}},{key:"updateToken",value:function(e){return w(this,void 0,void 0,a.default.mark(function t(){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.emsClient.setToken(e);case 2:if(r=t.sent,"NEW"!==r.status){t.next=8;break}throw A.default.error("Failed to update token: "+r.reason),new W.default("Failed to update token: "+r.reason,400,0);case 8:return this.services.config.updateToken(r.token),t.next=11,k.default.all([this.services.notifications.updateToken(e),this.services.twilsock.updateToken(e)]);case 11:this.fpaToken=e;case 12:case"end":return t.stop()}},t,this)}))}},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return G}}]),t}(x.EventEmitter);r.Client=Q,r.SyncClient=Q,r.default=Q},{"../package.json":244,"./clientInfo":3,"./configuration":4,"./entitiesCache":5,"./logger":8,"./network":11,"./router":13,"./services/storage":14,"./streams/syncstream":15,"./subscriptions":16,"./syncdocument":18,"./syncerror":19,"./synclist":20,"./syncmap":21,"./utils":22,"./utils/deferred":23,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/extends":44,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,"babel-runtime/regenerator":49,events:201,"twilio-ems-client":214,"twilio-notifications":220,"twilio-transport":226,twilsock:229,xxhashjs:241}],3:[function(e,t,r){"use strict";var n=e("babel-runtime/helpers/classCallCheck"),i=function(e){return e&&e.__esModule?e:{default:e}}(n);Object.defineProperty(r,"__esModule",{value:!0});var o=e("platform"),s=function e(t){(0,i.default)(this,e),this.sdk="js",this.sdkVer=t,this.os=o.os.family,this.osVer=o.os.version,this.pl=o.name,this.plVer=o.version};r.ClientInfo=s,r.default=s},{"babel-runtime/helpers/classCallCheck":42,platform:207}],4:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t,r){return e&&void 0!==e[t]?e[t]:r}var o=e("babel-runtime/helpers/classCallCheck"),s=n(o),a=e("babel-runtime/helpers/createClass"),u=n(a);Object.defineProperty(r,"__esModule",{value:!0});var c="https://cds.twilio.com",l="/v4/Subscriptions",f="/v3/Maps",h="/v3/Lists",p="/v3/Documents",d="/v3/Streams",_=function(){function e(t,r){(0,s.default)(this,e),r=r||{},r=r.Sync||r.DataSync||{};var n=r.cdsUri||c;this._token=t,this.settings={subscriptionsUri:n+l,documentsUri:n+p,listsUri:n+h,mapsUri:n+f,streamsUri:n+d,sessionStorageEnabled:i(r,"enableSessionStorage",!0)}}return(0,u.default)(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}},{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}}]),e}();r.Configuration=_},{"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],5:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/map"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u);Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function e(){(0,a.default)(this,e),this.names=new o.default,this.entities=new o.default}return(0,c.default)(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var r=this.names.get(t+"::"+e);return r?this.entities.get(r):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();r.EntitiesCache=l},{"babel-runtime/core-js/map":28,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],6:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/get-prototype-of"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=n(l),h=e("babel-runtime/helpers/inherits"),p=n(h);Object.defineProperty(r,"__esModule",{value:!0});var d=e("events"),_=function(e){function t(e,r){(0,a.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return n.services=e,n.removalHandler=r,n.subscriptionState="none",n}return(0,p.default)(t,e),(0,c.default)(t,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.emit("failure",e)}},{key:"_subscribe",value:function(){return this.services.router.subscribe(this.sid,this),this}},{key:"_unsubscribe",value:function(){return this.services.router.unsubscribe(this.sid,this),this}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.emit("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName)}}]),t}(d.EventEmitter);r.SyncEntity=_,r.default=_},{"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,events:201}],7:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=n(i),s=e("babel-runtime/helpers/createClass"),a=n(s);Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(t){(0,o.default)(this,e),this.data=t}return(0,a.default)(e,[{key:"update",value:function(e,t,r,n){return this.data.lastEventId=e,this.data.revision=t,this.data.value=r,this.data.dateUpdated=n,this}},{key:"updateDateExpires",value:function(e){this.data.dateExpires=e}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"dateUpdated",get:function(){return this.data.dateUpdated}},{key:"dateExpires",get:function(){return this.data.dateExpires}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),e}();r.ListItem=u,r.default=u},{"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],8:[function(e,t,r){"use strict";function n(e,t){return[e].concat((0,o.default)(t))}var i=e("babel-runtime/core-js/array/from"),o=function(e){return e&&e.__esModule?e:{default:e}}(i);Object.defineProperty(r,"__esModule",{value:!0});var s=e("loglevel");r.default={setLevel:function(e){s.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.trace.apply(null,n("Sync T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.debug.apply(null,n("Sync D:",t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.info.apply(null,n("Sync I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.warn.apply(null,n("Sync W:",t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.error.apply(null,n("Sync E:",t))}}},{"babel-runtime/core-js/array/from":24,loglevel:205}],9:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=n(i),s=e("babel-runtime/helpers/createClass"),a=n(s);Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(t){(0,o.default)(this,e),this.descriptor=t}return(0,a.default)(e,[{key:"update",value:function(e,t,r,n){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=r,this.descriptor.date_updated=n,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}]),e}();r.MapItem=u,r.default=u},{"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],10:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=n(i),s=e("babel-runtime/core-js/map"),a=n(s),u=e("babel-runtime/helpers/classCallCheck"),c=n(u),l=e("babel-runtime/helpers/createClass"),f=n(l),h=e("babel-runtime/core-js/promise"),p=n(h),d=function(e,t,r,n){return new(r||(r=p.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var _=function(){function e(t){(0,c.default)(this,e),this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=t}return(0,f.default)(e,[{key:"add",value:function(e,t){var r=this,n=new p.default(function(n,i){return r.queuedRequests.push({input:e,requestFunction:t,resolve:n,reject:i})});return this.wakeupQueue(),n}},{key:"squashAndAdd",value:function(e,t){var r=this.queuedRequests;this.queuedRequests=[];var n=void 0;r.length>0?(n=r.map(function(e){return e.input}).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach(function(e){return i.then(e.resolve,e.reject)}),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then(function(t){e.isRequestInFlight=!1,e.wakeupQueue()})}}}]),e}();r.MergingQueue=_;var v=function(){function e(t){(0,c.default)(this,e),this.queueByNamespaceKey=new a.default,this.inputReducer=t}return(0,f.default)(e,[{key:"add",value:function(e,t,r){return d(this,void 0,void 0,o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.invokeQueueMethod(e,function(e){return e.add(t,r)}));case 1:case"end":return n.stop()}},n,this)}))}},{key:"squashAndAdd",value:function(e,t,r){return d(this,void 0,void 0,o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.invokeQueueMethod(e,function(e){return e.squashAndAdd(t,r)}));case 1:case"end":return n.stop()}},n,this)}))}},{key:"invokeQueueMethod",value:function(e,t){return d(this,void 0,void 0,o.default.mark(function r(){var n,i;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this.queueByNamespaceKey.has(e)||this.queueByNamespaceKey.set(e,new _(this.inputReducer)),n=this.queueByNamespaceKey.get(e),i=t(n),this.queueByNamespaceKey.get(e).isEmpty()&&this.queueByNamespaceKey.delete(e),r.abrupt("return",i);case 5:case"end":return r.stop()}},r,this)}))}}]),e}();r.NamespacedMergingQueue=v},{"babel-runtime/core-js/map":28,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/regenerator":49}],11:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function o(e){return e.body?e.body.code:0}function s(e){return 409===e.status?new g.SyncNetworkError(i(e),e.status,o(e),e.body):e.status?new b.SyncError(i(e),e.status,o(e)):e instanceof w.TwilsockUnavailableError?e:new b.SyncError(e.message,0,0)}var a=e("babel-runtime/core-js/promise"),u=n(a),c=e("babel-runtime/helpers/extends"),l=n(c),f=e("babel-runtime/core-js/json/stringify"),h=n(f),p=e("babel-runtime/helpers/classCallCheck"),d=n(p),_=e("babel-runtime/helpers/createClass"),v=n(_);Object.defineProperty(r,"__esModule",{value:!0});var m=e("uuid"),y=e("./logger"),b=e("./syncerror"),g=e("./syncNetworkError"),k=e("operation-retrier"),w=e("twilio-transport"),x=function(){function e(t,r,n,i){(0,d.default)(this,e),this.productId=t,this.clientInfo=r,this.config=n,this.transport=i}return(0,v.default)(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":(0,h.default)(this.clientInfo),"Twilio-Request-Id":"RQ"+m.v4().replace(/-/g,""),"X-Twilio-Product-Id":this.productId,"X-Twilio-Token":this.config.token}}},{key:"backoffConfig",value:function(){return(0,l.default)({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new u.default(function(n,i){var o=[502,503,504];r&&o.push(429);var a=new k.default(t.backoffConfig());a.on("attempt",function(){e().then(function(e){return a.succeeded(e)}).catch(function(e){if(-1!==o.indexOf(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);a.failed(s(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?a.failed(s(e)):e.message&&-1!==e.message.indexOf("Twilsock: request timeout")?a.failed(s(e)):(a.removeAllListeners(),a.cancel(),i(s(e)))})}),a.on("succeeded",function(e){n(e)}),a.on("cancelled",function(e){return i(s(e))}),a.on("failed",function(e){return i(s(e))}),a.start()})}},{key:"get",value:function(e){var t=this,r=this.createHeaders();return y.default.debug("GET",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.get(e,r)},!0)}},{key:"post",value:function(e,t,r,n){var i=this,o=this.createHeaders();return void 0!==r&&null!==r&&(o["If-Match"]=r),y.default.debug("POST",e,"ID:",o["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.post(e,o,t,n)},!1)}},{key:"put",value:function(e,t,r){var n=this,i=this.createHeaders();return void 0!==r&&null!==r&&(i["If-Match"]=r),y.default.debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry(function(){return n.transport.put(e,i,t)},!1)}},{key:"delete",value:function(e){var t=this,r=this.createHeaders();return y.default.debug("DELETE",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.delete(e,r)},!1)}}]),e}();r.Network=x,r.default=x},{"./logger":8,"./syncNetworkError":17,"./syncerror":19,"babel-runtime/core-js/json/stringify":27,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/extends":44,"operation-retrier":206,"twilio-transport":226,uuid:236}],12:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u),l=e("babel-runtime/core-js/promise"),f=n(l),h=function(e,t,r,n){return new(r||(r=f.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var p=function(){function e(t,r,n,i){(0,a.default)(this,e),this.prevToken=n,this.nextToken=i,this.items=t,this.source=r}return(0,c.default)(e,[{key:"nextPage",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"prevPage",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),e}();r.Paginator=p,r.default=p},{"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/regenerator":49}],13:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u),l=e("babel-runtime/core-js/promise"),f=n(l),h=function(e,t,r,n){return new(r||(r=f.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){
e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var p=e("./logger"),d="com.twilio.rtd.cds.document",_="com.twilio.rtd.cds.list",v="com.twilio.rtd.cds.map",m="twilio.sync.event",y=function(){function e(t){var r=this;(0,a.default)(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(m),this.notifications.subscribe(d),this.notifications.subscribe(_),this.notifications.subscribe(v),this.notifications.on("message",function(e,t){return r.onMessage(e,t)}),this.notifications.on("transportReady",function(e){return r.onConnectionStateChanged(e)})}return(0,c.default)(e,[{key:"onMessage",value:function(e,t){switch(p.default.trace("Notification type:",e,"content:",t),e){case d:case _:case v:this.subscriptions.acceptMessage(t,!1);break;case m:this.subscriptions.acceptMessage(t,!0)}}},{key:"subscribe",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function r(){return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.subscriptions.add(e,t);case 2:case"end":return r.stop()}},r,this)}))}},{key:"unsubscribe",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.subscriptions.remove(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"onConnectionStateChanged",value:function(e){this.subscriptions.onConnectionStateChanged(e)}}]),e}();r.Router=y,r.default=y},{"./logger":8,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/regenerator":49}],14:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/extends"),o=n(i),s=e("babel-runtime/core-js/json/stringify"),a=n(s),u=e("babel-runtime/helpers/classCallCheck"),c=n(u),l=e("babel-runtime/helpers/createClass"),f=n(l);Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function e(t,r){(0,c.default)(this,e),this.config=t,this.storageId=null;try{this.storage=r||sessionStorage}catch(e){}}return(0,f.default)(e,[{key:"storageKey",value:function(e,t){return this.storageId+"::"+e+"::"+t}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,r){return this.isReady?this._store(this.storageKey(e,t),r):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,r){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),r&&this.storage.removeItem(this.storageKey(e,r))}catch(e){}}},{key:"update",value:function(e,t,r,n){if(!this.isReady)return null;this._apply(this.storageKey(e,t),n),r&&this._apply(this.storageKey(e,r),n)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,(0,a.default)(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var r=this._read(e);if(!r)return!1;this._store(e,(0,o.default)(r,t))}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}}]),e}();r.SessionStorage=h},{"babel-runtime/core-js/json/stringify":27,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/extends":44}],15:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=n(i),s=e("babel-runtime/core-js/object/get-prototype-of"),a=n(s),u=e("babel-runtime/helpers/classCallCheck"),c=n(u),l=e("babel-runtime/helpers/createClass"),f=n(l),h=e("babel-runtime/helpers/possibleConstructorReturn"),p=n(h),d=e("babel-runtime/helpers/inherits"),_=n(d),v=e("babel-runtime/core-js/promise"),m=n(v),y=function(e,t,r,n){return new(r||(r=m.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var b=e("../entity"),g=e("../utils"),k=function(e){function t(e,r,n){(0,c.default)(this,t);var i=(0,p.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n));return i.descriptor=r,i}return(0,_.default)(t,e),(0,f.default)(t,[{key:"publishMessage",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var r,n,i,s;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={data:e},t.next=3,this.services.network.post(this.links.messages,r);case 3:return n=t.sent,i=n.body,s=this._handleMessagePublished(i.sid,e,!1),t.abrupt("return",s);case 7:case"end":return t.stop()}},t,this)}))}},{key:"setTtl",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return g.validateMandatoryTtl(e),t.prev=1,r={ttl:e},t.next=5,this.services.network.post(this.uri,r);case 5:n=t.sent,this.descriptor.date_expires=n.body.date_expires,t.next=13;break;case 9:throw t.prev=9,t.t0=t.catch(1),404===t.t0.status&&this.onRemoved(!1),t.t0;case 13:case"end":return t.stop()}},t,this,[[1,9]])}))}},{key:"removeStream",value:function(){return y(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,r){var n={sid:e,value:t};return this.emit("messagePublished",{message:n,isLocal:!r}),n}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"stream"}}]),t}(b.SyncEntity);r.SyncStream=k,r.default=k},{"../entity":6,"../utils":22,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,"babel-runtime/regenerator":49}],16:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=n(i),s=e("babel-runtime/helpers/slicedToArray"),a=n(s),u=e("babel-runtime/core-js/get-iterator"),c=n(u),l=e("babel-runtime/helpers/extends"),f=n(l),h=e("babel-runtime/core-js/map"),p=n(h),d=e("babel-runtime/helpers/classCallCheck"),_=n(d),v=e("babel-runtime/helpers/createClass"),m=n(v),y=e("babel-runtime/core-js/promise"),b=n(y),g=function(e,t,r,n){return new(r||(r=b.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var k=e("backoff"),w=e("./logger"),x=e("./syncerror"),C=e("twilio-transport"),j=function(){function e(t){(0,_.default)(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return(0,m.default)(e,[{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.localObject._setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new x.SyncError("Failed to subscribe on service events: "+e.error.message,e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"isEstablished",get:function(){return this.established}}]),e}(),E=function(){function e(t){var r=this;(0,_.default)(this,e),this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=t,this.subscriptions=new p.default,this.persisted=new p.default,this.latestPokeResponseArrivalTimestampByCorrelationId=new p.default;var n={randomisationFactor:.2,initialDelay:100,maxDelay:12e4};this.backoff=k.exponential((0,f.default)(n,this.services.config.backoffConfig)),this.backoff.on("ready",function(){var e=r.getSubscriptionUpdateBatch(),t=e.action,n=e.subscriptions;t?r.applyNewSubscriptionUpdateBatch(t,n):(r.backoff.reset(),w.default.debug("All subscriptions resolved."))})}return(0,m.default)(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,r,n){var i=[],o=!0,s=!1,u=void 0;try{for(var l,f=(0,c.default)(e);!(o=(l=f.next()).done);o=!0){var h=(0,a.default)(l.value,2),p=h[0],d=h[1];if(!t.get(p)&&r!==d.pendingAction&&!d.rejectedWithError&&(i.push(d),n&&i.length>=n))break}}catch(e){s=!0,u=e}finally{try{!o&&f.return&&f.return()}finally{if(s)throw u}}return i}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var r=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return r.length>0?{action:"cancel",subscriptions:r}:{action:null,subscriptions:null}}},{key:"persist",value:function(){try{this.backoff.backoff()}catch(e){}}},{key:"applyNewSubscriptionUpdateBatch",value:function(e,t){return g(this,void 0,void 0,o.default.mark(function r(){var n,i,s,a,u,l,f,h,p,d,_,v,m,y,b,g,k,x,j,E,S,T,R=this;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.isConnected){r.next=4;break}return w.default.debug("Twilsock connection (required for subscription) not ready; waiting\u2026"),this.backoff.reset(),r.abrupt("return");case 4:for(t=this.processLocalActions(e,t),n=(new Date).getTime(),i=!0,s=!1,a=void 0,r.prev=9,u=(0,c.default)(t);!(i=(l=u.next()).done);i=!0)f=l.value,this.recordActionAttemptOn(f,e,n);r.next=17;break;case 13:r.prev=13,r.t0=r.catch(9),s=!0,a=r.t0;case 17:r.prev=17,r.prev=18,!i&&u.return&&u.return();case 20:if(r.prev=20,!s){r.next=23;break}throw a;case 23:return r.finish(20);case 24:return r.finish(17);case 25:return h=this.pendingPokeReason,this.pendingPokeReason=null,r.prev=27,r.next=30,this.request(e,n,h,t);case 30:p=r.sent,d=p.body.max_batch_size,!isNaN(parseInt(d))&&isFinite(d)&&d>0&&(this.maxBatchSize=d),this.subscriptionTtlTimer||(_=p.body.ttl_in_s,v=!isNaN(parseFloat(_))&&isFinite(_),(m=v&&_>0)&&(this.subscriptionTtlTimer=setTimeout(function(){return R.onSubscriptionTtlElapsed()},1e3*_))),"establish"===e&&(y=p.body.estimated_delivery_in_ms,b=!isNaN(parseFloat(y))&&isFinite(y),g=b&&y>0,g?setTimeout(function(){return R.verifyPokeDelivery(n,y,t)},y):w.default.error("Invalid timeout: "+y),t.filter(function(e){return e.pendingCorrelationId===n}).forEach(function(e){return e.localObject._setSubscriptionState("response_in_flight")})),this.backoff.reset(),r.next=60;break;case 38:for(r.prev=38,r.t1=r.catch(27),k=!0,x=!1,j=void 0,r.prev=43,E=(0,c.default)(t);!(k=(S=E.next()).done);k=!0)T=S.value,this.recordActionFailureOn(T,e);r.next=51;break;case 47:r.prev=47,r.t2=r.catch(43),x=!0,j=r.t2;case 51:r.prev=51,r.prev=52,!k&&E.return&&E.return();case 54:if(r.prev=54,!x){r.next=57;break}throw j;case 57:return r.finish(54);case 58:return r.finish(51);case 59:r.t1 instanceof C.TwilsockUnavailableError?(w.default.debug("Twilsock connection (required for subscription) not ready (c:"+n+"); waiting\u2026"),this.backoff.reset()):(w.default.debug("Failed an attempt to "+e+" subscriptions (c:"+n+"); retrying",r.t1),this.persist());case 60:case"end":return r.stop()}},r,this,[[9,13,17,25],[18,,20,24],[27,38],[43,47,51,59],[52,,54,58]])}))}},{key:"verifyPokeDelivery",value:function(e,t,r){var n=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),o=i?(new Date).getTime()-i:t;if(o>=t)r.filter(function(t){return t.pendingCorrelationId===e}).forEach(function(e){e.updatePending(null,null),e.retryCount++,n.persisted.delete(e.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e);else{var s=t-o;setTimeout(function(){return n.verifyPokeDelivery(e,t,r)},s)}}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter(function(e){return!e.rejectedWithError}):t}},{key:"recordActionAttemptOn",value:function(e,t,r){if(e.localObject._setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,r);else{var n=this.persisted.get(e.sid);n&&n.updatePending(t,r)}}},{key:"recordActionFailureOn",value:function(e,t){e.localObject._setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,r,n){var i=n.map(function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0}}),o=n.filter(function(e){return e.retryCount>0}).length;w.default.debug("Attempting '"+e+"' request (c:"+t+"):",i);var s={event_protocol_version:3,action:e,correlation_id:t,retried_requests:o,ttl_in_s:-1,requests:i};return"ttl"===r&&(s.reason=r),this.services.network.post(this.services.config.subscriptionsUri,s,null,!0)}},{key:"add",value:function(e,t){w.default.debug("Establishing intent to subscribe to "+e);var r=this.subscriptions.get(e);r&&r.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new j(t)),this.persist())}},{key:"remove",value:function(e){w.default.debug("Establishing intent to unsubscribe from "+e),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){switch(w.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document|stream)_/)||{}).input:;this.applyEventToSubscribedEntity(function(){return e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:e.event_type.match(/^stream_/)?e.event.stream_sid:void 0}(),e,t);break;default:w.default.debug("Dropping unknown message type "+e.event_type)}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var r=e.object_sid,n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?"interrupted"===e.replay_status?(w.default.debug("Event Replay for subscription to "+r+" (c:"+t+") interrupted; continuing eagerly."),n.updatePending(null,null),this.persisted.delete(n.sid),this.backoff.reset()):"completed"===e.replay_status&&(w.default.debug("Event Replay for subscription to "+r+" (c:"+t+") completed. Subscription is ready."),n.complete(e.last_event_id),this.persisted.set(e.object_sid,n),n.localObject._setSubscriptionState("established"),this.backoff.reset()):w.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?(r.updatePending(null,null),r.localObject._setSubscriptionState("none"),this.persisted.delete(e.object_sid)):w.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var r=e.object_sid,n=this.subscriptions.get(r),i=this.persisted.get(r);n&&i?i.pendingCorrelationId===t&&(w.default.error("Failed to subscribe on "+i.sid,e.error),i.markAsFailed(e),i.localObject._setSubscriptionState("none")):!n&&i&&(this.persisted.delete(r),i.localObject._setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,r){var n=this;if(e){r=r||function(){var t=n.persisted.get(e);return t&&t.isEstablished}();var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,r)):w.default.debug("Message dropped for SID '"+e+"', for which there is no subscription.")}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){w.default.debug("Triggering event replay for all subscriptions, reason="+e),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t=[],r=!0,n=!1,i=void 0;try{for(var o,s=(0,c.default)(this.persisted.values());!(r=(o=s.next()).done);r=!0){var a=o.value;a.reset(),a.rejectedWithError&&t.push(a)}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}this.persisted.clear();var u=!0,l=!1,f=void 0;try{for(var h,p=(0,c.default)(t);!(u=(h=p.next()).done);u=!0){var d=h.value;this.persisted.set(d.sid,d)}}catch(e){l=!0,f=e}finally{try{!u&&p.return&&p.return()}finally{if(l)throw f}}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();r.Subscriptions=E,r.default=E},{"./logger":8,"./syncerror":19,"babel-runtime/core-js/get-iterator":25,"babel-runtime/core-js/map":28,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/extends":44,"babel-runtime/helpers/slicedToArray":47,"babel-runtime/regenerator":49,backoff:50,"twilio-transport":226}],17:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/get-prototype-of"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/possibleConstructorReturn"),c=n(u),l=e("babel-runtime/helpers/inherits"),f=n(l);Object.defineProperty(r,"__esModule",{value:!0});var h=e("./syncerror"),p=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments[3];(0,a.default)(this,t);var s=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e,r,n));return s.body=i,s}return(0,f.default)(t,e),t}(h.SyncError);r.SyncNetworkError=p,r.default=p},{"./syncerror":19,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46}],18:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/extends"),o=n(i),s=e("babel-runtime/regenerator"),a=n(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=n(u),l=e("babel-runtime/helpers/classCallCheck"),f=n(l),h=e("babel-runtime/helpers/createClass"),p=n(h),d=e("babel-runtime/helpers/possibleConstructorReturn"),_=n(d),v=e("babel-runtime/helpers/inherits"),m=n(v),y=e("babel-runtime/core-js/promise"),b=n(y),g=function(e,t,r,n){return new(r||(r=b.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var k=e("./logger"),w=e("./entity"),x=e("./utils"),C=e("./mergingqueue"),j=e("./syncerror"),E=function(e){function t(e,r,n){(0,f.default)(this,t);var i=(0,_.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e,n));i.isDeleted=!1;var o=function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e};return i.updateMergingQueue=new C.MergingQueue(o),i.descriptor=r,i.descriptor.data=i.descriptor.data||{},i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return(0,m.default)(t,e),(0,p.default)(t,[{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.emit("updated",{value:e.document_data,isLocal:!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data})):k.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){var n,i=this;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t||{},x.validateOptionalTtl(n.ttl),r.abrupt("return",this.updateMergingQueue.squashAndAdd(n,function(t){return i._setUnconditionally(e,t.ttl)}));case 3:case"end":return r.stop()}},r,this)}))}},{key:"mutate",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){var n,i=this;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t||{},x.validateOptionalTtl(n.ttl),r.abrupt("return",this.updateMergingQueue.add(n,function(t){return i._setWithIfMatch(e,t.ttl)}));case 3:case"end":return r.stop()}},r,this)}))}},{key:"update",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.mutate(function(t){return(0,o.default)(t,e)},t));case 1:case"end":return r.stop()}},r,this)}))}},{key:"setTtl",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x.validateMandatoryTtl(e),t.next=3,this._postUpdateToServer({ttl:e});case 3:r=t.sent,this.descriptor.date_expires=r.date_expires;case 5:case"end":return t.stop()}},t,this)}))}},{key:"_setUnconditionally",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){var n;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this._postUpdateToServer({data:e,revision:void 0,ttl:t});case 2:return n=r.sent,this._handleSuccessfulUpdateResult(n),r.abrupt("return",this.value);case 5:case"end":return r.stop()}},r,this)}))}},{key:"_setWithIfMatch",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){var n,i,o;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=e(x.deepClone(this.value)))){r.next=22;break}return i=this.revision,r.prev=3,r.next=6,this._postUpdateToServer({data:n,revision:i,ttl:t});case 6:return o=r.sent,this._handleSuccessfulUpdateResult(o),r.abrupt("return",this.value);case 11:if(r.prev=11,r.t0=r.catch(3),412!==r.t0.status){r.next=19;break}return r.next=16,this._softSync();case 16:return r.abrupt("return",this._setWithIfMatch(e));case 19:throw r.t0;case 20:r.next=23;break;case 22:return r.abrupt("return",this.value);case 23:case"end":return r.stop()}},r,this,[[3,11]])}))}},{key:"_handleSuccessfulUpdateResult",value:function(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.emit("updated",{value:this.value,isLocal:!0}))}},{key:"_postUpdateToServer",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r,n,i;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isDeleted){t.next=17;break}return r={data:e.data},"number"==typeof e.ttl&&(r.ttl=e.ttl),n=e.revision,t.prev=4,t.next=7,this.services.network.post(this.uri,r,n);case 7:return i=t.sent,t.abrupt("return",{revision:i.body.revision,data:e.data,last_event_id:i.body.last_event_id,date_updated:i.body.date_updated,date_expires:i.body.date_expires});case 11:throw t.prev=11,t.t0=t.catch(4),404===t.t0.status&&this.onRemoved(!1),t.t0;case 15:t.next=18;break;case 17:return t.abrupt("return",b.default.reject(new j.SyncError("The Document has been removed",404,54100)));case 18:case"end":return t.stop()}},t,this,[[4,11]])}))}},{key:"_softSync",value:function(){return g(this,void 0,void 0,a.default.mark(function e(){var t=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then(function(e){var r={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(r),t}).catch(function(e){404===e.status?t.onRemoved(!1):k.default.error("Can't get updates for "+t.sid+":",e)}));case 1:case"end":return e.stop()}},e,this)}))}},{key:"onRemoved",value:function(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e}))}},{key:"removeDocument",value:function(){return g(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",b.default.reject(new j.SyncError("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"document"}}]),t}(w.SyncEntity);r.SyncDocument=E,r.default=E},{"./entity":6,"./logger":8,"./mergingqueue":10,"./syncerror":19,"./utils":22,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/extends":44,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,"babel-runtime/regenerator":49}],19:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/get-prototype-of"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/possibleConstructorReturn"),c=n(u),l=e("babel-runtime/helpers/inherits"),f=n(l);Object.defineProperty(r,"__esModule",{value:!0});var h=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,a.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return i.name=i.constructor.name,i.message=e+" (status: "+r+", code: "+n+")",i.status=r,i.code=n,i}return(0,f.default)(t,e),t}(Error);r.SyncError=h,r.default=h},{"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46}],20:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/extends"),o=n(i),s=e("babel-runtime/regenerator"),a=n(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=n(u),l=e("babel-runtime/helpers/classCallCheck"),f=n(l),h=e("babel-runtime/helpers/createClass"),p=n(h),d=e("babel-runtime/helpers/possibleConstructorReturn"),_=n(d),v=e("babel-runtime/helpers/inherits"),m=n(v),y=e("babel-runtime/core-js/promise"),b=n(y),g=function(e,t,r,n){return new(r||(r=b.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var k=e("./utils"),w=e("./logger"),x=e("./entity"),C=e("./listitem"),j=e("./paginator"),E=e("./cache"),S=e("./mergingqueue"),T=e("./syncerror"),R=function(e){function t(e,r,n){(0,f.default)(this,t);var i=(0,_.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e,n)),o=function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e};return i.updateMergingQueue=new S.NamespacedMergingQueue(o),i.cache=new E.Cache,i.descriptor=r,i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return(0,m.default)(t,e),(0,p.default)(t,[{key:"_addOrUpdateItemOnServer",value:function(e,t,r,n){return g(this,void 0,void 0,a.default.mark(function i(){var o,s;return a.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o={data:t},"number"==typeof n&&(o.ttl=n),i.next=4,this.services.network.post(e,o,r);case 4:return s=i.sent,s.body.data=t,s.body.date_updated=new Date(s.body.date_updated),i.abrupt("return",s.body);case 8:case"end":return i.stop()}},i,this)}))}},{key:"push",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){var n,i,o;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=(t||{}).ttl,k.validateOptionalTtl(n),r.next=4,this._addOrUpdateItemOnServer(this.links.items,e,void 0,n);case 4:return i=r.sent,o=Number(i.index),this._handleItemMutated(o,i.url,i.last_event_id,i.revision,e,i.date_updated,i.date_expires,!0,!1),r.abrupt("return",this.cache.get(o));case 8:case"end":return r.stop()}},r,this)}))}},{key:"set",value:function(e,t,r){var n=this,i=r||{};return k.validateOptionalTtl(i.ttl),this.updateMergingQueue.squashAndAdd(e,i,function(r){return n._updateItemUnconditionally(e,t,r.ttl)})}},{key:"_updateItemUnconditionally",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){var i,o;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get(e);case 2:return i=n.sent,n.next=5,this._addOrUpdateItemOnServer(i.uri,t,void 0,r);case 5:return o=n.sent,this._handleItemMutated(e,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,!1,!1),n.abrupt("return",this.cache.get(e));case 8:case"end":return n.stop()}},n,this)}))}},{key:"_updateItemWithIfMatch",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){var i,o,s,u;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get(e);case 2:if(i=n.sent,!(o=t(k.deepClone(i.value)))){n.next=25;break}return s=i.revision,n.prev=6,n.next=9,this._addOrUpdateItemOnServer(i.uri,o,s,r);case 9:return u=n.sent,this._handleItemMutated(e,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,!1,!1),
n.abrupt("return",this.cache.get(e));case 14:if(n.prev=14,n.t0=n.catch(6),412!==n.t0.status){n.next=22;break}return n.next=19,this._getItemFromServer(e);case 19:return n.abrupt("return",this._updateItemWithIfMatch(e,t,r));case 22:throw n.t0;case 23:n.next=26;break;case 25:return n.abrupt("return",i);case 26:case"end":return n.stop()}},n,this,[[6,14]])}))}},{key:"mutate",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){var i,o=this;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=r||{},k.validateOptionalTtl(i.ttl),n.abrupt("return",this.updateMergingQueue.add(e,i,function(r){return o._updateItemWithIfMatch(e,t,r.ttl)}));case 3:case"end":return n.stop()}},n,this)}))}},{key:"update",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.mutate(e,function(e){return(0,o.default)(e,t)},r));case 1:case"end":return n.stop()}},n,this)}))}},{key:"remove",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r,n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:return r=t.sent,t.next=5,this.services.network.delete(r.uri);case 5:n=t.sent,this._handleItemRemoved(e,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1);case 7:case"end":return t.stop()}},t,this)}))}},{key:"get",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=this.cache.get(e))){t.next=5;break}return t.abrupt("return",r);case 5:return t.abrupt("return",this._getItemFromServer(e));case 6:case"end":return t.stop()}},t,this)}))}},{key:"_getItemFromServer",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.queryItems({index:e});case 2:if(r=t.sent,!(r.items.length<1)){t.next=7;break}throw new T.SyncError("No item with index "+e+" found",404,54151);case 7:return t.abrupt("return",r.items[0]);case 8:case"end":return t.stop()}},t,this)}))}},{key:"queryItems",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r,n,i,o,s=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},r=new k.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Index",e.index).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build(),t.next=4,this.services.network.get(r);case 4:return n=t.sent,i=n.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),s.cache.get(e.index)?s._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):s.cache.store(Number(e.index),new C.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,value:e.data}),e.last_event_id),s.cache.get(e.index)}),o=n.body.meta,t.abrupt("return",new j.Paginator(i,function(e){return s.queryItems({pageToken:e})},o.previous_token,o.next_token));case 8:case"end":return t.stop()}},t,this)}))}},{key:"getItems",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},k.validatePageSize(e.pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 5:case"end":return t.stop()}},t,this)}))}},{key:"getContext",value:function(){return g(this,void 0,void 0,a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}},e,this)}))}},{key:"setTtl",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r,n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return k.validateMandatoryTtl(e),t.prev=1,r={ttl:e},t.next=5,this.services.network.post(this.uri,r);case 5:n=t.sent,this.descriptor.date_expires=n.body.date_expires,t.next=13;break;case 9:throw t.prev=9,t.t0=t.catch(1),404===t.t0.status&&this.onRemoved(!1),t.t0;case 13:case"end":return t.stop()}},t,this,[[1,9]])}))}},{key:"setItemTtl",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){var n,i,o;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return k.validateMandatoryTtl(t),r.next=3,this.get(e);case 3:return n=r.sent,i={ttl:t},r.next=7,this.services.network.post(n.uri,i);case 7:o=r.sent,n.updateDateExpires(o.body.date_expires);case 9:case"end":return r.stop()}},r,this)}))}},{key:"removeList",value:function(){return g(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var r=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(r,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(r,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,r,n,i,o,s,a,u){if(this.shouldIgnoreEvent(e,r))return void w.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",r);this._updateRootDateUpdated(o);var c=this.cache.get(e);if(c)c.lastEventId<r&&(c.update(r,n,i,o),void 0!==s&&c.updateDateExpires(s),this.emitItemMutationEvent(c,u,!1));else{var l=new C.ListItem({index:e,uri:t,lastEventId:r,revision:n,value:i,dateUpdated:o,dateExpires:s});this.cache.store(e,l,r),this.emitItemMutationEvent(l,u,a)}}},{key:"emitItemMutationEvent",value:function(e,t,r){var n=r?"itemAdded":"itemUpdated";this.emit(n,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.emit("itemRemoved",{index:e,isLocal:!i,value:r})}},{key:"_handleContextUpdate",value:function(e,t,r){this._updateRootDateUpdated(r),this._updateContextIfRequired(e,t)&&this.emit("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(w.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"list"}}]),t}(x.SyncEntity);r.SyncList=R,r.default=R},{"./cache":1,"./entity":6,"./listitem":7,"./logger":8,"./mergingqueue":10,"./paginator":12,"./syncerror":19,"./utils":22,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/extends":44,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,"babel-runtime/regenerator":49}],21:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/extends"),o=n(i),s=e("babel-runtime/regenerator"),a=n(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=n(u),l=e("babel-runtime/helpers/classCallCheck"),f=n(l),h=e("babel-runtime/helpers/createClass"),p=n(h),d=e("babel-runtime/helpers/possibleConstructorReturn"),_=n(d),v=e("babel-runtime/helpers/inherits"),m=n(v),y=e("babel-runtime/core-js/promise"),b=n(y),g=function(e,t,r,n){return new(r||(r=b.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var k=e("./utils"),w=e("./logger"),x=e("./entity"),C=e("./mapitem"),j=e("./paginator"),E=e("./cache"),S=e("./mergingqueue"),T=e("./syncerror"),R=function(e){function t(e,r,n){(0,f.default)(this,t);var i=(0,_.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e,n)),o=function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e};return i.updateMergingQueue=new S.NamespacedMergingQueue(o),i.cache=new E.Cache,i.descriptor=r,i.descriptor.date_updated=new Date(i.descriptor.date_updated),r.items&&r.items.forEach(function(e){e.date_updated=new Date(e.date_updated),i.cache.store(e.key,new C.MapItem(e),e.last_event_id)}),i}return(0,m.default)(t,e),(0,p.default)(t,[{key:"set",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){var i,o=this;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=r||{},k.validateOptionalTtl(i.ttl),n.abrupt("return",this.updateMergingQueue.squashAndAdd(e,i,function(r){return o._putItemUnconditionally(e,t,r.ttl)}));case 3:case"end":return n.stop()}},n,this)}))}},{key:"get",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cache.has(e)){t.next=4;break}return t.abrupt("return",this.cache.get(e));case 4:return t.abrupt("return",this._getItemFromServer(e));case 5:case"end":return t.stop()}},t,this)}))}},{key:"_getItemFromServer",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.queryItems({key:e});case 2:if(r=t.sent,!(r.items.length<1)){t.next=7;break}throw new T.SyncError("No item with key "+e+" found",404,54201);case 7:return t.abrupt("return",r.items[0]);case 8:case"end":return t.stop()}},t,this)}))}},{key:"mutate",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){var i,o=this;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=r||{},k.validateOptionalTtl(i.ttl),n.abrupt("return",this.updateMergingQueue.add(e,i,function(r){return o._putItemWithIfMatch(e,t,r.ttl)}));case 3:case"end":return n.stop()}},n,this)}))}},{key:"update",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.mutate(e,function(e){return(0,o.default)(e,t)},r));case 1:case"end":return n.stop()}},n,this)}))}},{key:"_putItemUnconditionally",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){var i,o;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._putItemToServer(e,t,void 0,r);case 2:return i=n.sent,o=i.item,this._handleItemMutated(o.key,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,i.added,!1),n.abrupt("return",this.cache.get(o.key));case 6:case"end":return n.stop()}},n,this)}))}},{key:"_putItemWithIfMatch",value:function(e,t,r){return g(this,void 0,void 0,a.default.mark(function n(){var i,o,s,u,c;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get(e).catch(function(t){if(404===t.status)return new C.MapItem({key:e,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw t});case 2:if(i=n.sent,!(o=t(k.deepClone(i.value)))){n.next=26;break}return s=i.revision,n.prev=6,n.next=9,this._putItemToServer(e,o,s,r);case 9:return u=n.sent,c=u.item,this._handleItemMutated(c.key,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,u.added,!1),n.abrupt("return",this.cache.get(c.key));case 15:if(n.prev=15,n.t0=n.catch(6),412!==n.t0.status){n.next=23;break}return n.next=20,this._getItemFromServer(e);case 20:return n.abrupt("return",this._putItemWithIfMatch(e,t,r));case 23:throw n.t0;case 24:n.next=27;break;case 26:return n.abrupt("return",i);case 27:case"end":return n.stop()}},n,this,[[6,15]])}))}},{key:"_putItemToServer",value:function(e,t,r,n){return g(this,void 0,void 0,a.default.mark(function i(){var o,s,u,c,l;return a.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=new k.UriBuilder(this.links.items).pathSegment(e).build(),s={data:t},"number"==typeof n&&(s.ttl=n),i.prev=3,i.next=6,this.services.network.put(o,s,r);case 6:return u=i.sent,c=u.body,c.data=t,c.date_updated=new Date(c.date_updated),l=201===u.status.code,i.abrupt("return",{added:l,item:c});case 14:throw i.prev=14,i.t0=i.catch(3),404===i.t0.status&&this.onRemoved(!1),i.t0;case 18:case"end":return i.stop()}},i,this,[[3,14]])}))}},{key:"remove",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r,n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=2;break}throw new Error("Key argument is invalid");case 2:return t.next=4,this.get(e);case 4:return r=t.sent,t.next=7,this.services.network.delete(r.uri);case 7:n=t.sent,this._handleItemRemoved(e,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1);case 9:case"end":return t.stop()}},t,this)}))}},{key:"queryItems",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r,n,i,o,s=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},r=new k.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Key",e.key).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build(),t.next=4,this.services.network.get(r);case 4:return n=t.sent,i=n.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),s.cache.get(e.key)?s._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):s.cache.store(e.key,new C.MapItem(e),e.last_event_id),s.cache.get(e.key)}),o=n.body.meta,t.abrupt("return",new j.Paginator(i,function(e){return s.queryItems({pageToken:e})},o.previous_token,o.next_token));case 8:case"end":return t.stop()}},t,this)}))}},{key:"getItems",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},k.validatePageSize(e.pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 5:case"end":return t.stop()}},t,this)}))}},{key:"forEach",value:function(e){var t=this;return new b.default(function(r,n){function i(t){t.items.forEach(function(t){return e(t)}),t.hasNextPage?t.nextPage().then(i).catch(n):r()}t.queryItems().then(i).catch(n)})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,r,n,i,o,s,a,u){if(this.shouldIgnoreEvent(e,r))return void w.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",r);this._updateRootDateUpdated(o);var c=this.cache.get(e);c?c.lastEventId<r&&(c.update(r,n,i,o),void 0!==s&&c.updateDateExpires(s),this.emitItemMutationEvent(c,u,!1)):(c=new C.MapItem({key:e,url:t,last_event_id:r,revision:n,data:i,date_updated:o,date_expires:s}),this.cache.store(e,c,r),this.emitItemMutationEvent(c,u,a))}},{key:"emitItemMutationEvent",value:function(e,t,r){var n=r?"itemAdded":"itemUpdated";this.emit(n,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.emit("itemRemoved",{key:e,isLocal:!i,value:r})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"setTtl",value:function(e){return g(this,void 0,void 0,a.default.mark(function t(){var r,n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return k.validateMandatoryTtl(e),t.prev=1,r={ttl:e},t.next=5,this.services.network.post(this.uri,r);case 5:n=t.sent,this.descriptor.date_expires=n.body.date_expires,t.next=13;break;case 9:throw t.prev=9,t.t0=t.catch(1),404===t.t0.status&&this.onRemoved(!1),t.t0;case 13:case"end":return t.stop()}},t,this,[[1,9]])}))}},{key:"setItemTtl",value:function(e,t){return g(this,void 0,void 0,a.default.mark(function r(){var n,i,o;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return k.validateMandatoryTtl(t),r.next=3,this.get(e);case 3:return n=r.sent,i={ttl:t},r.next=7,this.services.network.post(n.uri,i);case 7:o=r.sent,n.updateDateExpires(o.body.date_expires);case 9:case"end":return r.stop()}},r,this)}))}},{key:"removeMap",value:function(){return g(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"map"}}]),t}(x.SyncEntity);r.SyncMap=R,r.default=R},{"./cache":1,"./entity":6,"./logger":8,"./mapitem":9,"./mergingqueue":10,"./paginator":12,"./syncerror":19,"./utils":22,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/extends":44,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,"babel-runtime/regenerator":49}],22:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return JSON.parse((0,v.default)(e))}function o(e){if(void 0!==e&&!l(e))throw new m.default("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)}function s(e){if(!l(e))throw new m.default("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)}function a(e){if(void 0!==e&&!c(e))throw new m.default("Invalid pageSize parameter. Expected a positive integer, was '"+e+"'.",400,54455)}function u(e){return!isNaN(parseInt(e))&&isFinite(e)}function c(e){return u(e)&&e>0}function l(e){return u(e)&&e>=0}var f=e("babel-runtime/helpers/classCallCheck"),h=n(f),p=e("babel-runtime/helpers/createClass"),d=n(p),_=e("babel-runtime/core-js/json/stringify"),v=n(_);Object.defineProperty(r,"__esModule",{value:!0});var m=e("./syncerror");r.deepClone=i,r.validateOptionalTtl=o,r.validateMandatoryTtl=s,r.validatePageSize=a;var y=function(){function e(t){(0,h.default)(this,e),this.base=t,this.args=new Array,this.paths=new Array}return(0,d.default)(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();r.UriBuilder=y},{"./syncerror":19,"babel-runtime/core-js/json/stringify":27,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],23:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u);Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function e(){var t=this;(0,a.default)(this,e),this._promise=new o.default(function(e,r){t._resolve=e,t._reject=r})}return(0,c.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();r.Deferred=l},{"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],24:[function(e,t,r){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":64}],25:[function(e,t,r){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":65}],26:[function(e,t,r){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":66}],27:[function(e,t,r){t.exports={default:e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":67}],28:[function(e,t,r){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":68}],29:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":69}],30:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":70}],31:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-properties"),__esModule:!0}},{"core-js/library/fn/object/define-properties":71}],32:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":72}],33:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":73}],34:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":74}],35:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":75}],36:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":76}],37:[function(e,t,r){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":77}],38:[function(e,t,r){t.exports={default:e("core-js/library/fn/reflect/construct"),__esModule:!0}},{"core-js/library/fn/reflect/construct":78}],39:[function(e,t,r){t.exports={default:e("core-js/library/fn/set"),__esModule:!0}},{"core-js/library/fn/set":79}],40:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":80}],41:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":81}],42:[function(e,t,r){"use strict";r.__esModule=!0,r.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],43:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("../core-js/object/define-property"),i=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},{"../core-js/object/define-property":32}],44:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("../core-js/object/assign"),i=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},{"../core-js/object/assign":29}],45:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}r.__esModule=!0;var i=e("../core-js/object/set-prototype-of"),o=n(i),s=e("../core-js/object/create"),a=n(s),u=e("../helpers/typeof"),c=n(u);r.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,c.default)(t)));e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o.default?(0,o.default)(e,t):e.__proto__=t)}},{"../core-js/object/create":30,"../core-js/object/set-prototype-of":36,"../helpers/typeof":48}],46:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("../helpers/typeof"),i=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":48}],47:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}r.__esModule=!0;var i=e("../core-js/is-iterable"),o=n(i),s=e("../core-js/get-iterator"),a=n(s);r.default=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(e);!(n=(s=u.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if((0,o.default)(Object(t)))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":25,"../core-js/is-iterable":26}],48:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}r.__esModule=!0;var i=e("../core-js/symbol/iterator"),o=n(i),s=e("../core-js/symbol"),a=n(s),u="function"==typeof a.default&&"symbol"==typeof o.default?function(e){return typeof e}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":typeof e};r.default="function"==typeof a.default&&"symbol"===u(o.default)?function(e){return void 0===e?"undefined":u(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":void 0===e?"undefined":u(e)}},{"../core-js/symbol":40,"../core-js/symbol/iterator":41}],49:[function(e,t,r){t.exports=e("regenerator-runtime")},{"regenerator-runtime":212}],50:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("./lib/backoff"),i=e("./lib/strategy/exponential"),o=e("./lib/strategy/fibonacci"),s=e("./lib/function_call.js");t.exports.Backoff=n,t.exports.FunctionCall=s,t.exports.FibonacciStrategy=o,t.exports.ExponentialStrategy=i,t.exports.fibonacci=function(e){return new n(new o(e))},t.exports.exponential=function(e){return new n(new i(e))},t.exports.call=function(e,t,r){var n=Array.prototype.slice.call(arguments);return e=n[0],t=n.slice(1,n.length-1),r=n[n.length-1],new s(e,t,r)}},{"./lib/backoff":51,"./lib/function_call.js":52,"./lib/strategy/exponential":53,"./lib/strategy/fibonacci":54}],51:[function(e,t,r){function n(e){i.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var i=e("events"),o=e("precond");e("util").inherits(n,i.EventEmitter),n.prototype.failAfter=function(e){o.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},n.prototype.backoff=function(e){o.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},n.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},n.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=n},{events:201,precond:208,util:235}],52:[function(e,t,r){function n(e,t,r){i.EventEmitter.call(this),o.checkIsFunction(e,"Expected fn to be a function."),o.checkIsArray(t,"Expected args to be an array."),o.checkIsFunction(r,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=r,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=n.DEFAULT_RETRY_PREDICATE_,this.state_=n.State_.PENDING}
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var i=e("events"),o=e("precond"),s=e("util"),a=e("./backoff"),u=e("./strategy/fibonacci");s.inherits(n,i.EventEmitter),n.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},n.DEFAULT_RETRY_PREDICATE_=function(e){return!0},n.prototype.isPending=function(){return this.state_==n.State_.PENDING},n.prototype.isRunning=function(){return this.state_==n.State_.RUNNING},n.prototype.isCompleted=function(){return this.state_==n.State_.COMPLETED},n.prototype.isAborted=function(){return this.state_==n.State_.ABORTED},n.prototype.setStrategy=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},n.prototype.retryIf=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},n.prototype.getLastResult=function(){return this.lastResult_.concat()},n.prototype.getNumRetries=function(){return this.numRetries_},n.prototype.failAfter=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},n.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=n.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},n.prototype.start=function(e){o.checkState(!this.isAborted(),"FunctionCall is aborted."),o.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new u;this.backoff_=e?e(t):new a(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=n.State_.RUNNING,this.doCall_(!1)},n.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);i.EventEmitter.prototype.emit.apply(this,t);var r=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(r))},n.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},n.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,i.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=n.State_.COMPLETED,this.doCallback_())}},n.prototype.handleBackoff_=function(e,t,r){this.emit("backoff",e,t,r)},t.exports=n},{"./backoff":51,"./strategy/fibonacci":54,events:201,precond:208,util:235}],53:[function(e,t,r){function n(e){s.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=n.DEFAULT_FACTOR,e&&void 0!==e.factor&&(o.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var i=e("util"),o=e("precond"),s=e("./strategy");i.inherits(n,s),n.DEFAULT_FACTOR=2,n.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},n.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=n},{"./strategy":55,precond:208,util:235}],54:[function(e,t,r){function n(e){o.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var i=e("util"),o=e("./strategy");i.inherits(n,o),n.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},n.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=n},{"./strategy":55,util:235}],55:[function(e,t,r){function n(e){return void 0!==e&&null!==e}function i(e){if(e=e||{},n(e.initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(n(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(n(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
e("events"),e("util");i.prototype.getMaxDelay=function(){return this.maxDelay_},i.prototype.getInitialDelay=function(){return this.initialDelay_},i.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},i.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},i.prototype.reset=function(){this.reset_()},i.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=i},{events:201,util:235}],56:[function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return 3*e.length/4-n(e)}function o(e){var t,r,i,o,s,a=e.length;o=n(e),s=new f(3*a/4-o),r=o>0?a-4:a;var u=0;for(t=0;t<r;t+=4)i=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],s[u++]=i>>16&255,s[u++]=i>>8&255,s[u++]=255&i;return 2===o?(i=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,s[u++]=255&i):1===o&&(i=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,s[u++]=i>>8&255,s[u++]=255&i),s}function s(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function a(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(s(n));return i.join("")}function u(e){for(var t,r=e.length,n=r%3,i="",o=[],s=0,u=r-n;s<u;s+=16383)o.push(a(e,s,s+16383>u?u:s+16383));return 1===n?(t=e[r-1],i+=c[t>>2],i+=c[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=c[t>>10],i+=c[t>>4&63],i+=c[t<<2&63],i+="="),o.push(i),o.join("")}r.byteLength=i,r.toByteArray=o,r.fromByteArray=u;for(var c=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,d=h.length;p<d;++p)c[p]=h[p],l[h.charCodeAt(p)]=p;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],57:[function(t,r,n){(function(i,o){/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2017 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
!function(t){if("object"==typeof n&&void 0!==r)r.exports=t();else if("function"==typeof e&&e.amd)e([],t);else{var i;"undefined"!=typeof window?i=window:void 0!==o?i=o:"undefined"!=typeof self&&(i=self),i.Promise=t()}}(function(){var e,r,n;return function e(r,n,i){function o(a,u){if(!n[a]){if(!r[a]){var c="function"==typeof t&&t;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[a]={exports:{}};r[a][0].call(f.exports,function(e){var t=r[a][1][e];return o(t||e)},f,f.exports,e,r,n,i)}return n[a].exports}for(var s="function"==typeof t&&t,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,r){"use strict";t.exports=function(e){function t(e){var t=new r(e),n=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),n}var r=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,r){"use strict";function n(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=c}function o(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()}function s(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()}function a(e){this._normalQueue._pushOne(e),this._queueTick()}var u;try{throw new Error}catch(e){u=e}var c=e("./schedule"),l=e("./queue"),f=e("./util");n.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},n.prototype.hasCustomScheduler=function(){return this._customScheduler},n.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},n.prototype.disableTrampolineIfNecessary=function(){f.hasDevTools&&(this._trampolineEnabled=!1)},n.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},n.prototype.fatalError=function(e,t){t?(i.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),i.exit(2)):this.throwLater(e)},n.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},f.hasDevTools?(n.prototype.invokeLater=function(e,t,r){this._trampolineEnabled?o.call(this,e,t,r):this._schedule(function(){setTimeout(function(){e.call(t,r)},100)})},n.prototype.invoke=function(e,t,r){this._trampolineEnabled?s.call(this,e,t,r):this._schedule(function(){e.call(t,r)})},n.prototype.settlePromises=function(e){this._trampolineEnabled?a.call(this,e):this._schedule(function(){e._settlePromises()})}):(n.prototype.invokeLater=o,n.prototype.invoke=s,n.prototype.settlePromises=a),n.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var r=e.shift(),n=e.shift();t.call(r,n)}else t._settlePromises()}},n.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},n.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},n.prototype._reset=function(){this._isTickUsed=!1},t.exports=n,t.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=n.propagateFromFunction(),e.prototype._boundValue=n.boundValueFunction());var c=r(o),l=new e(t);l._propagateFrom(this,1);var f=this._target();if(l._setBoundTo(c),c instanceof e){var h={promiseRejectionQueued:!1,promise:l,target:f,bindingPromise:c};f._then(t,s,void 0,l,h),c._then(a,u,void 0,l,h),l._setOnCancel(c)}else l._resolveCallback(f);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,r){return e.resolve(r).bind(t)}}},{}],4:[function(e,t,r){"use strict";function n(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=n,t.exports=o},{"./promise":22}],5:[function(e,t,r){"use strict";var n=Object.create;if(n){var i=n(null),o=n(null);i[" size"]=o[" size"]=0}t.exports=function(t){function r(e,r){var n;if(null!=e&&(n=e[r]),"function"!=typeof n){var i="Object "+a.classString(e)+" has no method '"+a.toString(r)+"'";throw new t.TypeError(i)}return n}function n(e){return r(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var s,a=e("./util"),u=a.canEvaluate;a.isIdentifier;t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(n,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t,r="number"==typeof e;if(r)t=o;else if(u){var n=s(e);t=null!==n?n:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){var o=e("./util"),s=o.tryCatch,a=o.errorObj,u=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var r=e._cancellationParent;if(null==r||!r._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=r}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var r=0;r<e.length;++r)this._doInvokeOnCancel(e[r],t);else if(void 0!==e)if("function"==typeof e){if(!t){var n=s(e).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),u.throwLater(n.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,r){"use strict";t.exports=function(t){function r(e,r,a){return function(u){var c=a._boundValue();e:for(var l=0;l<e.length;++l){var f=e[l];if(f===Error||null!=f&&f.prototype instanceof Error){if(u instanceof f)return o(r).call(c,u)}else if("function"==typeof f){var h=o(f).call(c,u);if(h===s)return h;if(h)return o(r).call(c,u)}else if(n.isObject(u)){for(var p=i(f),d=0;d<p.length;++d){var _=p[d];if(f[_]!=u[_])continue e}return o(r).call(c,u)}}return t}}var n=e("./util"),i=e("./es5").keys,o=n.tryCatch,s=n.errorObj;return r}},{"./es5":13,"./util":36}],8:[function(e,t,r){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(n())}function r(){if(i)return new t}function n(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=r,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var r=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,u=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=r,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=u,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=n,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e,t){return{promise:t}}function o(){return!1}function s(e,t,r){var n=this;try{e(t,r,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+U.toString(e));n._attachCancellationCallback(e)})}catch(e){return e}}function a(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?U.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function u(){return this._onCancelField}function c(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function f(e,t){if(0!=(1&t)){this._cancellationParent=e;var r=e._branchesRemainingToCancel;void 0===r&&(r=0),e._branchesRemainingToCancel=r+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function p(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function d(){this._trace=new I(this._peekContext())}function _(e,t){if(B(e)){var r=this._trace;if(void 0!==r&&t&&(r=r._parent),void 0!==r)r.attachExtraTrace(e);else if(!e.__stackCleaned__){var n=C(e);U.notEnumerableProp(e,"stack",n.message+"\n"+n.stack.join("\n")),U.notEnumerableProp(e,"__stackCleaned__",!0)}}}function v(e,t,r,n,i){if(void 0===e&&null!==t&&X){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&n._bitField))return;r&&(r+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),u=w(a),c=u.length-1;c>=0;--c){var l=u[c];if(!z.test(l)){var f=l.match(W);f&&(o="at "+f[1]+":"+f[2]+":"+f[3]+" ");break}}if(u.length>0)for(var h=u[0],c=0;c<a.length;++c)if(a[c]===h){c>0&&(s="\n"+a[c-1]);break}}var p="a promise was created in a "+r+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;n._warn(p,!0,t)}}function m(e,t){var r=e+" is deprecated and will be removed in a future version.";return t&&(r+=" Use "+t+" instead."),y(r)}function y(e,r,n){if(se.warnings){var i,o=new N(e);if(r)n._attachExtraTrace(o);else if(se.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var s=C(o);o.stack=s.message+"\n"+s.stack.join("\n")}te("warning",o)||j(o,"",!0)}}function b(e,t){for(var r=0;r<t.length-1;++r)t[r].push("From previous event:"),t[r]=t[r].join("\n");return r<t.length&&(t[r]=t[r].join("\n")),e+"\n"+t.join("\n")}function g(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function k(e){for(var t=e[0],r=1;r<e.length;++r){for(var n=e[r],i=t.length-1,o=t[i],s=-1,a=n.length-1;a>=0;--a)if(n[a]===o){s=a;break}for(var a=s;a>=0;--a){var u=n[a];if(t[i]!==u)break;t.pop(),i--}t=n}}function w(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],i="    (No stack trace)"===n||V.test(n),o=i&&ne(n);i&&!o&&(G&&" "!==n.charAt(0)&&(n="    "+n),t.push(n))}return t}function x(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),r=0;r<t.length;++r){var n=t[r];if("    (No stack trace)"===n||V.test(n))break}return r>0&&"SyntaxError"!=e.name&&(t=t.slice(r)),t}function C(e){var t=e.stack,r=e.toString();return t="string"==typeof t&&t.length>0?x(e):["    (No stack trace)"],{message:r,stack:"SyntaxError"==e.name?t:w(t)}}function j(e,t,r){if("undefined"!=typeof console){var n;if(U.isObject(e)){var i=e.stack;n=t+H(i,e)}else n=t+String(e);"function"==typeof F?F(n,r):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function E(e,t,r,n){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(n):t(r,n))}catch(e){L.throwLater(e)}"unhandledRejection"===e?te(e,r,n)||i||j(r,"Unhandled rejection "):te(e,n)}function S(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?e.toString():U.toString(e);if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+T(t)+">, no stack trace)"}function T(e){return e.length<41?e:e.substr(0,38)+"..."}function R(){return"function"==typeof oe}function A(e){var t=e.match(ie);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function O(e,t){if(R()){for(var r,n,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,u=0;u<i.length;++u){var c=A(i[u]);if(c){r=c.fileName,s=c.line;break}}for(var u=0;u<o.length;++u){var c=A(o[u]);if(c){n=c.fileName,a=c.line;break}}s<0||a<0||!r||!n||r!==n||s>=a||(ne=function(e){if(q.test(e))return!0;var t=A(e);return!!(t&&t.fileName===r&&s<=t.line&&t.line<=a)})}}function I(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);oe(this,I),t>32&&this.uncycle()}var P,M,F,D=t._getDomain,L=t._async,N=e("./errors").Warning,U=e("./util"),B=U.canAttachTrace,q=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,z=/\((?:timers\.js):\d+:\d+\)/,W=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,V=null,H=null,G=!1,Q=!(0==U.env("BLUEBIRD_DEBUG")),K=!(0==U.env("BLUEBIRD_WARNINGS")||!Q&&!U.env("BLUEBIRD_WARNINGS")),$=!(0==U.env("BLUEBIRD_LONG_STACK_TRACES")||!Q&&!U.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=U.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(K||!!U.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){E("rejectionHandled",P,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),E("unhandledRejection",M,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,r){return y(e,t,r||this)},t.onPossiblyUnhandledRejection=function(e){var t=D();M="function"==typeof e?null===t?e:U.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=D();P="function"==typeof e?null===t?e:U.domainBind(t,e):void 0};var J=function(){};t.longStackTraces=function(){if(L.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!se.longStackTraces&&R()){var e=t.prototype._captureStackTrace,n=t.prototype._attachExtraTrace;se.longStackTraces=!0,J=function(){if(L.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=n,r.deactivateLongStackTraces(),L.enableTrampoline(),se.longStackTraces=!1},t.prototype._captureStackTrace=d,t.prototype._attachExtraTrace=_,r.activateLongStackTraces(),L.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return se.longStackTraces&&R()};var Y=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return U.global.dispatchEvent(e),function(e,t){var r=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!U.global.dispatchEvent(r)}}if("function"==typeof Event){var e=new Event("CustomEvent");return U.global.dispatchEvent(e),function(e,t){var r=new Event(e.toLowerCase(),{cancelable:!0});return r.detail=t,!U.global.dispatchEvent(r)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),U.global.dispatchEvent(e),function(e,t){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e.toLowerCase(),!1,!0,t),!U.global.dispatchEvent(r)}}catch(e){}return function(){return!1}}(),Z=function(){return U.isNode?function(){return i.emit.apply(i,arguments)}:U.global?function(e){var t="on"+e.toLowerCase(),r=U.global[t];return!!r&&(r.apply(U.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),ee={promiseCreated:n,promiseFulfilled:n,promiseRejected:n,promiseResolved:n,promiseCancelled:n,promiseChained:function(e,t,r){return{promise:t,child:r}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,r){return{reason:t,promise:r}},rejectionHandled:n},te=function(e){var t=!1;try{t=Z.apply(null,arguments)}catch(e){L.throwLater(e),t=!0}var r=!1;try{r=Y(e,ee[e].apply(null,arguments))}catch(e){L.throwLater(e),r=!0}return r||t};t.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&J()),"warnings"in e){var r=e.warnings;se.warnings=!!r,X=se.warnings,U.isObject(r)&&"wForgottenReturn"in r&&(X=!!r.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!se.cancellation){if(L.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=l,t.prototype._propagateFrom=f,t.prototype._onCancel=u,t.prototype._setOnCancel=c,t.prototype._attachCancellationCallback=a,t.prototype._execute=s,re=f,se.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!se.monitoring?(se.monitoring=!0,t.prototype._fireEvent=te):!e.monitoring&&se.monitoring&&(se.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,r){try{e(t,r)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var re=h,ne=function(){return!1},ie=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;U.inherits(I,Error),r.CapturedTrace=I,I.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],r={},n=0,i=this;void 0!==i;++n)t.push(i),i=i._parent;e=this._length=n;for(var n=e-1;n>=0;--n){var o=t[n].stack;void 0===r[o]&&(r[o]=n)}for(var n=0;n<e;++n){var s=t[n].stack,a=r[s];if(void 0!==a&&a!==n){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[n]._parent=void 0,t[n]._length=1;var u=n>0?t[n-1]:this;a<e-1?(u._parent=t[a+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var c=u._length+1,l=n-2;l>=0;--l)t[l]._length=c,c++;return}}}},I.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=C(e),r=t.message,n=[t.stack],i=this;void 0!==i;)n.push(w(i.stack.split("\n"))),i=i._parent;k(n),g(n),U.notEnumerableProp(e,"stack",b(r,n)),U.notEnumerableProp(e,"__stackCleaned__",!0)}};var oe=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():S(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,V=e,H=t;var r=Error.captureStackTrace;return ne=function(e){return q.test(e)},function(e,t){Error.stackTraceLimit+=6,r(e,t),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return V=/@/,H=t,G=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in n||!i||"number"!=typeof Error.stackTraceLimit?(H=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?S(t):t.toString()},null):(V=e,H=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(F=function(e){console.warn(e)},U.isNode&&i.stderr.isTTY?F=function(e,t){var r=t?"\x1b[33m":"\x1b[31m";console.warn(r+e+"\x1b[0m\n")}:U.isNode||"string"!=typeof(new Error).stack||(F=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var se={warnings:K,longStackTraces:!1,cancellation:!1,monitoring:!1};return $&&t.longStackTraces(),{longStackTraces:function(){return se.longStackTraces},warnings:function(){return se.warnings},cancellation:function(){return se.cancellation},monitoring:function(){return se.monitoring},propagateFromFunction:function(){return re},boundValueFunction:function(){return p},checkForgottenReturns:v,setBounds:O,warn:y,deprecated:m,CapturedTrace:I,fireDomEvent:Y,fireGlobalEvent:Z}}},{"./errors":12,"./util":36}],10:[function(e,t,r){"use strict";t.exports=function(e){function t(){return this.value}function r(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(r){return r instanceof e&&r.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:r},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(r,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:e},void 0);var t=arguments[1],n=function(){throw t};return this.caught(e,n)},e.prototype.catchReturn=function(r){if(arguments.length<=1)return r instanceof e&&r.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:r},void 0);var n=arguments[1];n instanceof e&&n.suppressUnhandledRejections();var i=function(){return n};return this.caught(r,i)}}},{}],11:[function(e,t,r){"use strict";t.exports=function(e,t){function r(){return o(this)}function n(e,r){return i(e,r,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(r,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,n){return i(e,n,t,0)._then(r,void 0,void 0,e,void 0)},e.mapSeries=n}},{}],12:[function(e,t,r){"use strict";function n(e,t){function r(n){if(!(this instanceof r))return new r(n);f(this,"message","string"==typeof n?n:t),f(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(r,Error),r}function i(e){if(!(this instanceof i))return new i(e);f(this,"name","OperationalError"),f(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(f(this,"message",e.message),f(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,s,a=e("./es5"),u=a.freeze,c=e("./util"),l=c.inherits,f=c.notEnumerableProp,h=n("Warning","warning"),p=n("CancellationError","cancellation error"),d=n("TimeoutError","timeout error"),_=n("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(e){o=n("TypeError","type error"),s=n("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<v.length;++m)"function"==typeof Array.prototype[v[m]]&&(_.prototype[v[m]]=Array.prototype[v[m]]);a.defineProperty(_.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),_.prototype.isOperational=!0;var y=0;_.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];n=i.join("\n"),t+=n+"\n"}return y--,t},l(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:p,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:_}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(e,t,r){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(r&&!r.writable&&!r.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var r in e)i.call(e,r)&&t.push(r);return t},u=function(e,t){return{value:e[t]}},c=function(e,t,r){return e[t]=r.value,e},l=function(e){return e},f=function(e){try{return Object(e).constructor.prototype}catch(e){return s}},h=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:h,keys:a,names:a,defineProperty:c,getDescriptor:u,freeze:l,getPrototypeOf:f,isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,r){"use strict";t.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)},e.filter=function(e,n,i){return r(e,n,i,t)}}},{}],15:[function(e,t,r){"use strict";t.exports=function(t,r,n){function i(e,t,r){this.promise=e,this.type=t,this.handler=r,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function s(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function a(){return c.call(this,this.promise._target()._settledValue())}function u(e){if(!s(this,e))return h.e=e,h}function c(e){var i=this.promise,c=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?c.call(i._boundValue()):c.call(i._boundValue(),e);if(l===n)return l;if(void 0!==l){i._setReturnedNonUndefined();var p=r(l,i);if(p instanceof t){if(null!=this.cancelPromise){if(p._isCancelled()){var d=new f("late cancellation observer");return i._attachExtraTrace(d),h.e=d,h}p.isPending()&&p._attachCancellationCallback(new o(this))}return p._then(a,u,void 0,this,void 0)}}}return i.isRejected()?(s(this),h.e=e,h):(s(this),e)}var l=e("./util"),f=t.CancellationError,h=l.errorObj,p=e("./catch_filter")(n);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){s(this.finallyHandler)},t.prototype._passThrough=function(e,t,r,n){return"function"!=typeof e?this.then():this._then(r,n,void 0,new i(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,c,c)},t.prototype.tap=function(e){return this._passThrough(e,1,c)},t.prototype.tapCatch=function(e){var r=arguments.length;if(1===r)return this._passThrough(e,1,void 0,c);var n,i=new Array(r-1),o=0;for(n=0;n<r-1;++n){var s=arguments[n];if(!l.isObject(s))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+l.classString(s)));i[o++]=s}i.length=o;var a=arguments[n];return this._passThrough(p(i,a,this),1,void 0,c)},i}},{"./catch_filter":7,"./util":36}],16:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e,r,n){for(var o=0;o<r.length;++o){n._pushContext();var s=p(r[o])(e);if(n._popContext(),s===h){n._pushContext();var a=t.reject(h.e);return n._popContext(),a}var u=i(s,n);if(u instanceof t)return u}return null}function u(e,r,i,o){if(s.cancellation()){var a=new t(n),u=this._finallyPromise=new t(n);this._promise=a.lastly(function(){return u}),a._captureStackTrace(),a._setOnCancel(this)}else{(this._promise=new t(n))._captureStackTrace()}this._stack=o,this._generatorFunction=e,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(d):d,this._yieldedPromise=null,this._cancellationPhase=!1}var c=e("./errors"),l=c.TypeError,f=e("./util"),h=f.errorObj,p=f.tryCatch,d=[];f.inherits(u,o),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,r=void 0!==this._generator.return;if(r)this._promise._pushContext(),e=p(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=p(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},u.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=p(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=p(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(e){var r=this._promise;if(e===h)return this._cleanup(),this._cancellationPhase?r.cancel():r._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?r.cancel():r._resolveCallback(n);var o=i(n,this._promise);if(!(o instanceof t)&&null===(o=a(o,this._yieldHandlers,this._promise)))return void this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var s=o._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n")
;var r=Object(t).yieldHandler,n=u,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new n(void 0,void 0,r,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+f.classString(e));d.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new u(e,this),i=n.promise();return n._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){var a=e("./util");a.canEvaluate,a.tryCatch,a.errorObj;t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var n}var i=[].slice.call(arguments);e&&i.pop();var n=new r(i).promise();return void 0!==e?n.spread(e):n}}},{"./util":36}],18:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e,t,r,n){this.constructor$(e),this._promise._captureStackTrace();var i=c();this._callback=null===i?t:l.domainBind(i,t),this._preservedValues=n===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=[],p.invoke(this._asyncInit,this,void 0)}function u(e,r,i,o){if("function"!=typeof r)return n("expecting a function but got "+l.classString(r));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+l.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+l.classString(i.concurrency)));s=i.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(e,r,s,o).promise()}var c=t._getDomain,l=e("./util"),f=l.tryCatch,h=l.errorObj,p=t._async;l.inherits(a,r),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,r){var n=this._values,o=this.length(),a=this._preservedValues,u=this._limit;if(r<0){if(r=-1*r-1,n[r]=e,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return n[r]=e,this._queue.push(r),!1;null!==a&&(a[r]=e);var c=this._promise,l=this._callback,p=c._boundValue();c._pushContext();var d=f(l).call(p,e,r,o),_=c._popContext();if(s.checkForgottenReturns(d,_,null!==a?"Promise.filter":"Promise.map",c),d===h)return this._reject(d.e),!0;var v=i(d,this._promise);if(v instanceof t){v=v._target();var m=v._bitField;if(0==(50397184&m))return u>=1&&this._inFlight++,n[r]=v,v._proxy(this,-1*(r+1)),!1;if(0==(33554432&m))return 0!=(16777216&m)?(this._reject(v._reason()),!0):(this._cancel(),!0);d=v._value()}n[r]=d}return++this._totalResolved>=o&&(null!==a?this._filter(n,a):this._resolve(n),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}},a.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),i=0,o=0;o<r;++o)e[o]&&(n[i++]=t[o]);n.length=i,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,r,n){return u(e,t,r,n)}}},{"./util":36}],19:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var n=new t(r);n._captureStackTrace(),n._pushContext();var i=a(e).apply(this,arguments),s=n._popContext();return o.checkForgottenReturns(i,s,"Promise.method",n),n._resolveFromSyncValue(i),n}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+s.classString(e));var n=new t(r);n._captureStackTrace(),n._pushContext();var u;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];u=s.isArray(c)?a(e).apply(l,c):a(e).call(l,c)}else u=a(e)();var f=n._popContext();return o.checkForgottenReturns(u,f,"Promise.try",n),n._resolveFromSyncValue(u),n},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,r){"use strict";function n(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(n(e)){t=new c(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var r=l.keys(e),i=0;i<r.length;++i){var o=r[i];f.test(o)||(t[o]=e[o])}return t}return s.markAsOriginatingFromRejection(e),e}function o(e,t){return function(r,n){if(null!==e){if(r){var o=i(a(r));e._attachExtraTrace(o),e._reject(o)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(n);e=null}}}var s=e("./util"),a=s.maybeWrapAsError,u=e("./errors"),c=u.OperationalError,l=e("./es5"),f=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,r){"use strict";t.exports=function(t){function r(e,t){var r=this;if(!o.isArray(e))return n.call(r,e,t);var i=a(t).apply(r._boundValue(),[null].concat(e));i===u&&s.throwLater(i.e)}function n(e,t){var r=this,n=r._boundValue(),i=void 0===e?a(t).call(n,null):a(t).call(n,null,e);i===u&&s.throwLater(i.e)}function i(e,t){var r=this;if(!e){var n=new Error(e+"");n.cause=e,e=n}var i=a(t).call(r._boundValue(),e);i===u&&s.throwLater(i.e)}var o=e("./util"),s=t._async,a=o.tryCatch,u=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=n;void 0!==t&&Object(t).spread&&(o=r),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,r){"use strict";t.exports=function(){function r(){}function n(e,t){if(null==e||e.constructor!==o)throw new b("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new b("expecting a function but got "+d.classString(t))}function o(e){e!==k&&n(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function s(e){this.promise._resolveCallback(e)}function a(e){this.promise._rejectCallback(e,!1)}function u(e){var t=new o(k);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var c,l=function(){return new b("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},f=function(){return new o.PromiseInspection(this._target())},h=function(e){return o.reject(new b(e))},p={},d=e("./util");c=d.isNode?function(){var e=i.domain;return void 0===e&&(e=null),e}:function(){return null},d.notEnumerableProp(o,"_getDomain",c);var _=e("./es5"),v=e("./async"),m=new v;_.defineProperty(o,"_async",{value:m});var y=e("./errors"),b=o.TypeError=y.TypeError;o.RangeError=y.RangeError;var g=o.CancellationError=y.CancellationError;o.TimeoutError=y.TimeoutError,o.OperationalError=y.OperationalError,o.RejectionError=y.OperationalError,o.AggregateError=y.AggregateError;var k=function(){},w={},x={},C=e("./thenables")(o,k),j=e("./promise_array")(o,k,C,h,r),E=e("./context")(o),S=E.create,T=e("./debuggability")(o,E),R=(T.CapturedTrace,e("./finally")(o,C,x)),A=e("./catch_filter")(x),O=e("./nodeback"),I=d.errorObj,P=d.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype.catch=function(e){var t=arguments.length;if(t>1){var r,n=new Array(t-1),i=0;for(r=0;r<t-1;++r){var o=arguments[r];if(!d.isObject(o))return h("Catch statement predicate: expecting an object but got "+d.classString(o));n[i++]=o}return n.length=i,e=arguments[r],this.then(void 0,A(n,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(f,f,void 0,this,void 0)},o.prototype.then=function(e,t){if(T.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+d.classString(e);arguments.length>1&&(r+=", "+d.classString(t)),this._warn(r)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},o.prototype.spread=function(e){return"function"!=typeof e?h("expecting a function but got "+d.classString(e)):this.all()._then(e,void 0,void 0,w,void 0)},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new j(this).promise()},o.prototype.error=function(e){return this.caught(d.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(k);t._captureStackTrace();var r=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=P(e)(O(t,r));return n===I&&t._rejectCallback(n.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new j(e).promise()},o.cast=function(e){var t=C(e);return t instanceof o||(t=new o(k),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(k);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if("function"!=typeof e)throw new b("expecting a function but got "+d.classString(e));return m.setScheduler(e)},o.prototype._then=function(e,t,r,n,i){var s=void 0!==i,a=s?i:new o(k),u=this._target(),l=u._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var f=c();if(0!=(50397184&l)){var h,p,_=u._settlePromiseCtx;0!=(33554432&l)?(p=u._rejectionHandler0,h=e):0!=(16777216&l)?(p=u._fulfillmentHandler0,h=t,u._unsetRejectionIsUnhandled()):(_=u._settlePromiseLateCancellationObserver,p=new g("late cancellation observer"),u._attachExtraTrace(p),h=t),m.invoke(_,u,{handler:null===f?h:"function"==typeof h&&d.domainBind(f,h),promise:a,receiver:n,value:p})}else u._addCallbacks(e,t,a,n,f);return a},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==p)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),r=e._rejectionHandler0,n=e._promise0,i=e._receiverAt(0);void 0===i&&(i=p),this._addCallbacks(t,r,n,i,null)},o.prototype._migrateCallbackAt=function(e,t){var r=e._fulfillmentHandlerAt(t),n=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=p),this._addCallbacks(r,n,i,o,null)},o.prototype._addCallbacks=function(e,t,r,n,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=r,this._receiver0=n,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:d.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:d.domainBind(i,t));else{var s=4*o-4;this[s+2]=r,this[s+3]=n,"function"==typeof e&&(this[s+0]=null===i?e:d.domainBind(i,e)),"function"==typeof t&&(this[s+1]=null===i?t:d.domainBind(i,t))}return this._setLength(o+1),o},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var r=C(e,this);if(!(r instanceof o))return this._fulfill(e);t&&this._propagateFrom(r,2);var n=r._target();if(n===this)return void this._reject(l());var i=n._bitField;if(0==(50397184&i)){var s=this._length();s>0&&n._migrateCallback0(this);for(var a=1;a<s;++a)n._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!=(33554432&i))this._fulfill(n._value());else if(0!=(16777216&i))this._reject(n._reason());else{var u=new g("late cancellation observer");n._attachExtraTrace(u),this._reject(u)}}},o.prototype._rejectCallback=function(e,t,r){var n=d.ensureErrorObject(e),i=n===e;if(!i&&!r&&T.warnings()){var o="a promise was rejected with a non-error: "+d.classString(e);this._warn(o,!0)}this._attachExtraTrace(n,!!t&&i),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==k){var t=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,r)});r=!1,this._popContext(),void 0!==n&&t._rejectCallback(n,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,r,n){var i=n._bitField;if(0==(65536&i)){n._pushContext();var o;t===w?r&&"number"==typeof r.length?o=P(e).apply(this._boundValue(),r):(o=I,o.e=new b("cannot .spread() a non-array: "+d.classString(r))):o=P(e).call(t,r);var s=n._popContext();i=n._bitField,0==(65536&i)&&(o===x?n._reject(r):o===I?n._rejectCallback(o.e,!1):(T.checkForgottenReturns(o,s,"",n,this),n._resolveCallback(o)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,n,i){var s=e instanceof o,a=this._bitField,u=0!=(134217728&a);0!=(65536&a)?(s&&e._invokeInternalOnCancel(),n instanceof R&&n.isFinallyHandler()?(n.cancelPromise=e,P(t).call(n,i)===I&&e._reject(I.e)):t===f?e._fulfill(f.call(n)):n instanceof r?n._promiseCancelled(e):s||e instanceof j?e._cancel():n.cancel()):"function"==typeof t?s?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,i,e)):t.call(n,i,e):n instanceof r?n._isResolved()||(0!=(33554432&a)?n._promiseFulfilled(i,e):n._promiseRejected(i,e)):s&&(u&&e._setAsyncGuaranteed(),0!=(33554432&a)?e._fulfill(i):e._reject(i))},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,r=e.promise,n=e.receiver,i=e.value;"function"==typeof t?r instanceof o?this._settlePromiseFromHandler(t,n,i,r):t.call(n,i,r):r instanceof o&&r._reject(i)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t,r){var n=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,e,i,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var r=l();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():m.settlePromises(this))}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return m.fatalError(e,d.isNode);(65535&t)>0?m.settlePromises(this):this._ensurePossibleRejectionHandled()}},o.prototype._fulfillPromises=function(e,t){for(var r=1;r<e;r++){var n=this._fulfillmentHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},o.prototype._rejectPromises=function(e,t){for(var r=1;r<e;r++){var n=this._rejectionHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,e),this._rejectPromises(t,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,e),this._fulfillPromises(t,n)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){return T.deprecated("Promise.defer","new Promise"),{promise:new o(k),resolve:s,reject:a}},d.notEnumerableProp(o,"_makeSelfResolutionError",l),e("./method")(o,k,C,h,T),e("./bind")(o,k,C,T),e("./cancel")(o,j,h,T),e("./direct_resolve")(o),e("./synchronous_inspection")(o),e("./join")(o,j,C,k,m,c),o.Promise=o,o.version="3.5.1",e("./map.js")(o,j,h,C,k,T),e("./call_get.js")(o),e("./using.js")(o,h,C,S,k,T),e("./timers.js")(o,k,T),e("./generators.js")(o,h,k,C,r,T),e("./nodeify.js")(o),e("./promisify.js")(o,k),e("./props.js")(o,j,C,h),e("./race.js")(o,k,C,h),e("./reduce.js")(o,j,h,C,k,T),e("./settle.js")(o,j,T),e("./some.js")(o,j,h),e("./filter.js")(o,k),e("./each.js")(o,k),e("./any.js")(o),d.toFastProperties(o),d.toFastProperties(o.prototype),u({a:1}),u({b:2}),u({c:3}),u(1),u(function(){}),u(void 0),u(!1),u(new o(k)),T.setBounds(v.firstLineError,d.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o){function s(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function a(e){var n=this._promise=new t(r);e instanceof t&&n._propagateFrom(e,3),n._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=e("./util");u.isArray;return u.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(r,o){var a=n(this._values,this._promise);if(a instanceof t){a=a._target();var c=a._bitField;if(this._values=a,0==(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(null===(a=u.asArray(a))){var l=i("expecting an array or an iterable object but got "+u.classString(a)).reason();return void this._promise._rejectCallback(l,!1)}if(0===a.length)return void(-5===o?this._resolveEmptyArray():this._resolve(s(o)));this._iterate(a)},a.prototype._iterate=function(e){var r=this.getActualLength(e.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<r;++a){var u=n(e[a],i);u instanceof t?(u=u._target(),s=u._bitField):s=null,o?null!==s&&u.suppressUnhandledRejections():null!==s?0==(50397184&s)?(u._proxy(this,a),this._values[a]=u):o=0!=(33554432&s)?this._promiseFulfilled(u._value(),a):0!=(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(u,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var r=0;r<e.length;++r)e[r]instanceof t&&e[r].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e){return!k.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,r){var n=p.getDataPropertyOrDefault(e,t+r,b);return!!n&&i(n)}function s(e,t,r){for(var n=0;n<e.length;n+=2){var i=e[n];if(r.test(i))for(var o=i.replace(r,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,r,n){for(var a=p.inheritedDataKeys(e),u=[],c=0;c<a.length;++c){var l=a[c],f=e[l],h=n===w||w(l,f,e);"function"!=typeof f||i(f)||o(e,l,t)||!n(l,f,e,h)||u.push(l,f)}return s(u,t,r),u}function u(e,n,i,o,s,a){function u(){var i=n;n===h&&(i=this);var o=new t(r);o._captureStackTrace();var s="string"==typeof l&&this!==c?this[l]:e,u=d(o,a);try{s.apply(i,_(arguments,u))}catch(e){o._rejectCallback(v(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),l=e;return"string"==typeof l&&(e=o),p.notEnumerableProp(u,"__isPromisified__",!0),u}function c(e,t,r,n,i){for(var o=new RegExp(x(t)+"$"),s=a(e,t,o,r),u=0,c=s.length;u<c;u+=2){var l=s[u],f=s[u+1],d=l+t;if(n===C)e[d]=C(l,h,l,f,t,i);else{var _=n(f,function(){return C(l,h,l,f,t,i)});p.notEnumerableProp(_,"__isPromisified__",!0),e[d]=_}}return p.toFastProperties(e),e}function l(e,t,r){return C(e,t,void 0,e,null,r)}var f,h={},p=e("./util"),d=e("./nodeback"),_=p.withAppended,v=p.maybeWrapAsError,m=p.canEvaluate,y=e("./errors").TypeError,b={__isPromisified__:!0},g=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],k=new RegExp("^(?:"+g.join("|")+")$"),w=function(e){return p.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},x=function(e){return e.replace(/([$])/,"\\$")},C=m?f:u;t.promisify=function(e,t){if("function"!=typeof e)throw new y("expecting a function but got "+p.classString(e));if(i(e))return e;t=Object(t);var r=void 0===t.context?h:t.context,o=!!t.multiArgs,s=l(e,r,o);return p.copyDescriptors(e,s,n),s},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var r=!!t.multiArgs,n=t.suffix;"string"!=typeof n&&(n="Async");var i=t.filter;"function"!=typeof i&&(i=w);var o=t.promisifier;if("function"!=typeof o&&(o=C),!p.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=p.inheritedDataKeys(e),a=0;a<s.length;++a){var u=e[s[a]];"constructor"!==s[a]&&p.isClass(u)&&(c(u.prototype,n,i,o,r),c(u,n,i,o,r))}return c(e,n,i,o,r)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){function o(e){var t,r=!1;if(void 0!==a&&e instanceof a)t=f(e),r=!0;else{var n=l.keys(e),i=n.length;t=new Array(2*i);for(var o=0;o<i;++o){var s=n[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=r,this._init$(void 0,r?-6:-3)}function s(e){var r,s=n(e);return c(s)?(r=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof t&&r._propagateFrom(s,2),r):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,u=e("./util"),c=u.isObject,l=e("./es5");"function"==typeof Map&&(a=Map);var f=function(){function e(e,n){this[t]=e,this[t+r]=n,t++}var t=0,r=0;return function(n){r=n.size,t=0;var i=new Array(2*n.size);return n.forEach(e,i),i}}(),h=function(e){for(var t=new a,r=e.length/2|0,n=0;n<r;++n){var i=e[r+n],o=e[n];t.set(i,o)}return t};u.inherits(o,r),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var r;if(this._isMap)r=h(this._values);else{r={};for(var n=this.length(),i=0,o=this.length();i<o;++i)r[this._values[i+n]]=this._values[i]}return this._resolve(r),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,r){"use strict";function n(e,t,r,n,i){for(var o=0;o<i;++o)r[o+n]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=r,this._length=n},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,n(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,r){"use strict";t.exports=function(t,r,n,i){function o(e,o){var u=n(e);if(u instanceof t)return a(u);if(null===(e=s.asArray(e)))return i("expecting an array or an iterable object but got "+s.classString(e));var c=new t(r);void 0!==o&&c._propagateFrom(o,3);for(var l=c._fulfill,f=c._reject,h=0,p=e.length;h<p;++h){var d=e[h];(void 0!==d||h in e)&&t.cast(d)._then(l,f,void 0,c,null)}return c}var s=e("./util"),a=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e,r,n,i){this.constructor$(e);var s=h();this._fn=null===s?r:p.domainBind(s,r),void 0!==n&&(n=t.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,r,i){return"function"!=typeof t?n("expecting a function but got "+p.classString(t)):new a(e,t,r,i).promise()}function l(e){this.accum=e,this.array._gotAccum(e);var r=i(this.value,this.array._promise);return r instanceof t?(this.array._currentCancellable=r,r._then(f,void 0,void 0,this,void 0)):f.call(this,r)}function f(e){var r=this.array,n=r._promise,i=d(r._fn);n._pushContext();var o;(o=void 0!==r._eachValues?i.call(n._boundValue(),e,this.index,this.length):i.call(n._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(r._currentCancellable=o);var a=n._popContext();return s.checkForgottenReturns(o,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",n),o}var h=t._getDomain,p=e("./util"),d=p.tryCatch;p.inherits(a,r),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},a.prototype._iterate=function(e){this._values=e;var r,n,i=e.length;if(void 0!==this._initialValue?(r=this._initialValue,n=0):(r=t.resolve(e[0]),n=1),this._currentCancellable=r,!r.isRejected())for(;n<i;++n){var o={accum:null,value:e[n],index:n,length:i,array:this};r=r._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},t.prototype.reduce=function(e,t){return c(this,e,t,null)},t.reduce=function(e,t,r,n){return c(e,t,r,n)}}},{"./util":36}],29:[function(e,t,r){"use strict";var n,s=e("./util"),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},u=s.getNativePromise();if(s.isNode&&"undefined"==typeof MutationObserver){var c=o.setImmediate,l=i.nextTick;n=s.isRecentNode?function(e){c.call(o,e)}:function(e){l.call(i,e)}}else if("function"==typeof u&&"function"==typeof u.resolve){var f=u.resolve();n=function(e){f.then(e)}}else n="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:a:function(){var e=document.createElement("div"),t={attributes:!0},r=!1,n=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),r=!1}).observe(n,t);var i=function(){r||(r=!0,n.classList.toggle("foo"))};return function(r){var n=new MutationObserver(function(){n.disconnect(),r()});n.observe(e,t),i()}}();t.exports=n},{"./util":36}],30:[function(e,t,r){"use strict";t.exports=function(t,r,n){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,r),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var r=new o;return r._bitField=33554432,r._settledValueField=e,this._promiseResolved(t,r)},i.prototype._promiseRejected=function(e,t){var r=new o;return r._bitField=16777216,r._settledValueField=e,this._promiseResolved(t,r)},t.settle=function(e){return n.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,r){"use strict";t.exports=function(t,r,n){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var r=new i(e),o=r.promise();return r.setHowMany(t),r.init(),o}var s=e("./util"),a=e("./errors").RangeError,u=e("./errors").AggregateError,c=s.isArray,l={};s.inherits(i,r),
i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new u,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,r){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var r=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return r.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),n.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e,n){if(l(e)){if(e instanceof t)return e;var i=o(e);if(i===c){n&&n._pushContext();var u=t.reject(i.e);return n&&n._popContext(),u}if("function"==typeof i){if(s(e)){var u=new t(r);return e._then(u._fulfill,u._reject,void 0,u,null),u}return a(e,i,n)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return c.e=e,c}}function s(e){try{return f.call(e,"_promise0")}catch(e){return!1}}function a(e,n,i){function o(e){a&&(a._resolveCallback(e),a=null)}function s(e){a&&(a._rejectCallback(e,f,!0),a=null)}var a=new t(r),l=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var f=!0,h=u.tryCatch(n).call(e,o,s);return f=!1,a&&h===c&&(a._rejectCallback(h.e,!0,!0),a=null),l}var u=e("./util"),c=u.errorObj,l=u.isObject,f={}.hasOwnProperty;return n}},{"./util":36}],34:[function(e,t,r){"use strict";t.exports=function(t,r,n){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function s(e){throw clearTimeout(this.handle),e}var a=e("./util"),u=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,o){var s,a;return void 0!==o?(s=t.resolve(o)._then(c,null,null,e,void 0),n.cancellation()&&o instanceof t&&s._setOnCancel(o)):(s=new t(r),a=setTimeout(function(){s._fulfill()},+e),n.cancellation()&&s._setOnCancel(new i(a)),s._captureStackTrace()),s._setAsyncGuaranteed(),s};t.prototype.delay=function(e){return l(e,this)};var f=function(e,t,r){var n;n="string"!=typeof t?t instanceof Error?t:new u("operation timed out"):new u(t),a.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._reject(n),null!=r&&r.cancel()};t.prototype.timeout=function(e,t){e=+e;var r,a,u=new i(setTimeout(function(){r.isPending()&&f(r,t,a)},e));return n.cancellation()?(a=this.then(),r=a._then(o,s,void 0,u,void 0),r._setOnCancel(u)):r=this._then(o,s,void 0,u,void 0),r}}},{"./util":36}],35:[function(e,t,r){"use strict";t.exports=function(t,r,n,i,o,s){function a(e){setTimeout(function(){throw e},0)}function u(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function c(e,r){function i(){if(s>=c)return l._fulfill();var o=u(e[s++]);if(o instanceof t&&o._isDisposable()){try{o=n(o._getDisposer().tryDispose(r),e.promise)}catch(e){return a(e)}if(o instanceof t)return o._then(i,a,null,null,null)}i()}var s=0,c=e.length,l=new t(o);return i(),l}function l(e,t,r){this._data=e,this._promise=t,this._context=r}function f(e,t,r){this.constructor$(e,t,r)}function h(e){return l.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function p(e){this.length=e,this.promise=null,this[e-1]=null}var d=e("./util"),_=e("./errors").TypeError,v=e("./util").inherits,m=d.errorObj,y=d.tryCatch,b={};l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():b},l.prototype.tryDispose=function(e){var t=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=t!==b?this.doDispose(t,e):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},l.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},v(f,l),f.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},p.prototype._resultCancelled=function(){for(var e=this.length,r=0;r<e;++r){var n=this[r];n instanceof t&&n.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return r("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return r("expecting a function but got "+d.classString(i));var o,a=!0;2===e&&Array.isArray(arguments[0])?(o=arguments[0],e=o.length,a=!1):(o=arguments,e--);for(var u=new p(e),f=0;f<e;++f){var _=o[f];if(l.isDisposer(_)){var v=_;_=_.promise(),_._setDisposable(v)}else{var b=n(_);b instanceof t&&(_=b._then(h,null,null,{resources:u,index:f},void 0))}u[f]=_}for(var g=new Array(u.length),f=0;f<g.length;++f)g[f]=t.resolve(u[f]).reflect();var k=t.all(g).then(function(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.isRejected())return m.e=r.error(),m;if(!r.isFulfilled())return void k.cancel();e[t]=r.value()}w._pushContext(),i=y(i);var n=a?i.apply(void 0,e):i(e),o=w._popContext();return s.checkForgottenReturns(n,o,"Promise.using",w),n}),w=k.lastly(function(){var e=new t.PromiseInspection(k);return c(u,e)});return u.promise=w,w._setOnCancel(u),w},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new f(e,this,i());throw new _}}},{"./errors":12,"./util":36}],36:[function(e,t,r){"use strict";function n(){try{var e=O;return O=null,e.apply(this,arguments)}catch(e){return A.e=e,A}}function s(e){return O=e,n}function a(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function u(e){return"function"==typeof e||"object"==typeof e&&null!==e}function c(e){return a(e)?new Error(y(e)):e}function l(e,t){var r,n=e.length,i=new Array(n+1);for(r=0;r<n;++r)i[r]=e[r];return i[r]=t,i}function f(e,t,r){if(!T.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function h(e,t,r){if(a(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return T.defineProperty(e,t,n),e}function p(e){throw e}function d(e){try{if("function"==typeof e){var t=T.names(e.prototype),r=T.isES5&&t.length>1,n=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=F.test(e+"")&&T.names(e).length>0;if(r||n||i)return!0}return!1}catch(e){return!1}}function _(e){function t(){}t.prototype=e;for(var r=8;r--;)new t;return e}function v(e){return D.test(e)}function m(e,t,r){for(var n=new Array(e),i=0;i<e;++i)n[i]=t+i+r;return n}function y(e){try{return e+""}catch(e){return"[no string representation]"}}function b(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function g(e){try{h(e,"isOperational",!0)}catch(e){}}function k(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function w(e){return b(e)&&T.propertyIsWritable(e,"stack")}function x(e){return{}.toString.call(e)}function C(e,t,r){for(var n=T.names(e),i=0;i<n.length;++i){var o=n[i];if(r(o))try{T.defineProperty(t,o,T.getDescriptor(e,o))}catch(e){}}}function j(e){return q?i.env[e]:void 0}function E(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function S(e,t){return e.bind(t)}var T=e("./es5"),R="undefined"==typeof navigator,A={e:{}},O,I="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==o?o:void 0!==this?this:null,P=function(e,t){function r(){this.constructor=e,this.constructor$=t;for(var r in t.prototype)n.call(t.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=t.prototype[r])}var n={}.hasOwnProperty;return r.prototype=t.prototype,e.prototype=new r,e.prototype},M=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1};if(T.isES5){var r=Object.getOwnPropertyNames;return function(e){for(var n=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=r(e)}catch(e){return n}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var u=Object.getOwnPropertyDescriptor(e,a);null!=u&&null==u.get&&null==u.set&&n.push(a)}}e=T.getPrototypeOf(e)}return n}}var n={}.hasOwnProperty;return function(r){if(t(r))return[];var i=[];e:for(var o in r)if(n.call(r,o))i.push(o);else{for(var s=0;s<e.length;++s)if(n.call(e[s],o))continue e;i.push(o)}return i}}(),F=/this\s*\.\s*\S+\s*=/,D=/^[a-z$_][a-z$_0-9]*$/i,L=function(){return"stack"in new Error?function(e){return w(e)?e:new Error(y(e))}:function(e){if(w(e))return e;try{throw new Error(y(e))}catch(e){return e}}}(),N=function(e){return T.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var U="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,r=[],n=e[Symbol.iterator]();!(t=n.next()).done;)r.push(t.value);return r};N=function(e){return T.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?U(e):null}}var B=void 0!==i&&"[object process]"===x(i).toLowerCase(),q=void 0!==i&&void 0!==i.env,z={isClass:d,isIdentifier:v,inheritedDataKeys:M,getDataPropertyOrDefault:f,thrower:p,isArray:T.isArray,asArray:N,notEnumerableProp:h,isPrimitive:a,isObject:u,isError:b,canEvaluate:R,errorObj:A,tryCatch:s,inherits:P,withAppended:l,maybeWrapAsError:c,toFastProperties:_,filledRange:m,toString:y,canAttachTrace:w,ensureErrorObject:L,originatesFromRejection:k,markAsOriginatingFromRejection:g,classString:x,copyDescriptors:C,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:B,hasEnvVariables:q,env:j,global:I,getNativePromise:E,domainBind:S};z.isRecentNode=z.isNode&&function(){var e=i.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),z.isNode&&z.toFastProperties(i);try{throw new Error}catch(e){z.lastLineError=e}t.exports=z},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:211}],58:[function(e,t,r){(function(){var r,n,i,o=function(e,t){return function(){return e.apply(t,arguments)}},s=[].slice;i=10,n=5,r=function(){function t(e,r,n,i,s){this.maxNb=null!=e?e:0,this.minTime=null!=r?r:0,this.highWater=null!=n?n:-1,this.strategy=null!=i?i:t.prototype.strategy.LEAK,this.rejectOnDrop=null!=s&&s,this.schedulePriority=o(this.schedulePriority,this),this.submitPriority=o(this.submitPriority,this),this.submit=o(this.submit,this),this._nextRequest=Date.now(),this._nbRunning=0,this._queues=this._makeQueues(),this._running={},this._nextIndex=0,this._unblockTime=0,this.penalty=15*this.minTime||5e3,this.interrupt=!1,this.reservoir=null,this.limiter=null,this.events={}}var r;return t.default=t,t.strategy=t.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},t.Cluster=t.prototype.Cluster=e("./Cluster"),t.DLList=t.prototype.DLList=e("./DLList"),t.Promise=t.prototype.Promise=function(){try{return e("bluebird")}catch(e){return r=e,"undefined"!=typeof Promise&&null!==Promise?Promise:function(){throw new Error("Bottleneck: install 'bluebird' or use Node 0.12 or higher for Promise support")}}}(),t.prototype._trigger=function(e,t){return this.rejectOnDrop&&"dropped"===e&&t[0].cb.apply({},[new Error("This job has been dropped by Bottleneck")]),setTimeout(function(r){return function(){var n;return null!=(n=r.events[e])?n.forEach(function(e){return e.apply({},t)}):void 0}}(this),0)},t.prototype._makeQueues=function(){var e,r,n;for(n=[],e=1,r=i;1<=r?e<=r:e>=r;1<=r?++e:--e)n.push(new t.prototype.DLList);return n},t.prototype.chain=function(e){return this.limiter=e,this},t.prototype.isBlocked=function(){return this._unblockTime>=Date.now()},t.prototype._sanitizePriority=function(e){var t;return t=~~e!==e?n:e,t<0?0:t>i-1?i-1:t},t.prototype._find=function(e,t){var r,n,i,o;for(r=n=0,i=e.length;n<i;r=++n)if(o=e[r],t(o))return o;return[]},t.prototype.nbQueued=function(e){return null!=e?this._queues[this._sanitizePriority(e)].length:this._queues.reduce(function(e,t){return e+t.length},0)},t.prototype.nbRunning=function(){return this._nbRunning},t.prototype._getFirst=function(e){return this._find(e,function(e){return e.length>0})},t.prototype._conditionsCheck=function(){return(this.nbRunning()<this.maxNb||this.maxNb<=0)&&(null==this.reservoir||this.reservoir>0)},t.prototype.check=function(){return this._conditionsCheck()&&this._nextRequest-Date.now()<=0},t.prototype._tryToRun=function(){var e,t,r,n,i;return!!(this._conditionsCheck()&&(n=this.nbQueued())>0)&&(this._nbRunning++,null!=this.reservoir&&this.reservoir--,i=Math.max(this._nextRequest-Date.now(),0),this._nextRequest=Date.now()+i+this.minTime,r=this._getFirst(this._queues).shift(),1===n&&this._trigger("empty",[]),e=!1,t=this._nextIndex++,this._running[t]={timeout:setTimeout(function(n){return function(){var i;return i=function(){var i;if(!e&&(e=!0,delete n._running[t],n._nbRunning--,n._tryToRun(),0===n.nbRunning()&&0===n.nbQueued()&&n._trigger("idle",[]),!n.interrupt))return null!=(i=r.cb)?i.apply({},Array.prototype.slice.call(arguments,0)):void 0},null!=n.limiter?n.limiter.submit.apply(n.limiter,Array.prototype.concat(r.task,r.args,i)):r.task.apply({},r.args.concat(i))}}(this),i),job:r},!0)},t.prototype.submit=function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],this.submitPriority.apply({},Array.prototype.concat(n,e))},t.prototype.submitPriority=function(){var e,r,n,i,o,a,u,c;return o=arguments[0],c=arguments[1],e=4<=arguments.length?s.call(arguments,2,n=arguments.length-1):(n=2,[]),r=arguments[n++],i={task:c,args:e,cb:r},o=this._sanitizePriority(o),a=this.highWater>=0&&this.nbQueued()===this.highWater&&!this.check(),this.strategy===t.prototype.strategy.BLOCK&&(a||this.isBlocked())?(this._unblockTime=Date.now()+this.penalty,this._nextRequest=this._unblockTime+this.minTime,this._queues=this._makeQueues(),this._trigger("dropped",[i]),!0):a&&(u=this.strategy===t.prototype.strategy.LEAK?this._getFirst(this._queues.slice(o).reverse()).shift():this.strategy===t.prototype.strategy.OVERFLOW_PRIORITY?this._getFirst(this._queues.slice(o+1).reverse()).shift():this.strategy===t.prototype.strategy.OVERFLOW?i:void 0,null!=u&&this._trigger("dropped",[u]),null==u||this.strategy===t.prototype.strategy.OVERFLOW)?a:(this._queues[o].push(i),this._tryToRun(),a)},t.prototype.schedule=function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],this.schedulePriority.apply({},Array.prototype.concat(n,e))},t.prototype.schedulePriority=function(){var e,r,n,i;return r=arguments[0],n=arguments[1],e=3<=arguments.length?s.call(arguments,2):[],i=function(){var e,t,r;return e=2<=arguments.length?s.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],n.apply({},e).then(function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],t.apply({},Array.prototype.concat(null,e))}).catch(function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],t.apply({},e)})},new t.prototype.Promise(function(t){return function(n,o){return t.submitPriority.apply({},Array.prototype.concat(r,i,e,function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],(null!=e[0]?o:(e.shift(),n)).apply({},e)}))}}(this))},t.prototype.changeSettings=function(e,t,r,n,i){for(this.maxNb=null!=e?e:this.maxNb,this.minTime=null!=t?t:this.minTime,this.highWater=null!=r?r:this.highWater,this.strategy=null!=n?n:this.strategy,this.rejectOnDrop=null!=i?i:this.rejectOnDrop;this._tryToRun(););return this},t.prototype.changePenalty=function(e){return this.penalty=null!=e?e:this.penalty,this},t.prototype.changeReservoir=function(e){for(this.reservoir=e;this._tryToRun(););return this},t.prototype.incrementReservoir=function(e){return null==e&&(e=0),this.changeReservoir(this.reservoir+e),this},t.prototype.on=function(e,t){return null!=this.events[e]?this.events[e].push(t):this.events[e]=[t],this},t.prototype.removeAllListeners=function(e){return null==e&&(e=null),null!=e?delete this.events[e]:this.events={},this},t.prototype.stopAll=function(e){var t,r,n,i,o,a,u;for(this.interrupt=null!=e?e:this.interrupt,i=Object.keys(this._running),t=0,a=i.length;t<a;t++)n=i[t],clearTimeout(this._running[n].timeout);if(this._tryToRun=function(){},this.check=function(){return!1},this.submit=this.submitPriority=function(){var e;return 2<=arguments.length?s.call(arguments,0,e=arguments.length-1):(e=0,[]),(0,arguments[e++])(new Error("This limiter is stopped"))},this.schedule=this.schedulePriority=function(){return Promise.reject(new Error("This limiter is stopped"))},this.interrupt)for(o=0,u=i.length;o<u;o++)n=i[o],this._trigger("dropped",[this._running[n].job]);for(;r=this._getFirst(this._queues).shift();)this._trigger("dropped",[r]);return this._trigger("empty",[]),0===this.nbRunning()&&this._trigger("idle",[]),this},t}(),t.exports=r}).call(this)},{"./Cluster":59,"./DLList":60,bluebird:57}],59:[function(e,t,r){(function(){var r,n={}.hasOwnProperty;r=function(){function t(t,r,n,i,o){this.maxNb=t,this.minTime=r,this.highWater=n,this.strategy=i,this.rejectOnDrop=o,this.limiters={},this.Bottleneck=e("./Bottleneck"),this.timeout=3e5,this.startAutoCleanup()}return t.prototype.key=function(e){var t;return null==e&&(e=""),null!=(t=this.limiters[e])?t:this.limiters[e]=new this.Bottleneck(this.maxNb,this.minTime,this.highWater,this.strategy,this.rejectOnDrop)},t.prototype.deleteKey=function(e){return null==e&&(e=""),delete this.limiters[e]},t.prototype.all=function(e){var t,r,i,o;r=this.limiters,i=[];for(t in r)n.call(r,t)&&(o=r[t],i.push(e(o)));return i},t.prototype.keys=function(){return Object.keys(this.limiters)},t.prototype.startAutoCleanup=function(){var e;return this.stopAutoCleanup(),"function"==typeof(e=this.interval=setInterval(function(e){return function(){var t,r,n,i,o;i=Date.now(),r=e.limiters,n=[];for(t in r)o=r[t],o._nextRequest+e.timeout<i?n.push(e.deleteKey(t)):n.push(void 0);return n}}(this),this.timeout/10)).unref?e.unref():void 0},t.prototype.stopAutoCleanup=function(){return clearInterval(this.interval)},t.prototype.changeTimeout=function(e){return this.timeout=e,this.startAutoCleanup()},t}(),t.exports=r}).call(this)},{"./Bottleneck":58}],60:[function(e,t,r){(function(){var e;e=function(){function e(){this._first=null,this._last=null,this.length=0}return e.prototype.push=function(e){var t;this.length++,t={value:e,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t},e.prototype.shift=function(){var e,t;if(null!=this._first)return this.length--,t=this._first.value,this._first=null!=(e=this._first.next)?e:this._last=null,t},e.prototype.getArray=function(){var e,t,r;for(e=this._first,r=[];null!=e;)r.push((t=e,e=e.next,t.value));return r},e}(),t.exports=e}).call(this)},{}],61:[function(e,t,r){(function(r){(function(){t.exports=e("./Bottleneck"),null!=r.window&&(r.window.Bottleneck=t.exports)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Bottleneck":58}],62:[function(e,t,r){},{}],63:[function(e,t,r){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";function n(e){if(e>$)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=i.prototype,t}function i(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(e)}return o(e,t,r)}function o(e,t,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return H(e)||e&&H(e.buffer)?f(e,t,r):"string"==typeof e?c(e,t):h(e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('"size" argument must not be negative')}function a(e,t,r){return s(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}function u(e){return s(e),n(e<0?0:0|p(e))}function c(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!i.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|_(e,t),o=n(r),s=o.write(e,t);return s!==r&&(o=o.slice(0,s)),o}function l(e){for(var t=e.length<0?0:0|p(e.length),r=n(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),n.__proto__=i.prototype,n}function h(e){if(i.isBuffer(e)){var t=0|p(e.length),r=n(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||G(e.length)?n(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}function p(e){if(e>=$)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+$.toString(16)+" bytes");return 0|e}function d(e){return+e!=e&&(e=0),i.alloc(+e)}function _(e,t){if(i.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||H(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function v(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,r);case"utf8":case"utf-8":return S(this,t,r);case"ascii":return R(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return E(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,G(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=i.from(t,n)),i.isBuffer(t))return 0===t.length?-1:b(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):b(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function b(e,t,r,n,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}var c;if(i){var l=-1;for(c=r;c<a;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*s}else-1!==l&&(c-=c-l),l=-1}else for(r+u>a&&(r=a-u),c=r;c>=0;c--){for(var f=!0,h=0;h<u;h++)if(o(e,c+h)!==o(t,h)){f=!1;break}if(f)return c}return-1}function g(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(G(a))return s;e[r+s]=a}return s}function k(e,t,r,n){return V(B(t,e.length-r),e,r,n)}function w(e,t,r,n){return V(q(t),e,r,n)}function x(e,t,r,n){return w(e,t,r,n)}function C(e,t,r,n){return V(W(t),e,r,n)}function j(e,t,r,n){return V(z(t,e.length-r),e,r,n)}function E(e,t,r){return 0===t&&r===e.length?Q.fromByteArray(e):Q.fromByteArray(e.slice(t,r))}function S(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=r){var u,c,l,f;switch(a){case 1:o<128&&(s=o);break;case 2:u=e[i+1],128==(192&u)&&(f=(31&o)<<6|63&u)>127&&(s=f);break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c)>2047&&(f<55296||f>57343)&&(s=f);break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&f<1114112&&(s=f)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=a}return T(n)}function T(e){var t=e.length;if(t<=X)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=X));return r}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function O(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=U(e[o]);return i}function I(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function P(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,r,n,o,s){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function F(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,n,i){return t=+t,r>>>=0,i||F(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),K.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,i){return t=+t,r>>>=0,i||F(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),K.write(e,t,r,n,52,8),r+8}function N(e){if(e=e.split("=")[0],e=e.trim().replace(J,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function q(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function z(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}function W(e){return Q.toByteArray(N(e))}function V(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function H(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function G(e){return e!==e}var Q=e("base64-js"),K=e("ieee754");r.Buffer=i,r.SlowBuffer=d,r.INSPECT_MAX_BYTES=50;var $=2147483647;r.kMaxLength=$,i.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(i.prototype,"parent",{get:function(){if(this instanceof i)return this.buffer}}),Object.defineProperty(i.prototype,"offset",{get:function(){if(this instanceof i)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(e,t,r){return o(e,t,r)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,t,r){return a(e,t,r)},i.allocUnsafe=function(e){return u(e)},i.allocUnsafeSlow=function(e){return u(e)},i.isBuffer=function(e){return null!=e&&!0===e._isBuffer},i.compare=function(e,t){if(!i.isBuffer(e)||!i.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,s=Math.min(r,n);o<s;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=i.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var s=e[r];if(ArrayBuffer.isView(s)&&(s=i.from(s)),!i.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,o),o+=s.length}return n},i.byteLength=_,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},i.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},i.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},i.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):v.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(e){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===i.compare(this,e)},i.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},i.prototype.compare=function(e,t,r,n,o){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,o>>>=0,this===e)return 0;for(var s=o-n,a=r-t,u=Math.min(s,a),c=this.slice(n,o),l=e.slice(t,r),f=0;f<u;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return s<a?-1:a<s?1:0},i.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},i.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},i.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},i.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return k(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return x(this,e,t,r);case"base64":return C(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var X=4096;i.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=i.prototype,n},i.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},i.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},i.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},i.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},i.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},i.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},i.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},i.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),K.read(this,e,!0,23,4)},i.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),K.read(this,e,!1,23,4)},i.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),K.read(this,e,!0,52,8)},i.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),K.read(this,e,!1,52,8)},i.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){M(this,e,t,r,Math.pow(2,8*r)-1,0)}var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},i.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){M(this,e,t,r,Math.pow(2,8*r)-1,0)}var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},i.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,255,0),this[t]=255&e,t+1},i.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},i.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},i.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},i.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},i.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},i.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},i.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},i.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},i.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},i.prototype.copy=function(e,t,r,n){if(!i.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=o-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return o},i.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!i.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var o=e.charCodeAt(0);("utf8"===n&&o<128||"latin1"===n)&&(e=o)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var a=i.isBuffer(e)?e:new i(e,n),u=a.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=a[s%u]}return this};var J=/[^+\/0-9A-Za-z-_]/g},{"base64-js":56,ieee754:202}],64:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":97,"../../modules/es6.array.from":170,"../../modules/es6.string.iterator":185}],65:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":168,"../modules/es6.string.iterator":185,"../modules/web.dom.iterable":197}],66:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":169,"../modules/es6.string.iterator":185,"../modules/web.dom.iterable":197}],67:[function(e,t,r){var n=e("../../modules/_core"),i=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(e){return i.stringify.apply(i,arguments)}},{"../../modules/_core":97}],68:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),e("../modules/es7.map.of"),e("../modules/es7.map.from"),t.exports=e("../modules/_core").Map},{"../modules/_core":97,"../modules/es6.map":172,"../modules/es6.object.to-string":181,"../modules/es6.string.iterator":185,"../modules/es7.map.from":187,"../modules/es7.map.of":188,"../modules/es7.map.to-json":189,"../modules/web.dom.iterable":197}],69:[function(e,t,r){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":97,"../../modules/es6.object.assign":173}],70:[function(e,t,r){e("../../modules/es6.object.create");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.create(e,t)}},{"../../modules/_core":97,"../../modules/es6.object.create":174}],71:[function(e,t,r){e("../../modules/es6.object.define-properties");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.defineProperties(e,t)}},{"../../modules/_core":97,"../../modules/es6.object.define-properties":175}],72:[function(e,t,r){e("../../modules/es6.object.define-property");var n=e("../../modules/_core").Object;t.exports=function(e,t,r){return n.defineProperty(e,t,r)}},{"../../modules/_core":97,"../../modules/es6.object.define-property":176}],73:[function(e,t,r){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":97,"../../modules/es6.object.freeze":177}],74:[function(e,t,r){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":97,"../../modules/es6.object.get-prototype-of":178}],75:[function(e,t,r){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":97,"../../modules/es6.object.keys":179}],76:[function(e,t,r){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":97,"../../modules/es6.object.set-prototype-of":180}],77:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":97,"../modules/es6.object.to-string":181,"../modules/es6.promise":182,"../modules/es6.string.iterator":185,"../modules/es7.promise.finally":190,"../modules/es7.promise.try":191,"../modules/web.dom.iterable":197}],78:[function(e,t,r){e("../../modules/es6.reflect.construct"),t.exports=e("../../modules/_core").Reflect.construct},{"../../modules/_core":97,"../../modules/es6.reflect.construct":183}],79:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.set"),e("../modules/es7.set.to-json"),e("../modules/es7.set.of"),e("../modules/es7.set.from"),t.exports=e("../modules/_core").Set},{"../modules/_core":97,"../modules/es6.object.to-string":181,"../modules/es6.set":184,"../modules/es6.string.iterator":185,"../modules/es7.set.from":192,"../modules/es7.set.of":193,"../modules/es7.set.to-json":194,"../modules/web.dom.iterable":197}],80:[function(e,t,r){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":97,"../../modules/es6.object.to-string":181,"../../modules/es6.symbol":186,"../../modules/es7.symbol.async-iterator":195,"../../modules/es7.symbol.observable":196}],81:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":165,"../../modules/es6.string.iterator":185,"../../modules/web.dom.iterable":197}],82:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],83:[function(e,t,r){t.exports=function(){}},{}],84:[function(e,t,r){t.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},{}],85:[function(e,t,r){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":117}],86:[function(e,t,r){var n=e("./_for-of");t.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},{"./_for-of":107}],87:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_to-length"),o=e("./_to-absolute-index");t.exports=function(e){return function(t,r,s){var a,u=n(t),c=i(u.length),l=o(s,c);if(e&&r!=r){for(;c>l;)if((a=u[l++])!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===r)return e||l||0;return!e&&-1}}},{"./_to-absolute-index":156,"./_to-iobject":158,"./_to-length":159}],88:[function(e,t,r){var n=e("./_ctx"),i=e("./_iobject"),o=e("./_to-object"),s=e("./_to-length"),a=e("./_array-species-create");t.exports=function(e,t){var r=1==e,u=2==e,c=3==e,l=4==e,f=6==e,h=5==e||f,p=t||a;return function(t,a,d){for(var _,v,m=o(t),y=i(m),b=n(a,d,3),g=s(y.length),k=0,w=r?p(t,g):u?p(t,0):void 0;g>k;k++)if((h||k in y)&&(_=y[k],v=b(_,k,m),e))if(r)w[k]=v;else if(v)switch(e){case 3:return!0;case 5:return _;case 6:return k;case 2:w.push(_)}else if(l)return!1;return f?-1:c||l?l:w}}},{"./_array-species-create":90,"./_ctx":99,"./_iobject":114,"./_to-length":159,"./_to-object":160}],89:[function(e,t,r){var n=e("./_is-object"),i=e("./_is-array"),o=e("./_wks")("species");t.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":116,"./_is-object":117,"./_wks":166}],90:[function(e,t,r){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":89}],91:[function(e,t,r){"use strict";var n=e("./_a-function"),i=e("./_is-object"),o=e("./_invoke"),s=[].slice,a={},u=function(e,t,r){if(!(t in a)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";a[t]=Function("F,a","return new F("+n.join(",")+")")}return a[t](e,r)};t.exports=Function.bind||function(e){var t=n(this),r=s.call(arguments,1),a=function(){var n=r.concat(s.call(arguments));return this instanceof a?u(t,n.length,n):o(t,n,e)};return i(t.prototype)&&(a.prototype=t.prototype),a}},{"./_a-function":82,"./_invoke":113,"./_is-object":117}],92:[function(e,t,r){var n=e("./_cof"),i=e("./_wks")("toStringTag"),o="Arguments"==n(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(e){}};t.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=s(t=Object(e),i))?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},{"./_cof":93,"./_wks":166}],93:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],94:[function(e,t,r){"use strict";var n=e("./_object-dp").f,i=e("./_object-create"),o=e("./_redefine-all"),s=e("./_ctx"),a=e("./_an-instance"),u=e("./_for-of"),c=e("./_iter-define"),l=e("./_iter-step"),f=e("./_set-species"),h=e("./_descriptors"),p=e("./_meta").fastKey,d=e("./_validate-collection"),_=h?"_s":"size",v=function(e,t){var r,n=p(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};t.exports={getConstructor:function(e,t,r,c){var l=e(function(e,n){a(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[_]=0,void 0!=n&&u(n,r,e[c],e)});return o(l.prototype,{clear:function(){for(var e=d(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[_]=0},delete:function(e){var r=d(this,t),n=v(r,e);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[_]--}return!!n},forEach:function(e){d(this,t);for(var r,n=s(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!v(d(this,t),e)}}),h&&n(l.prototype,"size",{get:function(){return d(this,t)[_]}}),l},def:function(e,t,r){var n,i,o=v(e,t);return o?o.v=r:(e._l=o={i:i=p(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[_]++,"F"!==i&&(e._i[i]=o)),e},getEntry:v,setStrong:function(e,t,r){c(e,t,function(e,r){this._t=d(e,t),this._k=r,this._l=void 0},function(){for(var e=this,t=e._k,r=e._l;r&&r.r;)r=r.p;return e._t&&(e._l=r=r?r.n:e._t._f)?"keys"==t?l(0,r.k):"values"==t?l(0,r.v):l(0,[r.k,r.v]):(e._t=void 0,l(1))},r?"entries":"values",!r,!0),f(t)}}},{"./_an-instance":84,"./_ctx":99,"./_descriptors":101,"./_for-of":107,"./_iter-define":120,"./_iter-step":122,"./_meta":125,"./_object-create":129,"./_object-dp":130,"./_redefine-all":144,"./_set-species":149,"./_validate-collection":163}],95:[function(e,t,r){var n=e("./_classof"),i=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},{"./_array-from-iterable":86,"./_classof":92}],96:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_export"),o=e("./_meta"),s=e("./_fails"),a=e("./_hide"),u=e("./_redefine-all"),c=e("./_for-of"),l=e("./_an-instance"),f=e("./_is-object"),h=e("./_set-to-string-tag"),p=e("./_object-dp").f,d=e("./_array-methods")(0),_=e("./_descriptors");t.exports=function(e,t,r,v,m,y){var b=n[e],g=b,k=m?"set":"add",w=g&&g.prototype,x={};return _&&"function"==typeof g&&(y||w.forEach&&!s(function(){(new g).entries().next()}))?(g=t(function(t,r){l(t,g,e,"_c"),t._c=new b,void 0!=r&&c(r,m,t[k],t)}),d("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in w&&(!y||"clear"!=e)&&a(g.prototype,e,function(r,n){if(l(this,g,e),!t&&y&&!f(r))return"get"==e&&void 0;var i=this._c[e](0===r?0:r,n);return t?this:i})}),y||p(g.prototype,"size",{get:function(){return this._c.size}})):(g=v.getConstructor(t,e,m,k),u(g.prototype,r),o.NEED=!0),h(g,e),x[e]=g,i(i.G+i.W+i.F,x),y||v.setStrong(g,e,m),g}},{"./_an-instance":84,"./_array-methods":88,"./_descriptors":101,"./_export":105,"./_fails":106,"./_for-of":107,"./_global":108,"./_hide":110,"./_is-object":117,"./_meta":125,"./_object-dp":130,"./_redefine-all":144,"./_set-to-string-tag":150}],97:[function(e,t,r){var n=t.exports={version:"2.5.4"};"number"==typeof __e&&(__e=n)},{}],98:[function(e,t,r){"use strict";var n=e("./_object-dp"),i=e("./_property-desc");t.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},{"./_object-dp":130,"./_property-desc":143}],99:[function(e,t,r){var n=e("./_a-function");t.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":82}],100:[function(e,t,r){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],101:[function(e,t,r){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":106}],102:[function(e,t,r){var n=e("./_is-object"),i=e("./_global").document,o=n(i)&&n(i.createElement);t.exports=function(e){return o?i.createElement(e):{}}},{"./_global":108,"./_is-object":117}],103:[function(e,t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],104:[function(e,t,r){var n=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie");t.exports=function(e){var t=n(e),r=i.f
;if(r)for(var s,a=r(e),u=o.f,c=0;a.length>c;)u.call(e,s=a[c++])&&t.push(s);return t}},{"./_object-gops":135,"./_object-keys":138,"./_object-pie":139}],105:[function(e,t,r){var n=e("./_global"),i=e("./_core"),o=e("./_ctx"),s=e("./_hide"),a=e("./_has"),u=function(e,t,r){var c,l,f,h=e&u.F,p=e&u.G,d=e&u.S,_=e&u.P,v=e&u.B,m=e&u.W,y=p?i:i[t]||(i[t]={}),b=y.prototype,g=p?n:d?n[t]:(n[t]||{}).prototype;p&&(r=t);for(c in r)(l=!h&&g&&void 0!==g[c])&&a(y,c)||(f=l?g[c]:r[c],y[c]=p&&"function"!=typeof g[c]?r[c]:v&&l?o(f,n):m&&g[c]==f?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):_&&"function"==typeof f?o(Function.call,f):f,_&&((y.virtual||(y.virtual={}))[c]=f,e&u.R&&b&&!b[c]&&s(b,c,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},{"./_core":97,"./_ctx":99,"./_global":108,"./_has":109,"./_hide":110}],106:[function(e,t,r){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],107:[function(e,t,r){var n=e("./_ctx"),i=e("./_iter-call"),o=e("./_is-array-iter"),s=e("./_an-object"),a=e("./_to-length"),u=e("./core.get-iterator-method"),c={},l={},r=t.exports=function(e,t,r,f,h){var p,d,_,v,m=h?function(){return e}:u(e),y=n(r,f,t?2:1),b=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(o(m)){for(p=a(e.length);p>b;b++)if((v=t?y(s(d=e[b])[0],d[1]):y(e[b]))===c||v===l)return v}else for(_=m.call(e);!(d=_.next()).done;)if((v=i(_,y,d.value,t))===c||v===l)return v};r.BREAK=c,r.RETURN=l},{"./_an-object":85,"./_ctx":99,"./_is-array-iter":115,"./_iter-call":118,"./_to-length":159,"./core.get-iterator-method":167}],108:[function(e,t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],109:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],110:[function(e,t,r){var n=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},{"./_descriptors":101,"./_object-dp":130,"./_property-desc":143}],111:[function(e,t,r){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":108}],112:[function(e,t,r){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":101,"./_dom-create":102,"./_fails":106}],113:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},{}],114:[function(e,t,r){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":93}],115:[function(e,t,r){var n=e("./_iterators"),i=e("./_wks")("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},{"./_iterators":123,"./_wks":166}],116:[function(e,t,r){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":93}],117:[function(e,t,r){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],118:[function(e,t,r){var n=e("./_an-object");t.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},{"./_an-object":85}],119:[function(e,t,r){"use strict";var n=e("./_object-create"),i=e("./_property-desc"),o=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,r){e.prototype=n(s,{next:i(1,r)}),o(e,t+" Iterator")}},{"./_hide":110,"./_object-create":129,"./_property-desc":143,"./_set-to-string-tag":150,"./_wks":166}],120:[function(e,t,r){"use strict";var n=e("./_library"),i=e("./_export"),o=e("./_redefine"),s=e("./_hide"),a=e("./_iterators"),u=e("./_iter-create"),c=e("./_set-to-string-tag"),l=e("./_object-gpo"),f=e("./_wks")("iterator"),h=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(e,t,r,d,_,v,m){u(r,t,d);var y,b,g,k=function(e){if(!h&&e in j)return j[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},w=t+" Iterator",x="values"==_,C=!1,j=e.prototype,E=j[f]||j["@@iterator"]||_&&j[_],S=E||k(_),T=_?x?k("entries"):S:void 0,R="Array"==t?j.entries||E:E;if(R&&(g=l(R.call(new e)))!==Object.prototype&&g.next&&(c(g,w,!0),n||"function"==typeof g[f]||s(g,f,p)),x&&E&&"values"!==E.name&&(C=!0,S=function(){return E.call(this)}),n&&!m||!h&&!C&&j[f]||s(j,f,S),a[t]=S,a[w]=p,_)if(y={values:x?S:k("values"),keys:v?S:k("keys"),entries:T},m)for(b in y)b in j||o(j,b,y[b]);else i(i.P+i.F*(h||C),t,y);return y}},{"./_export":105,"./_hide":110,"./_iter-create":119,"./_iterators":123,"./_library":124,"./_object-gpo":136,"./_redefine":145,"./_set-to-string-tag":150,"./_wks":166}],121:[function(e,t,r){var n=e("./_wks")("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],s=o[n]();s.next=function(){return{done:r=!0}},o[n]=function(){return s},e(o)}catch(e){}return r}},{"./_wks":166}],122:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],123:[function(e,t,r){t.exports={}},{}],124:[function(e,t,r){t.exports=!0},{}],125:[function(e,t,r){var n=e("./_uid")("meta"),i=e("./_is-object"),o=e("./_has"),s=e("./_object-dp").f,a=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){s(e,n,{value:{i:"O"+ ++a,w:{}}})},f=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[n].i},h=function(e,t){if(!o(e,n)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[n].w},p=function(e){return c&&d.NEED&&u(e)&&!o(e,n)&&l(e),e},d=t.exports={KEY:n,NEED:!1,fastKey:f,getWeak:h,onFreeze:p}},{"./_fails":106,"./_has":109,"./_is-object":117,"./_object-dp":130,"./_uid":162}],126:[function(e,t,r){var n=e("./_global"),i=e("./_task").set,o=n.MutationObserver||n.WebKitMutationObserver,s=n.process,a=n.Promise,u="process"==e("./_cof")(s);t.exports=function(){var e,t,r,c=function(){var n,i;for(u&&(n=s.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(u)r=function(){s.nextTick(c)};else if(!o||n.navigator&&n.navigator.standalone)if(a&&a.resolve){var l=a.resolve();r=function(){l.then(c)}}else r=function(){i.call(n,c)};else{var f=!0,h=document.createTextNode("");new o(c).observe(h,{characterData:!0}),r=function(){h.data=f=!f}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},{"./_cof":93,"./_global":108,"./_task":155}],127:[function(e,t,r){"use strict";function n(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=i(t),this.reject=i(r)}
// 25.4.1.5 NewPromiseCapability(C)
var i=e("./_a-function");t.exports.f=function(e){return new n(e)}},{"./_a-function":82}],128:[function(e,t,r){"use strict";var n=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie"),s=e("./_to-object"),a=e("./_iobject"),u=Object.assign;t.exports=!u||e("./_fails")(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=u({},e)[r]||Object.keys(u({},t)).join("")!=n})?function(e,t){for(var r=s(e),u=arguments.length,c=1,l=i.f,f=o.f;u>c;)for(var h,p=a(arguments[c++]),d=l?n(p).concat(l(p)):n(p),_=d.length,v=0;_>v;)f.call(p,h=d[v++])&&(r[h]=p[h]);return r}:u},{"./_fails":106,"./_iobject":114,"./_object-gops":135,"./_object-keys":138,"./_object-pie":139,"./_to-object":160}],129:[function(e,t,r){var n=e("./_an-object"),i=e("./_object-dps"),o=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},u=function(){var t,r=e("./_dom-create")("iframe"),n=o.length;for(r.style.display="none",e("./_html").appendChild(r),r.src="javascript:",t=r.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;n--;)delete u.prototype[o[n]];return u()};t.exports=Object.create||function(e,t){var r;return null!==e?(a.prototype=n(e),r=new a,a.prototype=null,r[s]=e):r=u(),void 0===t?r:i(r,t)}},{"./_an-object":85,"./_dom-create":102,"./_enum-bug-keys":103,"./_html":111,"./_object-dps":131,"./_shared-key":151}],130:[function(e,t,r){var n=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),s=Object.defineProperty;r.f=e("./_descriptors")?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},{"./_an-object":85,"./_descriptors":101,"./_ie8-dom-define":112,"./_to-primitive":161}],131:[function(e,t,r){var n=e("./_object-dp"),i=e("./_an-object"),o=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){i(e);for(var r,s=o(t),a=s.length,u=0;a>u;)n.f(e,r=s[u++],t[r]);return e}},{"./_an-object":85,"./_descriptors":101,"./_object-dp":130,"./_object-keys":138}],132:[function(e,t,r){var n=e("./_object-pie"),i=e("./_property-desc"),o=e("./_to-iobject"),s=e("./_to-primitive"),a=e("./_has"),u=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;r.f=e("./_descriptors")?c:function(e,t){if(e=o(e),t=s(t,!0),u)try{return c(e,t)}catch(e){}if(a(e,t))return i(!n.f.call(e,t),e[t])}},{"./_descriptors":101,"./_has":109,"./_ie8-dom-define":112,"./_object-pie":139,"./_property-desc":143,"./_to-iobject":158,"./_to-primitive":161}],133:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_object-gopn").f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return i(e)}catch(e){return s.slice()}};t.exports.f=function(e){return s&&"[object Window]"==o.call(e)?a(e):i(n(e))}},{"./_object-gopn":134,"./_to-iobject":158}],134:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");r.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},{"./_enum-bug-keys":103,"./_object-keys-internal":137}],135:[function(e,t,r){r.f=Object.getOwnPropertySymbols},{}],136:[function(e,t,r){var n=e("./_has"),i=e("./_to-object"),o=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":109,"./_shared-key":151,"./_to-object":160}],137:[function(e,t,r){var n=e("./_has"),i=e("./_to-iobject"),o=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var r,a=i(e),u=0,c=[];for(r in a)r!=s&&n(a,r)&&c.push(r);for(;t.length>u;)n(a,r=t[u++])&&(~o(c,r)||c.push(r));return c}},{"./_array-includes":87,"./_has":109,"./_shared-key":151,"./_to-iobject":158}],138:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,i)}},{"./_enum-bug-keys":103,"./_object-keys-internal":137}],139:[function(e,t,r){r.f={}.propertyIsEnumerable},{}],140:[function(e,t,r){var n=e("./_export"),i=e("./_core"),o=e("./_fails");t.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",s)}},{"./_core":97,"./_export":105,"./_fails":106}],141:[function(e,t,r){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],142:[function(e,t,r){var n=e("./_an-object"),i=e("./_is-object"),o=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":85,"./_is-object":117,"./_new-promise-capability":127}],143:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],144:[function(e,t,r){var n=e("./_hide");t.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},{"./_hide":110}],145:[function(e,t,r){t.exports=e("./_hide")},{"./_hide":110}],146:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_a-function"),o=e("./_ctx"),s=e("./_for-of");t.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,a,u=arguments[1];return i(this),t=void 0!==u,t&&i(u),void 0==e?new this:(r=[],t?(n=0,a=o(u,arguments[2],2),s(e,!1,function(e){r.push(a(e,n++))})):s(e,!1,r.push,r),new this(r))}})}},{"./_a-function":82,"./_ctx":99,"./_export":105,"./_for-of":107}],147:[function(e,t,r){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":105}],148:[function(e,t,r){var n=e("./_is-object"),i=e("./_an-object"),o=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r,n){try{n=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2),n(t,[]),r=!(t instanceof Array)}catch(e){r=!0}return function(e,t){return o(e,t),r?e.__proto__=t:n(e,t),e}}({},!1):void 0),check:o}},{"./_an-object":85,"./_ctx":99,"./_is-object":117,"./_object-gopd":132}],149:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_core"),o=e("./_object-dp"),s=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":97,"./_descriptors":101,"./_global":108,"./_object-dp":130,"./_wks":166}],150:[function(e,t,r){var n=e("./_object-dp").f,i=e("./_has"),o=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},{"./_has":109,"./_object-dp":130,"./_wks":166}],151:[function(e,t,r){var n=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return n[e]||(n[e]=i(e))}},{"./_shared":152,"./_uid":162}],152:[function(e,t,r){var n=e("./_global"),i=n["__core-js_shared__"]||(n["__core-js_shared__"]={});t.exports=function(e){return i[e]||(i[e]={})}},{"./_global":108}],153:[function(e,t,r){var n=e("./_an-object"),i=e("./_a-function"),o=e("./_wks")("species");t.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||void 0==(r=n(s)[o])?t:i(r)}},{"./_a-function":82,"./_an-object":85,"./_wks":166}],154:[function(e,t,r){var n=e("./_to-integer"),i=e("./_defined");t.exports=function(e){return function(t,r){var o,s,a=String(i(t)),u=n(r),c=a.length;return u<0||u>=c?e?"":void 0:(o=a.charCodeAt(u),o<55296||o>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):o:e?a.slice(u,u+2):s-56320+(o-55296<<10)+65536)}}},{"./_defined":100,"./_to-integer":157}],155:[function(e,t,r){var n,i,o,s=e("./_ctx"),a=e("./_invoke"),u=e("./_html"),c=e("./_dom-create"),l=e("./_global"),f=l.process,h=l.setImmediate,p=l.clearImmediate,d=l.MessageChannel,_=l.Dispatch,v=0,m={},y=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},b=function(e){y.call(e.data)};h&&p||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return m[++v]=function(){a("function"==typeof e?e:Function(e),t)},n(v),v},p=function(e){delete m[e]},"process"==e("./_cof")(f)?n=function(e){f.nextTick(s(y,e,1))}:_&&_.now?n=function(e){_.now(s(y,e,1))}:d?(i=new d,o=i.port2,i.port1.onmessage=b,n=s(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):n="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),t.exports={set:h,clear:p}},{"./_cof":93,"./_ctx":99,"./_dom-create":102,"./_global":108,"./_html":111,"./_invoke":113}],156:[function(e,t,r){var n=e("./_to-integer"),i=Math.max,o=Math.min;t.exports=function(e,t){return e=n(e),e<0?i(e+t,0):o(e,t)}},{"./_to-integer":157}],157:[function(e,t,r){var n=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},{}],158:[function(e,t,r){var n=e("./_iobject"),i=e("./_defined");t.exports=function(e){return n(i(e))}},{"./_defined":100,"./_iobject":114}],159:[function(e,t,r){var n=e("./_to-integer"),i=Math.min;t.exports=function(e){return e>0?i(n(e),9007199254740991):0}},{"./_to-integer":157}],160:[function(e,t,r){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":100}],161:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":117}],162:[function(e,t,r){var n=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},{}],163:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":117}],164:[function(e,t,r){var n=e("./_global"),i=e("./_core"),o=e("./_library"),s=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},{"./_core":97,"./_global":108,"./_library":124,"./_object-dp":130,"./_wks-ext":165}],165:[function(e,t,r){r.f=e("./_wks")},{"./_wks":166}],166:[function(e,t,r){var n=e("./_shared")("wks"),i=e("./_uid"),o=e("./_global").Symbol,s="function"==typeof o;(t.exports=function(e){return n[e]||(n[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=n},{"./_global":108,"./_shared":152,"./_uid":162}],167:[function(e,t,r){var n=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[n(e)]}},{"./_classof":92,"./_core":97,"./_iterators":123,"./_wks":166}],168:[function(e,t,r){var n=e("./_an-object"),i=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},{"./_an-object":85,"./_core":97,"./core.get-iterator-method":167}],169:[function(e,t,r){var n=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(n(t))}},{"./_classof":92,"./_core":97,"./_iterators":123,"./_wks":166}],170:[function(e,t,r){"use strict";var n=e("./_ctx"),i=e("./_export"),o=e("./_to-object"),s=e("./_iter-call"),a=e("./_is-array-iter"),u=e("./_to-length"),c=e("./_create-property"),l=e("./core.get-iterator-method");i(i.S+i.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,f,h=o(e),p="function"==typeof this?this:Array,d=arguments.length,_=d>1?arguments[1]:void 0,v=void 0!==_,m=0,y=l(h);if(v&&(_=n(_,d>2?arguments[2]:void 0,2)),void 0==y||p==Array&&a(y))for(t=u(h.length),r=new p(t);t>m;m++)c(r,m,v?_(h[m],m):h[m]);else for(f=y.call(h),r=new p;!(i=f.next()).done;m++)c(r,m,v?s(f,_,[i.value,m],!0):i.value);return r.length=m,r}})},{"./_create-property":98,"./_ctx":99,"./_export":105,"./_is-array-iter":115,"./_iter-call":118,"./_iter-detect":121,"./_to-length":159,"./_to-object":160,"./core.get-iterator-method":167}],171:[function(e,t,r){"use strict";var n=e("./_add-to-unscopables"),i=e("./_iter-step"),o=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,r):"values"==t?i(0,e[r]):i(0,[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":83,"./_iter-define":120,"./_iter-step":122,"./_iterators":123,"./_to-iobject":158}],172:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":96,"./_collection-strong":94,"./_validate-collection":163}],173:[function(e,t,r){var n=e("./_export");n(n.S+n.F,"Object",{assign:e("./_object-assign")})},{"./_export":105,"./_object-assign":128}],174:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{create:e("./_object-create")})},{"./_export":105,"./_object-create":129}],175:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperties:e("./_object-dps")})},{"./_descriptors":101,"./_export":105,"./_object-dps":131}],176:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":101,"./_export":105,"./_object-dp":130}],177:[function(e,t,r){var n=e("./_is-object"),i=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(e){return function(t){return e&&n(t)?e(i(t)):t}})},{"./_is-object":117,"./_meta":125,"./_object-sap":140}],178:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return i(n(e))}})},{"./_object-gpo":136,"./_object-sap":140,"./_to-object":160}],179:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return i(n(e))}})},{"./_object-keys":138,"./_object-sap":140,"./_to-object":160}],180:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":105,"./_set-proto":148}],181:[function(e,t,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],182:[function(e,t,r){"use strict";var n,i,o,s,a=e("./_library"),u=e("./_global"),c=e("./_ctx"),l=e("./_classof"),f=e("./_export"),h=e("./_is-object"),p=e("./_a-function"),d=e("./_an-instance"),_=e("./_for-of"),v=e("./_species-constructor"),m=e("./_task").set,y=e("./_microtask")(),b=e("./_new-promise-capability"),g=e("./_perform"),k=e("./_promise-resolve"),w=u.TypeError,x=u.process,C=u.Promise,j="process"==l(x),E=function(){},S=i=b.f,T=!!function(){try{var t=C.resolve(1),r=(t.constructor={})[e("./_wks")("species")]=function(e){e(E,E)};return(j||"function"==typeof PromiseRejectionEvent)&&t.then(E)instanceof r}catch(e){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},A=function(e,t){if(!e._n){e._n=!0;var r=e._c;y(function(){for(var n=e._v,i=1==e._s,o=0;r.length>o;)!function(t){var r,o,s,a=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{a?(i||(2==e._h&&P(e),e._h=1),!0===a?r=n:(l&&l.enter(),r=a(n),l&&(l.exit(),s=!0)),r===t.promise?c(w("Promise-chain cycle")):(o=R(r))?o.call(r,u,c):u(r)):c(n)}catch(e){l&&!s&&l.exit(),c(e)}}(r[o++]);e._c=[],e._n=!1,t&&!e._h&&O(e)})}},O=function(e){m.call(u,function(){var t,r,n,i=e._v,o=I(e);if(o&&(t=g(function(){j?x.emit("unhandledRejection",i,e):(r=u.onunhandledrejection)?r({promise:e,reason:i}):(n=u.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=j||I(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},I=function(e){return 1!==e._h&&0===(e._a||e._c).length},P=function(e){m.call(u,function(){var t;j?x.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},M=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},F=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw w("Promise can't be resolved itself");(t=R(e))?y(function(){var n={_w:r,_d:!1};try{t.call(e,c(F,n,1),c(M,n,1))}catch(e){M.call(n,e)}}):(r._v=e,r._s=1,A(r,!1))}catch(e){M.call({_w:r,_d:!1},e)}}};T||(C=function(e){d(this,C,"Promise","_h"),p(e),n.call(this);try{e(c(F,this,1),c(M,this,1))}catch(e){M.call(this,e)}},n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},n.prototype=e("./_redefine-all")(C.prototype,{then:function(e,t){var r=S(v(this,C));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=j?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=c(F,e,1),this.reject=c(M,e,1)},b.f=S=function(e){return e===C||e===s?new o(e):i(e)}),f(f.G+f.W+f.F*!T,{Promise:C}),e("./_set-to-string-tag")(C,"Promise"),e("./_set-species")("Promise"),s=e("./_core").Promise,f(f.S+f.F*!T,"Promise",{reject:function(e){var t=S(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(a||!T),"Promise",{resolve:function(e){return k(a&&this===s?C:this,e)}}),f(f.S+f.F*!(T&&e("./_iter-detect")(function(e){C.all(e).catch(E)})),"Promise",{all:function(e){var t=this,r=S(t),n=r.resolve,i=r.reject,o=g(function(){var r=[],o=0,s=1;_(e,!1,function(e){var a=o++,u=!1;r.push(void 0),s++,t.resolve(e).then(function(e){u||(u=!0,r[a]=e,--s||n(r))},i)}),--s||n(r)});return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=S(t),n=r.reject,i=g(function(){_(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},{"./_a-function":82,"./_an-instance":84,"./_classof":92,"./_core":97,"./_ctx":99,"./_export":105,"./_for-of":107,"./_global":108,"./_is-object":117,"./_iter-detect":121,"./_library":124,"./_microtask":126,"./_new-promise-capability":127,"./_perform":141,"./_promise-resolve":142,"./_redefine-all":144,"./_set-species":149,"./_set-to-string-tag":150,"./_species-constructor":153,"./_task":155,"./_wks":166}],183:[function(e,t,r){var n=e("./_export"),i=e("./_object-create"),o=e("./_a-function"),s=e("./_an-object"),a=e("./_is-object"),u=e("./_fails"),c=e("./_bind"),l=(e("./_global").Reflect||{}).construct,f=u(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),h=!u(function(){l(function(){})});n(n.S+n.F*(f||h),"Reflect",{construct:function(e,t){o(e),s(t);var r=arguments.length<3?e:o(arguments[2]);if(h&&!f)return l(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(c.apply(e,n))}var u=r.prototype,p=i(a(u)?u:Object.prototype),d=Function.apply.call(e,p,t);return a(d)?d:p}})},{"./_a-function":82,"./_an-object":85,"./_bind":91,"./_export":105,"./_fails":106,"./_global":108,"./_is-object":117,"./_object-create":129}],184:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},{"./_collection":96,"./_collection-strong":94,"./_validate-collection":163}],185:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":120,"./_string-at":154}],186:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_has"),o=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),u=e("./_meta").KEY,c=e("./_fails"),l=e("./_shared"),f=e("./_set-to-string-tag"),h=e("./_uid"),p=e("./_wks"),d=e("./_wks-ext"),_=e("./_wks-define"),v=e("./_enum-keys"),m=e("./_is-array"),y=e("./_an-object"),b=e("./_is-object"),g=e("./_to-iobject"),k=e("./_to-primitive"),w=e("./_property-desc"),x=e("./_object-create"),C=e("./_object-gopn-ext"),j=e("./_object-gopd"),E=e("./_object-dp"),S=e("./_object-keys"),T=j.f,R=E.f,A=C.f,O=n.Symbol,I=n.JSON,P=I&&I.stringify,M=p("_hidden"),F=p("toPrimitive"),D={}.propertyIsEnumerable,L=l("symbol-registry"),N=l("symbols"),U=l("op-symbols"),B=Object.prototype,q="function"==typeof O,z=n.QObject,W=!z||!z.prototype||!z.prototype.findChild,V=o&&c(function(){return 7!=x(R({},"a",{get:function(){return R(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=T(B,t);n&&delete B[t],R(e,t,r),n&&e!==B&&R(B,t,n)}:R,H=function(e){var t=N[e]=x(O.prototype);return t._k=e,t},G=q&&"symbol"==typeof O.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof O},Q=function(e,t,r){return e===B&&Q(U,t,r),y(e),t=k(t,!0),y(r),i(N,t)?(r.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),r=x(r,{enumerable:w(0,!1)})):(i(e,M)||R(e,M,w(1,{})),e[M][t]=!0),V(e,t,r)):R(e,t,r)},K=function(e,t){y(e);for(var r,n=v(t=g(t)),i=0,o=n.length;o>i;)Q(e,r=n[i++],t[r]);return e},$=function(e,t){return void 0===t?x(e):K(x(e),t)},X=function(e){var t=D.call(this,e=k(e,!0));return!(this===B&&i(N,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(N,e)||i(this,M)&&this[M][e])||t)},J=function(e,t){if(e=g(e),t=k(t,!0),e!==B||!i(N,t)||i(U,t)){var r=T(e,t);return!r||!i(N,t)||i(e,M)&&e[M][t]||(r.enumerable=!0),r}},Y=function(e){for(var t,r=A(g(e)),n=[],o=0;r.length>o;)i(N,t=r[o++])||t==M||t==u||n.push(t);return n},Z=function(e){for(var t,r=e===B,n=A(r?U:g(e)),o=[],s=0;n.length>s;)!i(N,t=n[s++])||r&&!i(B,t)||o.push(N[t]);return o};q||(O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(r){this===B&&t.call(U,r),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),V(this,e,w(1,r))};return o&&W&&V(B,e,{configurable:!0,set:t}),H(e)},a(O.prototype,"toString",function(){return this._k}),j.f=J,E.f=Q,e("./_object-gopn").f=C.f=Y,e("./_object-pie").f=X,e("./_object-gops").f=Z,o&&!e("./_library")&&a(B,"propertyIsEnumerable",X,!0),d.f=function(e){return H(p(e))}),s(s.G+s.W+s.F*!q,{Symbol:O});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)p(ee[te++]);for(var re=S(p.store),ne=0;re.length>ne;)_(re[ne++]);s(s.S+s.F*!q,"Symbol",{for:function(e){return i(L,e+="")?L[e]:L[e]=O(e)},keyFor:function(e){if(!G(e))throw TypeError(e+" is not a symbol!");for(var t in L)if(L[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),s(s.S+s.F*!q,"Object",{create:$,defineProperty:Q,defineProperties:K,getOwnPropertyDescriptor:J,getOwnPropertyNames:Y,getOwnPropertySymbols:Z}),I&&s(s.S+s.F*(!q||c(function(){var e=O();return"[null]"!=P([e])||"{}"!=P({a:e})||"{}"!=P(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!G(e))return m(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!G(t))return t}),n[1]=t,P.apply(I,n)}}),O.prototype[F]||e("./_hide")(O.prototype,F,O.prototype.valueOf),f(O,"Symbol"),f(Math,"Math",!0),f(n.JSON,"JSON",!0)},{"./_an-object":85,"./_descriptors":101,"./_enum-keys":104,"./_export":105,"./_fails":106,"./_global":108,"./_has":109,"./_hide":110,"./_is-array":116,"./_is-object":117,"./_library":124,"./_meta":125,"./_object-create":129,"./_object-dp":130,"./_object-gopd":132,"./_object-gopn":134,"./_object-gopn-ext":133,"./_object-gops":135,"./_object-keys":138,"./_object-pie":139,"./_property-desc":143,"./_redefine":145,"./_set-to-string-tag":150,"./_shared":152,"./_to-iobject":158,"./_to-primitive":161,"./_uid":162,"./_wks":166,"./_wks-define":164,"./_wks-ext":165}],187:[function(e,t,r){e("./_set-collection-from")("Map")},{"./_set-collection-from":146}],188:[function(e,t,r){e("./_set-collection-of")("Map")},{"./_set-collection-of":147}],189:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":95,"./_export":105}],190:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_core"),o=e("./_global"),s=e("./_species-constructor"),a=e("./_promise-resolve");n(n.P+n.R,"Promise",{finally:function(e){var t=s(this,i.Promise||o.Promise),r="function"==typeof e;return this.then(r?function(r){return a(t,e()).then(function(){return r})}:e,r?function(r){return a(t,e()).then(function(){throw r})}:e)}})},{"./_core":97,"./_export":105,"./_global":108,"./_promise-resolve":142,"./_species-constructor":153}],191:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_new-promise-capability"),o=e("./_perform");n(n.S,"Promise",{try:function(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},{"./_export":105,"./_new-promise-capability":127,"./_perform":141}],192:[function(e,t,r){e("./_set-collection-from")("Set")},{"./_set-collection-from":146}],193:[function(e,t,r){e("./_set-collection-of")("Set")},{"./_set-collection-of":147}],194:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Set",{toJSON:e("./_collection-to-json")("Set")})},{"./_collection-to-json":95,"./_export":105}],195:[function(e,t,r){e("./_wks-define")("asyncIterator")},{"./_wks-define":164}],196:[function(e,t,r){e("./_wks-define")("observable")},{"./_wks-define":164}],197:[function(e,t,r){e("./es6.array.iterator");for(var n=e("./_global"),i=e("./_hide"),o=e("./_iterators"),s=e("./_wks")("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<a.length;u++){var c=a[u],l=n[c],f=l&&l.prototype;f&&!f[s]&&i(f,s,c),o[c]=o.Array}},{"./_global":108,"./_hide":110,"./_iterators":123,"./_wks":166,"./es6.array.iterator":171}],198:[function(e,t,r){r.UINT32=e("./lib/uint32"),r.UINT64=e("./lib/uint64")},{"./lib/uint32":199,"./lib/uint64":200}],199:[function(t,r,n){!function(t){function n(e,t){return this instanceof n?(this._low=0,this._high=0,this.remainder=null,void 0===t?o.call(this,e):"string"==typeof e?s.call(this,e,t):void i.call(this,e,t)):new n(e,t)}function i(e,t){return this._low=0|e,this._high=0|t,this}function o(e){return this._low=65535&e,this._high=e>>>16,this}function s(e,t){var r=parseInt(e,t||10);return this._low=65535&r,this._high=r>>>16,this}n(Math.pow(36,5)),n(Math.pow(16,7)),n(Math.pow(10,9)),n(Math.pow(2,30)),n(36),n(16),n(10),n(2);n.prototype.fromBits=i,n.prototype.fromNumber=o,n.prototype.fromString=s,n.prototype.toNumber=function(){return 65536*this._high+this._low},n.prototype.toString=function(e){return this.toNumber().toString(e||10)},n.prototype.add=function(e){var t=this._low+e._low,r=t>>>16;return r+=this._high+e._high,this._low=65535&t,this._high=65535&r,this},n.prototype.subtract=function(e){return this.add(e.clone().negate())},n.prototype.multiply=function(e){var t,r,n=this._high,i=this._low,o=e._high,s=e._low;return r=i*s,t=r>>>16,t+=n*s,t&=65535,t+=i*o,this._low=65535&r,this._high=65535&t,this},n.prototype.div=function(e){if(0==e._low&&0==e._high)throw Error("division by zero");if(0==e._high&&1==e._low)return this.remainder=new n(0),this;if(e.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(e))return this.remainder=new n(0),this._low=1,this._high=0,this;for(var t=e.clone(),r=-1;!this.lt(t);)t.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._low=0,this._high=0;r>=0;r--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),r>=16?this._high|=1<<r-16:this._low|=1<<r);return this},n.prototype.negate=function(){var e=1+(65535&~this._low);return this._low=65535&e,this._high=~this._high+(e>>>16)&65535,this},n.prototype.equals=n.prototype.eq=function(e){return this._low==e._low&&this._high==e._high},n.prototype.greaterThan=n.prototype.gt=function(e){return this._high>e._high||!(this._high<e._high)&&this._low>e._low},n.prototype.lessThan=n.prototype.lt=function(e){return this._high<e._high||!(this._high>e._high)&&this._low<e._low},n.prototype.or=function(e){return this._low|=e._low,this._high|=e._high,this},n.prototype.and=function(e){return this._low&=e._low,this._high&=e._high,this},n.prototype.not=function(){return this._low=65535&~this._low,this._high=65535&~this._high,this},n.prototype.xor=function(e){return this._low^=e._low,this._high^=e._high,this},n.prototype.shiftRight=n.prototype.shiftr=function(e){return e>16?(this._low=this._high>>e-16,this._high=0):16==e?(this._low=this._high,this._high=0):(this._low=this._low>>e|this._high<<16-e&65535,this._high>>=e),this},n.prototype.shiftLeft=n.prototype.shiftl=function(e,t){return e>16?(this._high=this._low<<e-16,this._low=0,t||(this._high&=65535)):16==e?(this._high=this._low,this._low=0):(this._high=this._high<<e|this._low>>16-e,this._low=this._low<<e&65535,t||(this._high&=65535)),this},n.prototype.rotateLeft=n.prototype.rotl=function(e){var t=this._high<<16|this._low;return t=t<<e|t>>>32-e,this._low=65535&t,this._high=t>>>16,this},n.prototype.rotateRight=n.prototype.rotr=function(e){var t=this._high<<16|this._low;return t=t>>>e|t<<32-e,this._low=65535&t,this._high=t>>>16,this},n.prototype.clone=function(){return new n(this._low,this._high)},void 0!==e&&e.amd?e([],function(){return n}):void 0!==r&&r.exports?r.exports=n:t.UINT32=n}(this)},{}],200:[function(t,r,n){!function(t){function n(e,t,r,a){return this instanceof n?(this.remainder=null,"string"==typeof e?s.call(this,e,t):void 0===t?o.call(this,e):void i.apply(this,arguments)):new n(e,t,r,a)}function i(e,t,r,n){return void 0===r?(this._a00=65535&e,this._a16=e>>>16,this._a32=65535&t,this._a48=t>>>16,this):(this._a00=0|e,this._a16=0|t,this._a32=0|r,this._a48=0|n,this)}function o(e){return this._a00=65535&e,this._a16=e>>>16,this._a32=0,this._a48=0,this}function s(e,t){t=t||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var r=a[t]||new n(Math.pow(t,5)),i=0,o=e.length;i<o;i+=5){var s=Math.min(5,o-i),u=parseInt(e.slice(i,i+s),t);this.multiply(s<5?new n(Math.pow(t,s)):r).add(new n(u))}return this}var a={16:n(Math.pow(16,5)),10:n(Math.pow(10,5)),2:n(Math.pow(2,5))},u={16:n(16),10:n(10),2:n(2)};n.prototype.fromBits=i,n.prototype.fromNumber=o,n.prototype.fromString=s,n.prototype.toNumber=function(){return 65536*this._a16+this._a00},n.prototype.toString=function(e){e=e||10;var t=u[e]||new n(e);if(!this.gt(t))return this.toNumber().toString(e);for(var r=this.clone(),i=new Array(64),o=63;o>=0&&(r.div(t),i[o]=r.remainder.toNumber().toString(e),r.gt(t));o--);return i[o-1]=r.toNumber().toString(e),i.join("")},n.prototype.add=function(e){var t=this._a00+e._a00,r=t>>>16;r+=this._a16+e._a16;var n=r>>>16;n+=this._a32+e._a32;var i=n>>>16;return i+=this._a48+e._a48,this._a00=65535&t,this._a16=65535&r,this._a32=65535&n,this._a48=65535&i,this},n.prototype.subtract=function(e){return this.add(e.clone().negate())},n.prototype.multiply=function(e){var t=this._a00,r=this._a16,n=this._a32,i=this._a48,o=e._a00,s=e._a16,a=e._a32,u=e._a48,c=t*o,l=c>>>16;l+=t*s;var f=l>>>16;l&=65535,l+=r*o,
f+=l>>>16,f+=t*a;var h=f>>>16;return f&=65535,f+=r*s,h+=f>>>16,f&=65535,f+=n*o,h+=f>>>16,h+=t*u,h&=65535,h+=r*a,h&=65535,h+=n*s,h&=65535,h+=i*o,this._a00=65535&c,this._a16=65535&l,this._a32=65535&f,this._a48=65535&h,this},n.prototype.div=function(e){if(0==e._a16&&0==e._a32&&0==e._a48){if(0==e._a00)throw Error("division by zero");if(1==e._a00)return this.remainder=new n(0),this}if(e.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(e))return this.remainder=new n(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var t=e.clone(),r=-1;!this.lt(t);)t.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;r>=0;r--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),r>=48?this._a48|=1<<r-48:r>=32?this._a32|=1<<r-32:r>=16?this._a16|=1<<r-16:this._a00|=1<<r);return this},n.prototype.negate=function(){var e=1+(65535&~this._a00);return this._a00=65535&e,e=(65535&~this._a16)+(e>>>16),this._a16=65535&e,e=(65535&~this._a32)+(e>>>16),this._a32=65535&e,this._a48=~this._a48+(e>>>16)&65535,this},n.prototype.equals=n.prototype.eq=function(e){return this._a48==e._a48&&this._a00==e._a00&&this._a32==e._a32&&this._a16==e._a16},n.prototype.greaterThan=n.prototype.gt=function(e){return this._a48>e._a48||!(this._a48<e._a48)&&(this._a32>e._a32||!(this._a32<e._a32)&&(this._a16>e._a16||!(this._a16<e._a16)&&this._a00>e._a00))},n.prototype.lessThan=n.prototype.lt=function(e){return this._a48<e._a48||!(this._a48>e._a48)&&(this._a32<e._a32||!(this._a32>e._a32)&&(this._a16<e._a16||!(this._a16>e._a16)&&this._a00<e._a00))},n.prototype.or=function(e){return this._a00|=e._a00,this._a16|=e._a16,this._a32|=e._a32,this._a48|=e._a48,this},n.prototype.and=function(e){return this._a00&=e._a00,this._a16&=e._a16,this._a32&=e._a32,this._a48&=e._a48,this},n.prototype.xor=function(e){return this._a00^=e._a00,this._a16^=e._a16,this._a32^=e._a32,this._a48^=e._a48,this},n.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},n.prototype.shiftRight=n.prototype.shiftr=function(e){return e%=64,e>=48?(this._a00=this._a48>>e-48,this._a16=0,this._a32=0,this._a48=0):e>=32?(e-=32,this._a00=65535&(this._a32>>e|this._a48<<16-e),this._a16=this._a48>>e&65535,this._a32=0,this._a48=0):e>=16?(e-=16,this._a00=65535&(this._a16>>e|this._a32<<16-e),this._a16=65535&(this._a32>>e|this._a48<<16-e),this._a32=this._a48>>e&65535,this._a48=0):(this._a00=65535&(this._a00>>e|this._a16<<16-e),this._a16=65535&(this._a16>>e|this._a32<<16-e),this._a32=65535&(this._a32>>e|this._a48<<16-e),this._a48=this._a48>>e&65535),this},n.prototype.shiftLeft=n.prototype.shiftl=function(e,t){return e%=64,e>=48?(this._a48=this._a00<<e-48,this._a32=0,this._a16=0,this._a00=0):e>=32?(e-=32,this._a48=this._a16<<e|this._a00>>16-e,this._a32=this._a00<<e&65535,this._a16=0,this._a00=0):e>=16?(e-=16,this._a48=this._a32<<e|this._a16>>16-e,this._a32=65535&(this._a16<<e|this._a00>>16-e),this._a16=this._a00<<e&65535,this._a00=0):(this._a48=this._a48<<e|this._a32>>16-e,this._a32=65535&(this._a32<<e|this._a16>>16-e),this._a16=65535&(this._a16<<e|this._a00>>16-e),this._a00=this._a00<<e&65535),t||(this._a48&=65535),this},n.prototype.rotateLeft=n.prototype.rotl=function(e){if(0==(e%=64))return this;if(e>=32){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var r=this._a48<<16|this._a32,n=this._a16<<16|this._a00,i=r<<e|n>>>32-e,o=n<<e|r>>>32-e;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&i,this._a48=i>>>16,this},n.prototype.rotateRight=n.prototype.rotr=function(e){if(0==(e%=64))return this;if(e>=32){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var r=this._a48<<16|this._a32,n=this._a16<<16|this._a00,i=r>>>e|n<<32-e,o=n>>>e|r<<32-e;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&i,this._a48=i>>>16,this},n.prototype.clone=function(){return new n(this._a00,this._a16,this._a32,this._a48)},void 0!==e&&e.amd?e([],function(){return n}):void 0!==r&&r.exports?r.exports=n:t.UINT64=n}(this)},{}],201:[function(e,t,r){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],a(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(s(r))for(o=Array.prototype.slice.call(arguments,1),c=r.slice(),n=c.length,u=0;u<n;u++)c[u].apply(this,o);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(r=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(a=o;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],202:[function(e,t,r){r.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,f=r?i-1:0,h=r?-1:1,p=e[t+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+f>=1?h/u:h*Math.pow(2,1-f),t*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*u-1)*Math.pow(2,i),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+p]=255&s,p+=d,s/=256,c-=8);e[r+p-d]|=128*_}},{}],203:[function(t,r,n){/*

  Javascript State Machine Library - https://github.com/jakesgordon/javascript-state-machine

  Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors
  Released under the MIT license - https://github.com/jakesgordon/javascript-state-machine/blob/master/LICENSE

*/
!function(){var t={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,r){var n="string"==typeof e.initial?{state:e.initial}:e.initial,i=e.terminal||e.final,o=r||e.target||{},s=e.events||[],a=e.callbacks||{},u={},c={},l=function(e){var r=Array.isArray(e.from)?e.from:e.from?[e.from]:[t.WILDCARD];u[e.name]=u[e.name]||{};for(var n=0;n<r.length;n++)c[r[n]]=c[r[n]]||[],c[r[n]].push(e.name),u[e.name][r[n]]=e.to||r[n];e.to&&(c[e.to]=c[e.to]||[])};n&&(n.event=n.event||"startup",l({name:n.event,from:"none",to:n.state}));for(var f=0;f<s.length;f++)l(s[f]);for(var h in u)u.hasOwnProperty(h)&&(o[h]=t.buildEvent(h,u[h]));for(var h in a)a.hasOwnProperty(h)&&(o[h]=a[h]);return o.current="none",o.is=function(e){return Array.isArray(e)?e.indexOf(this.current)>=0:this.current===e},o.can=function(e){return!this.transition&&void 0!==u[e]&&(u[e].hasOwnProperty(this.current)||u[e].hasOwnProperty(t.WILDCARD))},o.cannot=function(e){return!this.can(e)},o.transitions=function(){return(c[this.current]||[]).concat(c[t.WILDCARD]||[])},o.isFinished=function(){return this.is(i)},o.error=e.error||function(e,t,r,n,i,o,s){throw s||o},o.states=function(){return Object.keys(c).sort()},n&&!n.defer&&o[n.event](),o},doCallback:function(e,r,n,i,o,s){if(r)try{return r.apply(e,[n,i,o].concat(s))}catch(r){return e.error(n,i,o,s,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",r)}},beforeAnyEvent:function(e,r,n,i,o){return t.doCallback(e,e.onbeforeevent,r,n,i,o)},afterAnyEvent:function(e,r,n,i,o){return t.doCallback(e,e.onafterevent||e.onevent,r,n,i,o)},leaveAnyState:function(e,r,n,i,o){return t.doCallback(e,e.onleavestate,r,n,i,o)},enterAnyState:function(e,r,n,i,o){return t.doCallback(e,e.onenterstate||e.onstate,r,n,i,o)},changeState:function(e,r,n,i,o){return t.doCallback(e,e.onchangestate,r,n,i,o)},beforeThisEvent:function(e,r,n,i,o){return t.doCallback(e,e["onbefore"+r],r,n,i,o)},afterThisEvent:function(e,r,n,i,o){return t.doCallback(e,e["onafter"+r]||e["on"+r],r,n,i,o)},leaveThisState:function(e,r,n,i,o){return t.doCallback(e,e["onleave"+n],r,n,i,o)},enterThisState:function(e,r,n,i,o){return t.doCallback(e,e["onenter"+i]||e["on"+i],r,n,i,o)},beforeEvent:function(e,r,n,i,o){if(!1===t.beforeThisEvent(e,r,n,i,o)||!1===t.beforeAnyEvent(e,r,n,i,o))return!1},afterEvent:function(e,r,n,i,o){t.afterThisEvent(e,r,n,i,o),t.afterAnyEvent(e,r,n,i,o)},leaveState:function(e,r,n,i,o){var s=t.leaveThisState(e,r,n,i,o),a=t.leaveAnyState(e,r,n,i,o);return!1!==s&&!1!==a&&(t.ASYNC===s||t.ASYNC===a?t.ASYNC:void 0)},enterState:function(e,r,n,i,o){t.enterThisState(e,r,n,i,o),t.enterAnyState(e,r,n,i,o)},buildEvent:function(e,r){return function(){var n=this.current,i=r[n]||(r[t.WILDCARD]!=t.WILDCARD?r[t.WILDCARD]:n)||n,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,n,i,o,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,n,i,o,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,n,i,o))return t.Result.CANCELLED;if(n===i)return t.afterEvent(this,e,n,i,o),t.Result.NOTRANSITION;var s=this;this.transition=function(){return s.transition=null,s.current=i,t.enterState(s,e,n,i,o),t.changeState(s,e,n,i,o),t.afterEvent(s,e,n,i,o),t.Result.SUCCEEDED},this.transition.cancel=function(){s.transition=null,t.afterEvent(s,e,n,i,o)};var a=t.leaveState(this,e,n,i,o);return!1===a?(this.transition=null,t.Result.CANCELLED):t.ASYNC===a?t.Result.PENDING:this.transition?this.transition():void 0}}};void 0!==n?(void 0!==r&&r.exports&&(n=r.exports=t),n.StateMachine=t):"function"==typeof e&&e.amd?e(function(e){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}()},{}],204:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=n(i),s=e("babel-runtime/core-js/get-iterator"),a=n(s),u=e("babel-runtime/core-js/symbol/iterator"),c=n(u),l=e("babel-runtime/helpers/classCallCheck"),f=n(l),h=e("babel-runtime/helpers/createClass"),p=n(h);Object.defineProperty(r,"__esModule",{value:!0});var d=function(){function e(t,r){(0,f.default)(this,e),this.balanceFactor=0,this.key=t,this.value=r,this.parent=null,this.left=null,this.right=null}return(0,p.default)(e,[{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),e}(),_=function(){function e(t,r){(0,f.default)(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=r||function(e,t){return e===t},this.root=null,this.count=null}return(0,p.default)(e,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var r=this.getNode(e);r?r.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var r=new d(e,t);if(this.count++,!this.root)return void(this.root=r);for(var n=this.root;;)if(this.isLessThan(e,n.key)){if(!n.left){n.left=r;break}n=n.left}else{if(!n.right){n.right=r;break}n=n.right}for(r.parent=n,n=r;n.parent;){var i=n.parent,o=i.balanceFactor;if(n.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(o))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}n=i}}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var r=t.parent,n=t.left,i=t.right;if(!!n!=!!i){var o=n||i;r||o?r&&!o?this.root=o:(r.replace(t,null),this.rebalance(r)):this.root=null}else{for(var s=t.left;s.right;)s=s.right;if(t.left===s)t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!0};else{var a=s.parent,u=s.left;a.right=u,u&&(u.parent=a),t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.left=t.left,s.left.parent=s,s.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:c.default,value:o.default.mark(function e(){var t,r,n,i,s,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,n=void 0,e.prev=3,i=(0,a.default)(this.getIterator());case 5:if(t=(s=i.next()).done){e.next=12;break}return u=s.value,e.next=9,u;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,n=e.t0;case 18:e.prev=18,e.prev=19,!t&&i.return&&i.return();case 21:if(e.prev=21,!r){e.next=24;break}throw n;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})},{key:"getIterator",value:o.default.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(n,t.key)&&(null!==n||t.left)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(n,t.key)||null===n?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:r=!0;case 10:if(!r){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(r=!1,!t.right){e.next=20;break}for(t=t.right;t.left;)t=t.left;r=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}r=t.parent.left===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}r=t.parent.left===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"getReverseIterator",value:o.default.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(n,t.key)&&(null!==n||t.right)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(n,t.key)&&null!==n?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:r=!0;case 10:if(!r){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(r=!1,!t.left){e.next=20;break}for(t=t.left;t.right;)t=t.right;r=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}r=t.parent.right===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}r=t.parent.right===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"size",get:function(){return this.count}}]),e}();r.TreeMap=_},{"babel-runtime/core-js/get-iterator":25,"babel-runtime/core-js/symbol/iterator":41,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/regenerator":49}],205:[function(t,r,n){/*
* loglevel - https://github.com/pimterry/loglevel
*
* Copyright (c) 2013 Tim Perry
* Licensed under the MIT license.
*/
!function(t,n){"use strict";"function"==typeof e&&e.amd?e(n):"object"==typeof r&&r.exports?r.exports=n():t.log=n()}(this,function(){"use strict";function e(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function t(t){return"debug"===t&&(t="log"),typeof console!==a&&(void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):s)}function r(e,t){for(var r=0;r<u.length;r++){var n=u[r];this[n]=r<e?s:this.methodFactory(n,e,t)}this.log=this.debug}function n(e,t,n){return function(){typeof console!==a&&(r.call(this,t,n),this[e].apply(this,arguments))}}function i(e,r,i){return t(e)||n.apply(this,arguments)}function o(e,t,n){function o(e){var t=(u[e]||"silent").toUpperCase();if(typeof window!==a){try{return void(window.localStorage[f]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"="+t+";"}catch(e){}}}function s(){var e;if(typeof window!==a){try{e=window.localStorage[f]}catch(e){}if(typeof e===a)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(f)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===l.levels[e]&&(e=void 0),e}}var c,l=this,f="loglevel";e&&(f+=":"+e),l.name=e,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=n||i,l.getLevel=function(){return c},l.setLevel=function(t,n){if("string"==typeof t&&void 0!==l.levels[t.toUpperCase()]&&(t=l.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(c=t,!1!==n&&o(t),r.call(l,t,e),typeof console===a&&t<l.levels.SILENT)return"No console available for logging"},l.setDefaultLevel=function(e){s()||l.setLevel(e,!1)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)};var h=s();null==h&&(h=null==t?"WARN":t),l.setLevel(h,!1)}var s=function(){},a="undefined",u=["trace","debug","info","warn","error"],c=new o,l={};c.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new o(e,c.getLevel(),c.methodFactory)),t};var f=typeof window!==a?window.log:void 0;return c.noConflict=function(){return typeof window!==a&&window.log===c&&(window.log=f),c},c.getLoggers=function(){return l},c})},{}],206:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=n(i),s=e("babel-runtime/core-js/object/create"),a=n(s),u=e("babel-runtime/core-js/object/set-prototype-of"),c=n(u),l=function(){var e=c.default||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?(0,a.default)(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var f=e("events"),h=function(e){function t(t){var r=e.call(this)||this;return r.minDelay=t.min,r.maxDelay=t.max,r.initialDelay=t.initial||0,r.maxAttemptsCount=t.maxAttemptsCount||0,r.maxAttemptsTime=t.maxAttemptsTime||0,r.randomness=t.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return l(t,e),t.prototype.attempt=function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)},t.prototype.nextDelay=function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var t=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=t,t},t.prototype.randomize=function(e){var t=e*this.randomness,r=Math.round(Math.random()*t*2-t);return Math.max(0,e+r)},t.prototype.scheduleAttempt=function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var r=this.nextDelay(e);r=this.randomize(r),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+r&&(this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),this.reject(new Error("Maximum attempt time limit reached"))),this.timeout=setTimeout(function(){return t.attempt()},r)},t.prototype.cleanup=function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0},t.prototype.start=function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new o.default(function(t,r){e.resolve=t,e.reject=r,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)})},t.prototype.cancel=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))},t.prototype.succeeded=function(e){this.emit("succeeded",e),this.resolve(e)},t.prototype.failed=function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)},t.prototype.run=function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()},t}(f.EventEmitter);r.Retrier=h,r.default=h},{"babel-runtime/core-js/object/create":30,"babel-runtime/core-js/object/set-prototype-of":36,"babel-runtime/core-js/promise":37,events:201}],207:[function(t,r,n){(function(t){(function(){"use strict";function i(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function o(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),e=a(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function s(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=g)for(;++r<n;)t(e[r],r,e);else u(e,t)}function a(e){return e=p(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:i(e)}function u(e,t){for(var r in e)x.call(e,r)&&t(e[r],r,e)}function c(e){return null==e?i(e):C.call(e).slice(8,-1)}function l(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}function f(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function h(e,t){var r=null;return s(e,function(n,i){r=t(r,n,i,e)}),r}function p(e){return String(e).replace(/^ +| +$/g,"")}function d(e){function t(t){return h(t,function(t,r){var n=r.pattern||f(r);return!t&&(t=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),r=r.label||r,t=a(t[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function r(){return this.description||""}var n=v,i=e&&"object"==typeof e&&"String"!=c(e);i&&(n=e,e=null);var s=n.navigator||{},_=s.userAgent||"";e||(e=_);var m,y,b=i?!!s.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(C.toString()),g=i?"Object":"ScriptBridgingProxyObject",w=i?"Object":"Environment",x=i&&n.java?"JavaPackage":c(n.java),j=i?"Object":"RuntimeObject",E=/\bJava/.test(x)&&n.java,S=E&&c(n.environment)==w,T=E?"a":"\u03b1",R=E?"b":"\u03b2",A=n.document||{},O=n.operamini||n.opera,I=k.test(I=i&&O?O["[[Class]]"]:c(O))?I:O=null,P=e,M=[],F=null,D=e==_,L=D&&O&&"function"==typeof O.version&&O.version(),N=function(t){return h(t,function(t,r){return t||RegExp("\\b"+(r.pattern||f(r))+"\\b","i").exec(e)&&(r.label||r)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),U=function(t){return h(t,function(t,r){return t||RegExp("\\b"+(r.pattern||f(r))+"\\b","i").exec(e)&&(r.label||r)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),B=t([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),q=function(t){return h(t,function(t,r,n){return t||(r[B]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(B)]||RegExp("\\b"+f(n)+"(?:\\b|\\w*\\d)","i").exec(e))&&n})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),z=function(t){return h(t,function(t,r){var n=r.pattern||f(r);return!t&&(t=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=o(t,n,r.label||r)),t})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(N&&(N=[N]),q&&!B&&(B=t([q])),(m=/\bGoogle TV\b/.exec(B))&&(B=m[0]),/\bSimulator\b/i.test(e)&&(B=(B?B+" ":"")+"Simulator"),"Opera Mini"==U&&/\bOPiOS\b/.test(e)&&M.push("running in Turbo/Uncompressed mode"),"IE"==U&&/\blike iPhone OS\b/.test(e)?(m=d(e.replace(/like iPhone OS/,"")),q=m.manufacturer,B=m.product):/^iP/.test(B)?(U||(U="Safari"),z="iOS"+((m=/ OS ([\d_]+)/i.exec(e))?" "+m[1].replace(/_/g,"."):"")):"Konqueror"!=U||/buntu/i.test(z)?q&&"Google"!=q&&(/Chrome/.test(U)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(B))||/\bAndroid\b/.test(z)&&/^Chrome/.test(U)&&/\bVersion\//i.test(e)?(U="Android Browser",z=/\bAndroid\b/.test(z)?z:"Android"):"Silk"==U?(/\bMobi/i.test(e)||(z="Android",M.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&M.unshift("accelerated")):"PaleMoon"==U&&(m=/\bFirefox\/([\d.]+)\b/.exec(e))?M.push("identifying as Firefox "+m[1]):"Firefox"==U&&(m=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(z||(z="Firefox OS"),B||(B=m[1])):!U||(m=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(U))?(U&&!B&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(m+"/")+8))&&(U=null),(m=B||q||z)&&(B||q||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(z))&&(U=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(z)?z:m)+" Browser")):"Electron"==U&&(m=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&M.push("Chromium "+m):z="Kubuntu",L||(L=function(t){return h(t,function(t,r){return t||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",f(U),"(?:Firefox|Minefield|NetFront)"])),(m="iCab"==N&&parseFloat(L)>3&&"WebKit"||/\bOpera\b/.test(U)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(N)&&"WebKit"||!N&&/\bMSIE\b/i.test(e)&&("Mac OS"==z?"Tasman":"Trident")||"WebKit"==N&&/\bPlayStation\b(?! Vita\b)/i.test(U)&&"NetFront")&&(N=[m]),"IE"==U&&(m=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(U+=" Mobile",z="Windows Phone "+(/\+$/.test(m)?m:m+".x"),M.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(U="IE Mobile",z="Windows Phone 8.x",M.unshift("desktop mode"),L||(L=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=U&&"Trident"==N&&(m=/\brv:([\d.]+)/.exec(e))&&(U&&M.push("identifying as "+U+(L?" "+L:"")),U="IE",L=m[1]),D){if(l(n,"global"))if(E&&(m=E.lang.System,P=m.getProperty("os.arch"),z=z||m.getProperty("os.name")+" "+m.getProperty("os.version")),S){try{L=n.require("ringo/engine").version.join("."),U="RingoJS"}catch(e){(m=n.system)&&m.global.system==n.system&&(U="Narwhal",z||(z=m[0].os||null))}U||(U="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(m=n.process)&&("object"==typeof m.versions&&("string"==typeof m.versions.electron?(M.push("Node "+m.versions.node),U="Electron",L=m.versions.electron):"string"==typeof m.versions.nw&&(M.push("Chromium "+L,"Node "+m.versions.node),U="NW.js",L=m.versions.nw)),U||(U="Node.js",P=m.arch,z=m.platform,L=/[\d.]+/.exec(m.version),L=L?L[0]:null));else c(m=n.runtime)==g?(U="Adobe AIR",z=m.flash.system.Capabilities.os):c(m=n.phantom)==j?(U="PhantomJS",L=(m=m.version||null)&&m.major+"."+m.minor+"."+m.patch):"number"==typeof A.documentMode&&(m=/\bTrident\/(\d+)/i.exec(e))?(L=[L,A.documentMode],(m=+m[1]+4)!=L[1]&&(M.push("IE "+L[1]+" mode"),N&&(N[1]=""),L[1]=m),L="IE"==U?String(L[1].toFixed(1)):L[0]):"number"==typeof A.documentMode&&/^(?:Chrome|Firefox)\b/.test(U)&&(M.push("masking as "+U+" "+L),U="IE",L="11.0",N=["Trident"],z="Windows");z=z&&a(z)}if(L&&(m=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(L)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(D&&s.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(F=/b/i.test(m)?"beta":"alpha",L=L.replace(RegExp(m+"\\+?$"),"")+("beta"==F?R:T)+(/\d+\+?/.exec(m)||"")),"Fennec"==U||"Firefox"==U&&/\b(?:Android|Firefox OS)\b/.test(z))U="Firefox Mobile";else if("Maxthon"==U&&L)L=L.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(B))"Xbox 360"==B&&(z=null),"Xbox 360"==B&&/\bIEMobile\b/.test(e)&&M.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(U)&&(!U||B||/Browser|Mobi/.test(U))||"Windows CE"!=z&&!/Mobi/i.test(e))if("IE"==U&&D)try{null===n.external&&M.unshift("platform preview")}catch(e){M.unshift("embedded")}else(/\bBlackBerry\b/.test(B)||/\bBB10\b/.test(e))&&(m=(RegExp(B.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||L)?(m=[m,/BB10/.test(e)],z=(m[1]?(B=null,q="BlackBerry"):"Device Software")+" "+m[0],L=null):this!=u&&"Wii"!=B&&(D&&O||/Opera/.test(U)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==U&&/\bOS X (?:\d+\.){2,}/.test(z)||"IE"==U&&(z&&!/^Win/.test(z)&&L>5.5||/\bWindows XP\b/.test(z)&&L>8||8==L&&!/\bTrident\b/.test(e)))&&!k.test(m=d.call(u,e.replace(k,"")+";"))&&m.name&&(m="ing as "+m.name+((m=m.version)?" "+m:""),k.test(U)?(/\bIE\b/.test(m)&&"Mac OS"==z&&(z=null),m="identify"+m):(m="mask"+m,U=I?a(I.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(m)&&(z=null),D||(L=null)),N=["Presto"],M.push(m));else U+=" Mobile";(m=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(m=[parseFloat(m.replace(/\.(\d)$/,".0$1")),m],"Safari"==U&&"+"==m[1].slice(-1)?(U="WebKit Nightly",F="alpha",L=m[1].slice(0,-1)):L!=m[1]&&L!=(m[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(L=null),m[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==m[0]&&537.36==m[2]&&parseFloat(m[1])>=28&&"WebKit"==N&&(N=["Blink"]),D&&(b||m[1])?(N&&(N[1]="like Chrome"),m=m[1]||(m=m[0],m<530?1:m<532?2:m<532.05?3:m<533?4:m<534.03?5:m<534.07?6:m<534.1?7:m<534.13?8:m<534.16?9:m<534.24?10:m<534.3?11:m<535.01?12:m<535.02?"13+":m<535.07?15:m<535.11?16:m<535.19?17:m<536.05?18:m<536.1?19:m<537.01?20:m<537.11?"21+":m<537.13?23:m<537.18?24:m<537.24?25:m<537.36?26:"Blink"!=N?"27":"28")):(N&&(N[1]="like Safari"),m=m[0],m=m<400?1:m<500?2:m<526?3:m<533?4:m<534?"4+":m<535?5:m<537?6:m<538?7:m<601?8:"8"),N&&(N[1]+=" "+(m+="number"==typeof m?".x":/[.+]/.test(m)?"":"+")),"Safari"==U&&(!L||parseInt(L)>45)&&(L=m)),"Opera"==U&&(m=/\bzbov|zvav$/.exec(z))?(U+=" ",M.unshift("desktop mode"),"zvav"==m?(U+="Mini",L=null):U+="Mobile",z=z.replace(RegExp(" *"+m+"$"),"")):"Safari"==U&&/\bChrome\b/.exec(N&&N[1])&&(M.unshift("desktop mode"),U="Chrome Mobile",L=null,/\bOS X\b/.test(z)?(q="Apple",z="iOS 4.3+"):z=null),L&&0==L.indexOf(m=/[\d.]+$/.exec(z))&&e.indexOf("/"+m+"-")>-1&&(z=p(z.replace(m,""))),N&&!/\b(?:Avant|Nook)\b/.test(U)&&(/Browser|Lunascape|Maxthon/.test(U)||"Safari"!=U&&/^iOS/.test(z)&&/\bSafari\b/.test(N[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(U)&&N[1])&&(m=N[N.length-1])&&M.push(m),M.length&&(M=["("+M.join("; ")+")"]),q&&B&&B.indexOf(q)<0&&M.push("on "+q),B&&M.push((/^on /.test(M[M.length-1])?"":"on ")+B),z&&(m=/ ([\d.+]+)$/.exec(z),y=m&&"/"==z.charAt(z.length-m[0].length-1),z={architecture:32,family:m&&!y?z.replace(m[0],""):z,version:m?m[1]:null,toString:function(){var e=this.version;return this.family+(e&&!y?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(m=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(P))&&!/\bi686\b/i.test(P)?(z&&(z.architecture=64,z.family=z.family.replace(RegExp(" *"+m),"")),U&&(/\bWOW64\b/i.test(e)||D&&/\w(?:86|32)$/.test(s.cpuClass||s.platform)&&!/\bWin64; x64\b/i.test(e))&&M.unshift("32-bit")):z&&/^OS X/.test(z.family)&&"Chrome"==U&&parseFloat(L)>=39&&(z.architecture=64),e||(e=null);var W={};return W.description=e,W.layout=N&&N[0],W.manufacturer=q,W.name=U,W.prerelease=F,W.product=B,W.ua=e,W.version=U&&L,W.os=z||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=d,W.toString=r,W.version&&M.unshift(L),W.name&&M.unshift(U),z&&U&&(z!=String(z).split(" ")[0]||z!=U.split(" ")[0]&&!B)&&M.push(B?"("+z+")":"on "+z),M.length&&(W.description=M.join(" ")),W}var _={function:!0,object:!0},v=_[typeof window]&&window||this,m=_[typeof n]&&n,y=_[typeof r]&&r&&!r.nodeType&&r,b=m&&y&&"object"==typeof t&&t;!b||b.global!==b&&b.window!==b&&b.self!==b||(v=b);var g=Math.pow(2,53)-1,k=/\bOpera/,w=Object.prototype,x=w.hasOwnProperty,C=w.toString,j=d();"function"==typeof e&&"object"==typeof e.amd&&e.amd?(v.platform=j,e(function(){return j})):m&&y?u(j,function(e,t){m[t]=e}):v.platform=j}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],208:[function(e,t,r){/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
t.exports=e("./lib/checks")},{"./lib/checks":209}],209:[function(e,t,r){function n(e,t,r,n){r=r||"";var i=u.format.apply(this,[r].concat(n)),o=new e(i);throw Error.captureStackTrace(o,t),o}function i(e,t,r){n(c.IllegalArgumentError,e,t,r)}function o(e,t,r){n(c.IllegalStateError,e,t,r)}function s(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function a(e){return function(t,r){var n=s(t);if(n==e)return t;i(arguments.callee,r||'Expected "'+e+'" but got "'+n+'".',Array.prototype.slice.call(arguments,2))}}/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var u=e("util"),c=t.exports=e("./errors");t.exports.checkArgument=function(e,t){e||i(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){e||o(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;i(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;i(arguments.callee,t||'Expected value to be defined and not null but got "'+s(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=a("string"),t.exports.checkIsArray=a("array"),t.exports.checkIsNumber=a("number"),t.exports.checkIsBoolean=a("boolean"),t.exports.checkIsFunction=a("function"),t.exports.checkIsObject=a("object")},{"./errors":210,util:235}],210:[function(e,t,r){function n(e){Error.call(this,e),this.message=e}function i(e){Error.call(this,e),this.message=e}/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var o=e("util");o.inherits(n,Error),n.prototype.name="IllegalArgumentError",o.inherits(i,Error),i.prototype.name="IllegalStateError",t.exports.IllegalStateError=i,t.exports.IllegalArgumentError=n},{util:235}],211:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){v&&d&&(v=!1,d.length?_=d.concat(_):m=-1,_.length&&u())}function u(){if(!v){var e=o(a);v=!0;for(var t=_.length;t;){for(d=_,_=[];++m<t;)d&&d[m].run();m=-1,t=_.length}d=null,v=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,h,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var d,_=[],v=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];_.push(new c(e,t)),1!==_.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.prependListener=l,p.prependOnceListener=l,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],212:[function(e,t,r){/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},{"./runtime":213}],213:[function(e,t,r){/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){"use strict";function r(e,t,r,n){var o=t&&t.prototype instanceof i?t:i,s=Object.create(o.prototype),a=new p(n||[]);return s._invoke=c(e,r,a),s}function n(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function s(){}function a(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function u(e){function t(r,i,o,s){var a=n(e[r],e,i);if("throw"!==a.type){var u=a.arg,c=u.value;return c&&"object"==typeof c&&y.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,s)},function(e){t("throw",e,o,s)}):Promise.resolve(c).then(function(e){u.value=e,o(u)},s)}s(a.arg)}function r(e,r){function n(){return new Promise(function(n,i){t(e,r,n,i)})}return i=i?i.then(n,n):n()}var i;this._invoke=r}function c(e,t,r){var i=j;return function(o,s){if(i===S)throw new Error("Generator is already running");if(i===T){if("throw"===o)throw s;return _()}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var u=l(a,r);if(u){if(u===R)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===j)throw i=T,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=S;var c=n(e,t,r);if("normal"===c.type){if(i=r.done?T:E,c.arg===R)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=T,r.method="throw",r.arg=c.arg)}}}function l(e,t){var r=e.iterator[t.method];if(r===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,l(e,t),"throw"===t.method))return R;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return R}var i=n(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,R;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,R):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,R)}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function d(e){if(e){var t=e[g];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(y.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=v,t.done=!0,t};return n.next=n}}return{next:_}}function _(){return{value:v,done:!0}}var v,m=Object.prototype,y=m.hasOwnProperty,b="function"==typeof Symbol?Symbol:{},g=b.iterator||"@@iterator",k=b.asyncIterator||"@@asyncIterator",w=b.toStringTag||"@@toStringTag",x="object"==typeof t,C=e.regeneratorRuntime;if(C)return void(x&&(t.exports=C));C=e.regeneratorRuntime=x?t.exports:{},C.wrap=r;var j="suspendedStart",E="suspendedYield",S="executing",T="completed",R={},A={};A[g]=function(){return this};var O=Object.getPrototypeOf,I=O&&O(O(d([])));I&&I!==m&&y.call(I,g)&&(A=I);var P=s.prototype=i.prototype=Object.create(A);o.prototype=P.constructor=s,s.constructor=o,s[w]=o.displayName="GeneratorFunction",C.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},C.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,w in e||(e[w]="GeneratorFunction")),e.prototype=Object.create(P),e},C.awrap=function(e){return{__await:e}},a(u.prototype),u.prototype[k]=function(){return this},C.AsyncIterator=u,C.async=function(e,t,n,i){var o=new u(r(e,t,n,i));return C.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},a(P),P[w]="Generator",P[g]=function(){return this},P.toString=function(){return"[object Generator]"},C.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},C.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&y.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,r.next=t,n&&(r.method="next",r.arg=v),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=y.call(i,"catchLoc"),a=y.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&y.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,R):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),R},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),R}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;h(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=v),R}}}(function(){return this}()||Function("return this")())},{}],214:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=n(i),s=e("babel-runtime/core-js/object/get-prototype-of"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=n(l),h=e("babel-runtime/helpers/inherits"),p=n(h),d=e("babel-runtime/helpers/classCallCheck"),_=n(d),v=e("babel-runtime/core-js/promise"),m=n(v),y=function(e,t,r,n){return new(r||(r=m.default))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});var b=e("events"),g=e("operation-retrier"),k=e("./configuration"),w=e("./logger"),x=e("./persistentState"),C=e("twilio-transport"),j=function e(){(0,_.default)(this,e)},E=function(e){function t(e){(0,_.default)(this,t);var r=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return e=e||{},e.transport=e.transport||new C.Transport(e.twilsockClient||null),r.state=new x.PersistentState,r.config=new k.default(e),r.twilsock=e.twilsockClient,r.transport=e.transport,r}return(0,p.default)(t,e),(0,c.default)(t,[{key:"setToken",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.currentFpaToken!==e&&(this.currentFpaToken=e,r=this.currentTokenRequest,this.currentTokenRequest=this.establishToken(e),this.notifyRejected(r)),t.abrupt("return",this.currentTokenRequest.promise);case 2:case"end":return t.stop()}},t,this)}))}},{key:"notifyRejected",value:function(e){e&&setTimeout(function(){return e.reject(new Error("Operation has been cancelled by next token"))},0)}},{key:"establishToken",value:function(e){var t=this,r=new j,n=new m.default(function(n,i){t.establishTokenImpl(e).then(n).catch(i),r.resolve=n,r.reject=i});return r.promise=n,r}},{key:"establishTokenImpl",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var r=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new g.default({min:500,max:2e3}).run(function(){return r.requestRtdToken(e)}).then(function(t){if("ok"!=t.status)throw t.exception;if(r.currentFpaToken===e){r.state.continuationToken=t.response.continuation_token;var n=t.response.twilio_rtd_token;"NEW"===t.response.status.status?r.emit("tokenCreated",n):r.emit("tokenUpdated",n),r.emit("token",n);var i={token:t.response.twilio_rtd_token,ttl:t.response.ttl,status:t.response.status.status,reason:t.response.status.reason||null,identity:t.response.identity||null,accountSid:t.response.account_sid,serviceSids:t.response.instance_sids};return r.emit("response",i),i}}).catch(function(e){throw w.default.error(e),e}));case 1:case"end":return t.stop()}},t,this)}))}},{key:"requestRtdToken",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var r,n,i;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={"Content-Type":"application/json"},n={fpa_token:e,continuation_token:this.state.continuationToken},w.default.debug("Token request",n),t.prev=3,t.next=6,this.transport.post(this.config.url,r,n);case 6:return i=t.sent,w.default.debug("Token response:",i),t.abrupt("return",{status:"ok",token:e,response:i.body});case 11:if(t.prev=11,t.t0=t.catch(3),401!==t.t0.status&&403!==t.t0.status){t.next=16;break}return t.t0 instanceof Error||(t.t0.body?t.t0=new Error(t.t0.body.message):t.t0.description&&(t.t0=new Error(t.t0.description))),t.abrupt("return",{status:"denied",exception:t.t0,token:null,response:null});case 16:throw t.t0;case 17:case"end":return t.stop()}},t,this,[[3,11]])}))}}]),t}(b.EventEmitter);r.EmsClient=E;var S=E;r.EMSClient=S,r.default=S},{"./configuration":215,"./logger":216,"./persistentState":217,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,"babel-runtime/regenerator":49,events:201,"operation-retrier":206,"twilio-transport":226}],215:[function(e,t,r){"use strict";var n=e("babel-runtime/helpers/classCallCheck"),i=function(e){return e&&e.__esModule?e:{default:e}}(n);Object.defineProperty(r,"__esModule",{value:!0});var o=function e(t){(0,i.default)(this,e);var r=t.emsClient||{},n=t.realm||"us1",o="https://ems."+n+".twilio.com",s=r.url||r.emsUri||r.emsUrl||o+"/v1/token";this.url=s};r.default=o},{"babel-runtime/helpers/classCallCheck":42}],216:[function(e,t,r){"use strict";function n(e,t){return[e].concat((0,o.default)(t))}var i=e("babel-runtime/core-js/array/from"),o=function(e){return e&&e.__esModule?e:{default:e}}(i);Object.defineProperty(r,"__esModule",{value:!0});var s=e("loglevel");r.default={setLevel:function(e){s.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.trace.apply(null,n("EMS T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.debug.apply(null,n("EMS D:",t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.info.apply(null,n("EMS I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.warn.apply(null,n("EMS W:",t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.error.apply(null,n("EMS E:",t))}}},{"babel-runtime/core-js/array/from":24,loglevel:205}],217:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=n(i),s=e("babel-runtime/helpers/createClass"),a=n(s);Object.defineProperty(r,"__esModule",{value:!0});var u=e("./logger"),c=function(){function e(){(0,o.default)(this,e),this.cachedContinuationToken=null,this.myInstanceNumber=this.initializeInstanceId()}return(0,a.default)(e,[{key:"initializeInstanceId",value:function(){var t=function(){try{if(sessionStorage)return parseInt(sessionStorage.getItem("Twilio::RTD::EmsClient::InstanceId"))||0}catch(e){return 0}}();t>e.instancesCounter&&(e.instancesCounter=t);var r=e.instancesCounter++;try{sessionStorage&&(sessionStorage.setItem("Twilio::RTD::EmsClient::InstanceId",e.instancesCounter.toString()),window&&window.addEventListener("beforeunload",function(){sessionStorage.removeItem("Twilio::RTD::EmsClient::InstanceId")}))}catch(e){}return r}},{key:"shouldUsePersistentToken",get:function(){return 0===this.myInstanceNumber}},{key:"continuationToken",get:function(){if(this.cachedContinuationToken)return this.cachedContinuationToken;try{if(this.shouldUsePersistentToken&&sessionStorage)return this.cachedContinuationToken=sessionStorage.getItem("Twilio::RTD::EndpointId"),this.cachedContinuationToken}catch(e){u.default.info("Can't access persistent storage",e.message)}return null},set:function(e){this.cachedContinuationToken=e;try{this.shouldUsePersistentToken&&sessionStorage&&sessionStorage.setItem("Twilio::RTD::EndpointId",e)}catch(e){u.default.info("Can't access persistent storage",e.message)}}}]),e}();c.instancesCounter=0,r.PersistentState=c},{"./logger":216,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],218:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t,r){var n=new E.default(t,r,1,E.default.strategy.LEAK);return function(){var t=Array.prototype.slice.call(arguments,0);return t.unshift(e),n.schedule.apply(n,t)}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/core-js/promise"),s=n(o),a=e("babel-runtime/core-js/object/define-properties"),u=n(a),c=e("babel-runtime/core-js/object/get-prototype-of"),l=n(c),f=e("babel-runtime/helpers/classCallCheck"),h=n(f),p=e("babel-runtime/helpers/createClass"),d=n(p),_=e("babel-runtime/helpers/possibleConstructorReturn"),v=n(_),m=e("babel-runtime/helpers/inherits"),y=n(m),b=e("./configuration"),g=n(b),k=e("events"),w=n(k),x=e("./logger"),C=n(x),j=e("bottleneck"),E=n(j),S=e("./registrar"),T=n(S),R=e("twilsock"),A=n(R),O=e("twilio-transport"),I=n(O),P=e("twilio-ems-client"),M=function(e){function t(e,r){(0,h.default)(this,t);var n=(0,v.default)(this,(t.__proto__||(0,l.default)(t)).call(this));if(!e)throw new Error("Token is required for Notifications client");r=r||{},r.logLevel=r.logLevel||"error",C.default.setLevel(r.logLevel);var o=r.minTokenRefreshInterval||1e4,s=r.productId||"notifications";r.twilsockClient=r.twilsockClient||new A.default(e,r),r.transport=r.transport||new I.default(r.twilsockClient),r.emsClient=r.emsClient||new P.EMSClient(r);var a=r.twilsockClient,c=r.transport,f={overall:!1,transport:!1,registration:!1,lastEmitted:null},p=new g.default(null,r);return(0,u.default)(n,{_config:{value:p},_emsClient:{value:r.emsClient},_registrar:{value:new T.default(s,c,a,p)},_twilsock:{value:a},_reliableTransportState:{value:f},updateToken:{value:i(n._updateToken.bind(n),1,o),enumerable:!0},connectionState:{get:function(){return"disconnected"===n._twilsock.state?"disconnected":"disconnecting"===n._twilsock.state?"disconnecting":"connected"===n._twilsock.state&&n._reliableTransportState.registration?"connected":"rejected"===n._twilsock.state?"denied":"connecting"}}}),n._emsClient.setToken(e).then(function(e){n._config.updateToken(e.token),n._registrar.updateToken()}).catch(function(e){C.default.warn("Failed to set token",e)}),n._onTransportStateChange(n._twilsock.connected),n._registrar.on("transportReady",function(e){n._onRegistrationStateChange(e?"registered":"")}),n._registrar.on("stateChanged",function(e){n._onRegistrationStateChange(e)}),n._registrar.on("needReliableTransport",n._onNeedReliableTransport.bind(n)),n._twilsock.on("message",function(e,t){return n._routeMessage(e,t)}),n._twilsock.on("connected",function(e){n._onTransportStateChange(!0),n._registrar.setNotificationId("twilsock",e)}),n._twilsock.on("disconnected",function(){n._onTransportStateChange(!1)}),n}return(0,y.default)(t,e),(0,d.default)(t,[{key:"_routeMessage",value:function(e,t){C.default.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this._twilsock.connect():this._twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this._reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this._reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this._reliableTransportState.transport&&this._reliableTransportState.registration;this._reliableTransportState.overall!==e&&(this._reliableTransportState.overall=e,C.default.info("Transport ready "+e),this.emit("transportReady",e)),this._reliableTransportState.lastEmitted!==this.connectionState&&(this._reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e,t){return t=t||"twilsock",C.default.trace("Add subscriptions for message type: ",e,t),this._registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e,t){return t=t||"twilsock",C.default.trace("Remove subscriptions for message type: ",e,t),this._registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){C.default.warn("Push message passed, but no functionality implemented yet: "+e)}},{key:"setPushRegistrationId",value:function(e,t){this._registrar.setNotificationId(t||"gcm",e)}},{key:"_updateToken",value:function(e){var t=this;return C.default.info("authTokenUpdated"),this._fpaToken===e?s.default.resolve():(this._twilsock.updateToken(e),this._emsClient.setToken(e).then(function(e){return e.token}).then(function(e){t._config.updateToken(e),t._registrar.updateToken()}))}}]),t}(w.default);r.default=M,t.exports=r.default},{"./configuration":219,"./logger":221,"./registrar":223,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,bottleneck:61,events:201,"twilio-ems-client":214,"twilio-transport":226,twilsock:229}],219:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/define-properties"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u),l="https://ers.twilio.com",f="/v1/registrations",h=function(){function e(t,r){var n=this;(0,a.default)(this,e),r=(r||{}).Notification||{};var i=r.ersUri||l;(0,o.default)(this,{_registrarUri:{value:i+f},_token:{value:t,writable:!0},registrarUri:{get:function(){return n._registrarUri}},token:{get:function(){return n._token}}})}return(0,c.default)(e,[{key:"updateToken",value:function(e){this._token=e}}]),e}();r.default=h,t.exports=r.default},{"babel-runtime/core-js/object/define-properties":31,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],220:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./client"),i=function(e){return e&&e.__esModule?e:{default:e}}(n);r.default=i.default,t.exports=r.default},{"./client":218}],221:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,s.default)(t))}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/core-js/array/from"),s=n(o),a=e("loglevel"),u=n(a);r.default={setLevel:function(e){u.default.setLevel(e)},trace:function(){u.default.trace.apply(null,i("Notify T:",arguments))},debug:function(){u.default.debug.apply(null,i("Notify D:",arguments))},info:function(){u.default.info.apply(null,i("Notify I:",arguments))},warn:function(){u.default.warn.apply(null,i("Notify W:",arguments))},error:function(){u.default.error.apply(null,i("Notify E:",arguments))}},t.exports=r.default},{"babel-runtime/core-js/array/from":24,loglevel:205}],222:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/freeze"),s=n(o),a=e("babel-runtime/core-js/promise"),u=n(a),c=e("babel-runtime/core-js/set"),l=n(c),f=e("babel-runtime/core-js/object/define-properties"),h=n(f),p=e("babel-runtime/core-js/object/get-prototype-of"),d=n(p),_=e("babel-runtime/helpers/classCallCheck"),v=n(_),m=e("babel-runtime/helpers/createClass"),y=n(m),b=e("babel-runtime/helpers/possibleConstructorReturn"),g=n(b),k=e("babel-runtime/helpers/inherits"),w=n(k),x=e("events"),C=n(x),j=e("./logger"),E=n(j),S=e("javascript-state-machine"),T=n(S),R=e("backoff"),A=n(R),O=function(e){function t(e,r,n,i){(0,v.default)(this,t);var o=(0,g.default)(this,(t.__proto__||(0,d.default)(t)).call(this)),s=T.default.create({initial:{state:"unregistered",event:"init",defer:!0},events:[{name:"userUpdate",from:["unregistered"],to:"registering"},{name:"userUpdate",from:["registered"],to:"unregistering"},{name:"registered",from:["registering","retrying"],to:"registered"},{name:"unregistered",from:["unregistering"],to:"unregistered"},{name:"retry",from:["retrying"],to:"retrying"},{name:"failure",from:["registering"],to:"retrying"},{name:"failure",from:["retrying"],to:"retrying"},{name:"failure",from:["unregistering"],to:"unregistered"}],callbacks:{onregistering:function(e,t,r,n){return o._register(n)},onunregistering:function(){return o._unregister()},onregistered:function(){return o._onRegistered()},onunregistered:function(){return o._onUnregistered()},onretrying:function(e,t,r,n){return o._initRetry(n)},onfailure:function(e,t,r,n){"retrying"===t&&o._initRetry(n)}}}),a=A.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return a.on("ready",function(){o._retry()}),(0,h.default)(o,{_transport:{value:r},_context:{value:e},_url:{value:n.registrarUri,writable:!1},_config:{value:n},_fsm:{value:s},_backoff:{value:a},_channelType:{value:i},_registrationId:{value:!1,writable:!0},_notificationId:{value:!1,writable:!0},_messageTypes:{value:new l.default,writable:!0},_pendingUpdate:{value:null,writable:!0}}),s.init(),o}return(0,w.default)(t,e),(0,y.default)(t,[{key:"setNotificationId",value:function(e){this._notificationId!==e&&(this._notificationId=e,this._updateRegistration())}},{key:"updateToken",value:function(){return this._updateRegistration()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(E.default.debug("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateRegistration(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),this._messageTypes.size>0?this._updateRegistration():this._removeRegistration(),!0)}},{key:"_updateRegistration",value:function(){this._notificationId&&this._update(this._notificationId,i(this._messageTypes))}},{key:"_removeRegistration",value:function(){this._notificationId&&this._update(this._notificationId,i(this._messageTypes))}},{key:"_update",value:function(e,t){var r={notificationId:e,messageTypes:t};this._fsm.is("unregistered")?r.notificationId&&r.messageTypes.length>0&&this._fsm.userUpdate(r):this._fsm.is("registered")?(this._fsm.userUpdate(r),this._setPendingUpdate(r)):this._setPendingUpdate(r)}},{key:"_setPendingUpdate",value:function(e){this._pendingUpdate=e}},{key:"_checkPendingUpdate",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._updateRegistration(e.notificationId,e.messageTypes)}}},{key:"_initRetry",value:function(e){this._pendingUpdate||this._setPendingUpdate(e),this._backoff.backoff()}},{key:"_retry",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._register(e)}}},{key:"_onRegistered",value:function(){this._backoff.reset(),this.emit("stateChanged","registered"),this._checkPendingUpdate()}},{key:"_onUnregistered",value:function(){this._backoff.reset(),this.emit("stateChanged","unregistered"),this._checkPendingUpdate()}},{key:"_register",value:function(e){var t=this,r={endpoint_platform:this._context.platform,channel_type:this._channelType,version:"2",message_types:e.messageTypes,data:{},ttl:"PT24H"};"twilsock"===this._channelType?r.data.url=e.notificationId:r.data.registration_id=e.notificationId;var n=this._url+"?productId="+this._context.productId,i={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return E.default.trace("Creating registration for channel ",this._channelType),this._transport.post(n,i,r).then(function(r){t._registrationId=r.body.id,t._registrationData=e,E.default.debug("Registration created: ",r),t._fsm.registered()}).catch(function(r){return E.default.error("Registration failed: ",r),t._fsm.failure(e),r})}},{key:"_unregister",value:function(){var e=this;if(!this._registrationId)return u.default.resolve();var t=this._url+"/"+this._registrationId+"?productId="+this._context.productId,r={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return E.default.trace("Removing registration for ",this._channelType),this._transport.delete(t,r).then(function(){E.default.debug("Registration removed for ",e._channelType),e._registrationId=!1,e._fsm.unregistered()}).catch(function(t){return E.default.error("Failed to remove of registration ",e.channelType,t),e._fsm.failure(),t})}}]),t}(C.default);r.default=O,(0,s.default)(O),t.exports=r.default},{"./logger":221,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/object/freeze":33,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/core-js/set":39,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,backoff:50,events:201,"javascript-state-machine":203}],223:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/freeze"),o=n(i),s=e("babel-runtime/core-js/map"),a=n(s),u=e("babel-runtime/core-js/object/define-properties"),c=n(u),l=e("babel-runtime/core-js/object/get-prototype-of"),f=n(l),h=e("babel-runtime/helpers/classCallCheck"),p=n(h),d=e("babel-runtime/helpers/createClass"),_=n(d),v=e("babel-runtime/helpers/possibleConstructorReturn"),m=n(v),y=e("babel-runtime/helpers/inherits"),b=n(y),g=e("events"),k=n(g),w=e("./registrar.connector"),x=n(w),C=e("./twilsock.connector"),j=n(C),E=function(e){function t(e,r,n,i){(0,p.default)(this,t);var o=(0,m.default)(this,(t.__proto__||(0,f.default)(t)).call(this));(0,c.default)(o,{_conf:{value:i},_connectors:{value:new a.default}});var s=o._detectPlatform();return o._connectors.set("twilsock",new j.default({productId:e,platform:s},n,i)),o._connectors.set("gcm",new x.default({productId:e,platform:s},r,i,"gcm")),o._connectors.set("fcm",new x.default({productId:e,platform:s},r,i,"fcm")),o._connectors.set("apn",new x.default({productId:e,platform:s},r,i,"apn")),o._connectors.get("twilsock").on("transportReady",function(e){return o.emit("transportReady",e)}),o}return(0,b.default)(t,e),(0,_.default)(t,[{key:"setNotificationId",value:function(e,t){this._connector(e).setNotificationId(t)}},{key:"hasSubscription",value:function(e,t){this._connector(t).has(e)}},{key:"subscribe",value:function(e,t){this._connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){this._connector(t).unsubscribe(e)}},{key:"updateToken",value:function(){this._connectors.forEach(function(e){return e.updateToken()})}},{key:"_connector",value:function(e){var t=this._connectors.get(e);if(!t)throw new Error("Unknown channel type: "+e);return t}},{key:"_detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),t}(k.default);r.default=E,(0,o.default)(E),t.exports=r.default},{"./registrar.connector":222,"./twilsock.connector":224,"babel-runtime/core-js/map":28,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/object/freeze":33,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,events:201}],224:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/freeze"),s=n(o),a=e("babel-runtime/core-js/set"),u=n(a),c=e("babel-runtime/core-js/object/define-properties"),l=n(c),f=e("babel-runtime/core-js/object/get-prototype-of"),h=n(f),p=e("babel-runtime/helpers/classCallCheck"),d=n(p),_=e("babel-runtime/helpers/createClass"),v=n(_),m=e("babel-runtime/helpers/possibleConstructorReturn"),y=n(m),b=e("babel-runtime/helpers/inherits"),g=n(b),k=e("uuid"),w=n(k),x=e("./logger"),C=n(x),j=e("events"),E=n(j),S=function(e){function t(e,r,n){(0,d.default)(this,t);var i=(0,y.default)(this,(t.__proto__||(0,h.default)(t)).call(this));return e.id=w.default.v4(),(0,l.default)(i,{_twilsock:{value:r},_messageTypes:{value:new u.default},config:{value:n},context:{value:e}}),r.on("stateChanged",function(e){"connected"!==e&&i.emit("transportReady",!1)}),r.on("registered",function(t){e&&t===e.id&&"connected"===r.state&&i.emit("transportReady",!0)}),i}return(0,g.default)(t,e),(0,v.default)(t,[{key:"setNotificationId",value:function(){return!1}},{key:"updateToken",value:function(){this._twilsock.removeNotificationsContext(this.context.id),this.context.id=w.default.v4(),this._updateContext()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(C.default.trace("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateContext(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),this._messageTypes.size>0?this._updateContext():this._twilsock.removeNotificationsContext(this.context.id),!0)}},{key:"_updateContext",value:function(){if(this.config.token){var e=i(this._messageTypes),t={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,ttl:172800,token:this.config.token,message_types:e};this.emit("transportReady",!1),this._twilsock.setNotificationsContext(this.context.id,t)}}}]),t}(E.default);r.default=S,(0,s.default)(S),t.exports=r.default},{"./logger":221,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/object/freeze":33,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/set":39,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,events:201,uuid:236}],225:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return e?e.split("\r\n").map(function(e){
return e.split(": ")}).filter(function(e){return 2===e.length&&e[1].length>0}).reduce(function(e,t){return e[t[0]]=t[1],e},{}):{}}function s(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}var a=e("babel-runtime/core-js/json/stringify"),u=n(a),c=e("babel-runtime/core-js/promise"),l=n(c),f=e("babel-runtime/core-js/object/define-property"),h=n(f);Object.defineProperty(r,"__esModule",{value:!0});var p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,h.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d="undefined"==typeof XMLHttpRequest?e("xmlhttprequest").XMLHttpRequest:XMLHttpRequest,_=function(){function e(){i(this,e)}return p(e,null,[{key:"request",value:function(e,t){return new l.default(function(r,n){var i=new d;i.open(e,t.url,!0),i.onreadystatechange=function(){if(4===i.readyState){var e=o(i.getAllResponseHeaders()),t=s(i);200<=i.status&&i.status<300?r({status:i.status,headers:e,body:t}):n({status:i.status,description:i.statusText,headers:e,body:t})}};for(var a in t.headers)i.setRequestHeader(a,t.headers[a]),"Content-Type"===a&&"application/json"===t.headers[a]&&(t.body=(0,u.default)(t.body));i.send(t.body)})}},{key:"get",value:function(e){return this.request("GET",e)}},{key:"post",value:function(e){return this.request("POST",e)}},{key:"put",value:function(e){return this.request("PUT",e)}},{key:"delete",value:function(e){return this.request("DELETE",e)}}]),e}();r.default=_,t.exports=_,t.exports=r.default},{"babel-runtime/core-js/json/stringify":27,"babel-runtime/core-js/object/define-property":32,"babel-runtime/core-js/promise":37,xmlhttprequest:62}],226:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,P.default)(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,P.default)(t)));e.prototype=(0,O.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(R.default?(0,R.default)(e,t):e.__proto__=t)}function a(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var r={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]};if(r.search.length>0){var n=r.search.substring(1);r.params=n.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return r}throw new Error("Incorrect URI: "+e)}function u(e,t){var r=a(t),n={method:e,host:r.host,path:r.pathname};return r.params&&(n.params=r.params),n}function c(e,t,r,n){return{to:u(e,t),headers:r,body:n}}function l(e){return{status:e.header.http_status,headers:e.header.http_headers,body:e.body}}function f(e,t,r){return{url:e,headers:t,body:r}}function h(e){try{e.body=JSON.parse(e.body)}catch(e){}return e}function p(e){for(var t=(0,k.default)(e.headers),r=t.length,n={};r--;){var i=t[r];n[i.toLowerCase()]=e.headers[i]}return e.headers=n,e}var d=e("babel-runtime/core-js/promise"),_=n(d),v=e("babel-runtime/core-js/map"),m=n(v),y=e("babel-runtime/core-js/object/define-properties"),b=n(y),g=e("babel-runtime/core-js/object/keys"),k=n(g),w=e("babel-runtime/core-js/object/get-prototype-of"),x=n(w),C=e("babel-runtime/core-js/array/from"),j=n(C),E=e("babel-runtime/core-js/reflect/construct"),S=n(E),T=e("babel-runtime/core-js/object/set-prototype-of"),R=n(T),A=e("babel-runtime/core-js/object/create"),O=n(A),I=e("babel-runtime/helpers/typeof"),P=n(I),M=e("babel-runtime/core-js/object/define-property"),F=n(M);Object.defineProperty(r,"__esModule",{value:!0}),r.TwilsockUnavailableError=r.Transport=void 0;var D=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,F.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),L=e("./httprequest"),N=function(e){return e&&e.__esModule?e:{default:e}}(L),U=function(e){function t(){return i(this,t),o(this,(t.__proto__||(0,x.default)(t)).call(this))}return s(t,e),t}(function(e){function t(){var t=(0,S.default)(e,(0,j.default)(arguments));return(0,R.default)(t,(0,x.default)(this)),t}return t.prototype=(0,O.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),R.default?(0,R.default)(t,e):t.__proto__=e,t}(Error)),B=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),(0,b.default)(this,{_activeGetRequests:{value:new m.default},_twilsock:{value:t},_http:{value:N.default},_twilsockIsAvailable:{get:function(){return r._twilsock&&r._twilsock.isConnected}},_concurrentHttpRequestLimit:{value:n.concurrentHttpRequestLimit||1/0},_concurrentHttpRequestCount:{value:0,writable:!0},_requestQueue:{value:[]}}),t&&(t.connect(),t.on("connected",function(){return r._processQueuedRequests()}))}return D(e,[{key:"get",value:function(e,t,r){var n=this;if(this._activeGetRequests.has(e))return this._activeGetRequests.get(e);var i=this._get(e,t,r).then(function(t){return n._activeGetRequests.delete(e),t}).catch(function(t){throw n._activeGetRequests.delete(e),t});return this._activeGetRequests.set(e,i),i}},{key:"_oneOfBasedOnChannelAvailability",value:function(e,t){var r=this;return function(n){var i=n.sendViaTwilsock,o=n.sendDirectHttp;return r._twilsockIsAvailable?i():t?_.default.reject(new U):r._concurrentHttpRequestCount>=r._concurrentHttpRequestLimit?new _.default(function(t,n){return r._requestQueue.push({sendingOptions:e,resolve:t,reject:n})}):(r._concurrentHttpRequestCount++,o().then(function(e){return r._concurrentHttpRequestCount--,r._processQueuedRequests(),e}).catch(function(e){throw r._concurrentHttpRequestCount--,r._processQueuedRequests(),e}))}(e).then(p)}},{key:"_processQueuedRequests",value:function(){for(;this._requestQueue.length>0&&(this._twilsockIsAvailable||this._concurrentHttpRequestCount<this._concurrentHttpRequestLimit);){var e=this._requestQueue.shift();this._oneOfBasedOnChannelAvailability(e.sendingOptions,!1).then(e.resolve).catch(e.reject)}}},{key:"_get",value:function(e,t,r){var n=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return n._twilsock.send(c("GET",e,t)).then(l)},sendDirectHttp:function(){return n._http.get(f(e,t)).then(h)}},r)}},{key:"post",value:function(e,t,r,n){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(c("POST",e,t,r)).then(l)},sendDirectHttp:function(){return i._http.post(f(e,t,r)).then(h)}},n)}},{key:"put",value:function(e,t,r,n){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(c("PUT",e,t,r)).then(l)},sendDirectHttp:function(){return i._http.put(f(e,t,r)).then(h)}},n)}},{key:"delete",value:function(e,t,r){var n=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return n._twilsock.send(c("DELETE",e,t)).then(l)},sendDirectHttp:function(){return n._http.delete(f(e,t)).then(h)}},r)}}]),e}();r.default=B,r.Transport=B,r.TwilsockUnavailableError=U},{"./httprequest":225,"babel-runtime/core-js/array/from":24,"babel-runtime/core-js/map":28,"babel-runtime/core-js/object/create":30,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/object/define-property":32,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/object/keys":35,"babel-runtime/core-js/object/set-prototype-of":36,"babel-runtime/core-js/promise":37,"babel-runtime/core-js/reflect/construct":38,"babel-runtime/helpers/typeof":48}],227:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/freeze"),o=n(i),s=e("babel-runtime/core-js/set"),a=n(s),u=e("babel-runtime/core-js/promise"),c=n(u),l=e("babel-runtime/core-js/map"),f=n(l),h=e("babel-runtime/core-js/object/define-properties"),p=n(h),d=e("babel-runtime/core-js/object/get-prototype-of"),_=n(d),v=e("babel-runtime/helpers/classCallCheck"),m=n(v),y=e("babel-runtime/helpers/createClass"),b=n(y),g=e("babel-runtime/helpers/possibleConstructorReturn"),k=n(g),w=e("babel-runtime/helpers/inherits"),x=n(w),C=e("events"),j=n(C),E=e("./logger"),S=n(E),T=e("uuid"),R=n(T),A=e("./configuration"),O=n(A),I=e("./twilsock"),P=n(I),M=e("./packetinterface"),F=n(M),D=function(e){function t(e,r){(0,m.default)(this,t);var n=(0,k.default)(this,(t.__proto__||(0,_.default)(t)).call(this));r=r||{},r.logLevel=r.logLevel||"error",S.default.setLevel(r.logLevel);var i=new O.default(e,r),o=new P.default(i),s=new F.default(o);return(0,p.default)(n,{_config:{value:i},_socket:{value:o},_packet:{value:s},_registrations:{value:new f.default},_registrationsInProgress:{value:new f.default},isConnected:{get:function(){return n._socket.isConnected}},connected:{get:function(){return n._socket.isConnected}},state:{get:function(){return n._socket.state}}}),n._socket.on("message",function(e,t){return setTimeout(function(){n.emit("message",e,t)},0)}),n._socket.on("connected",function(){return n._updateRegistrations()}),n._socket.on("connected",function(){return n.emit("connected")}),n._socket.on("disconnected",function(){return n.emit("disconnected")}),n._socket.on("stateChanged",function(e){return n.emit("stateChanged",e)}),"undefined"!=typeof window&&void 0!==window.addEventListener&&window.addEventListener("online",function(){S.default.debug("Got online"),o.isRetrying()&&o.reconnect()}),n}return(0,x.default)(t,e),(0,b.default)(t,[{key:"send",value:function(e){return this._packet.send(e.to,e.headers,e.body)}},{key:"updateToken",value:function(e){return S.default.info("updateToken"),this._config.token===e?c.default.resolve():(this._config.updateToken(e),this._socket.updateToken(),c.default.resolve())}},{key:"_updateRegistration",value:function(e,t){var r=this;S.default.info("update registration for context",e);var n=this._registrationsInProgress.get(e);n||(n=new a.default,this._registrationsInProgress.set(e,n));var i=R.default.v4();return n.add(i),this._packet.putNotificationContext(e,t).then(function(){S.default.info("registration attempt succeeded for context",t),n.delete(i),0===(void 0!==n.size?n.size:(n._c||{}).size)&&(r._registrationsInProgress.delete(e),r.emit("registered",e))}).catch(function(o){S.default.info("registration attempt failed for context",t),S.default.debug(o),n.delete(i),0===(void 0!==n.size?n.size:(n._c||{}).size)&&(r._registrationsInProgress.delete(e),r.emit("registrationFailed",e,o))})}},{key:"_updateRegistrations",value:function(){var e=this;S.default.info("refreshing all registrations"),this._registrations.forEach(function(t,r){e._updateRegistration(r,t)})}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new Error("Invalid arguments provided");this._registrations.set(e,t),this._socket.isConnected&&this._updateRegistration(e,t)}},{key:"removeNotificationsContext",value:function(e){this._registrations.has(e)&&(this._registrations.delete(e),this._socket.isConnected&&this._packet.deleteNotificationContext(e))}},{key:"connect",value:function(){return this._socket.connect()}},{key:"disconnect",value:function(){return this._socket.disconnect()}}]),t}(j.default);r.default=D,(0,o.default)(D),t.exports=r.default},{"./configuration":228,"./logger":230,"./packetinterface":231,"./twilsock":232,"babel-runtime/core-js/map":28,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/object/freeze":33,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/core-js/set":39,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,events:201,uuid:236}],228:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/define-properties"),o=n(i),s=e("babel-runtime/helpers/classCallCheck"),a=n(s),u=e("babel-runtime/helpers/createClass"),c=n(u),l="wss://tsock.twilio.com",f="/v3/wsconnect",h=function(){function e(t,r){var n=this;(0,a.default)(this,e),r=r||{};var i=r.Twilsock||{},s=i.uri||r.wsServer||l;(0,o.default)(this,{_twilsockWsHost:{value:s+f},_token:{value:t,writable:!0},twilsockUri:{get:function(){return n._twilsockWsHost}},token:{get:function(){return n._token}}})}return(0,c.default)(e,[{key:"updateToken",value:function(e){this._token=e}}]),e}();r.default=h,t.exports=r.default},{"babel-runtime/core-js/object/define-properties":31,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],229:[function(e,t,r){arguments[4][220][0].apply(r,arguments)},{"./client":227,dup:220}],230:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,s.default)(t))}Object.defineProperty(r,"__esModule",{value:!0});var o=e("babel-runtime/core-js/array/from"),s=n(o),a=e("loglevel"),u=n(a);r.default={setLevel:function(e){u.default.setLevel(e)},trace:function(){u.default.trace.apply(null,i("Twilsock T:",arguments))},debug:function(){u.default.debug.apply(null,i("Twilsock D:",arguments))},info:function(){u.default.info.apply(null,i("Twilsock I:",arguments))},warn:function(){u.default.warn.apply(null,i("Twilsock W:",arguments))},error:function(){u.default.error.apply(null,i("Twilsock E:",arguments))}},t.exports=r.default},{"babel-runtime/core-js/array/from":24,loglevel:205}],231:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return e>=200&&e<300}function o(e){return e&&e.header&&e.header.http_status}Object.defineProperty(r,"__esModule",{value:!0});var s=e("babel-runtime/core-js/promise"),a=n(s),u=e("babel-runtime/core-js/map"),c=n(u),l=e("babel-runtime/core-js/object/define-properties"),f=n(l),h=e("babel-runtime/helpers/classCallCheck"),p=n(h),d=e("babel-runtime/helpers/createClass"),_=n(d),v=e("./logger"),m=n(v),y=function(){function e(t){var r=this;(0,p.default)(this,e),(0,f.default)(this,{_activeRequests:{value:new c.default},_socket:{value:t}}),this._socket.on("reply",this._processReply.bind(this)),this._socket.on("disconnected",function(){r._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock disconnected"))}),r._activeRequests.clear()})}return(0,_.default)(e,[{key:"_processReply",value:function(e){var t=this._activeRequests.get(e.id);t&&(clearTimeout(t.timeout),this._activeRequests.delete(e.id),setTimeout(function(){i(e.status.code)?o(e)&&!i(e.header.http_status.code)?t.reject({status:e.header.http_status.code,description:e.header.http_status.status,body:e.body}):t.resolve(e):t.reject(new Error("Transport failure: "+e.status.status))},0))}},{key:"_storeRequest",value:function(e,t,r){var n={resolve:t,reject:r,timeout:setTimeout(function(){m.default.debug("request",e,"is timed out"),r(new Error("Twilsock: request timeout: "+e))},3e4)};this._activeRequests.set(e,n)}},{key:"send",value:function(e,t,r){var n=this;return new a.default(function(i,o){n._socket.isConnected||(m.default.info("Can not send upstream message. Twilsock is not in connected state"),o(new Error("Twilsock is not connected")));var s=n._socket.sendUpstreamMessage(e,t,r);m.default.trace("message sent: ",{id:s,address:e,headers:t,body:r}),n._storeRequest(s,i,o)})}},{key:"putNotificationContext",value:function(e,t){var r=this;return new a.default(function(n,i){r._socket.isConnected||(m.default.info("Can not send put notification context. Twilsock is not in connected state"),i(new Error("Twilsock is not connected")));var o={method:"put_notification_ctx",notification_ctx_id:e},s=r._socket.send(o,t);r._storeRequest(s,n,i)})}},{key:"deleteNotificationContext",value:function(e){var t=this;return new a.default(function(r,n){t._socket.isConnected||(m.default.info("Can not send delete notification context. Twilsock is not in connected state"),n(new Error("Twilsock is not connected")));var i={method:"delete_notification_ctx",notification_ctx_id:e},o=t._socket.send(i);t._storeRequest(o,r,n)})}},{key:"shutdown",value:function(){this._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock: request cancelled by user"))}),this._activeRequests.clear()}}]),e}();r.default=y,t.exports=r.default},{"./logger":230,"babel-runtime/core-js/map":28,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43}],232:[function(e,t,r){(function(n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function s(e){var t=encodeURIComponent(e),r=t.replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),n=new Uint8Array(r.length);return Array.prototype.forEach.call(r,function(e,t){n[t]=e.charCodeAt(0)}),n}function a(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join(""),r=t.replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r});return decodeURIComponent(r)}function u(e){for(var t="",r=0;r<e.length;++r){var n=String.fromCharCode(e[r]);if(t+=n,"\r"===n){r+=2;break}}var i=t.split(" ");return{size:r,protocol:i[0],version:i[1],headerSize:Number(i[2])}}function c(e){switch(void 0===e?"undefined":(0,D.default)(e)){case"undefined":return"";case"object":return(0,M.default)(e);default:return e}}function l(e){var t=a(e);try{return JSON.parse(t)}catch(e){throw B.default.error("failed to parse input: ",t),e}}Object.defineProperty(r,"__esModule",{value:!0});var f=e("babel-runtime/core-js/object/freeze"),h=i(f),p=e("babel-runtime/core-js/promise"),d=i(p),_=e("babel-runtime/helpers/slicedToArray"),v=i(_),m=e("babel-runtime/core-js/get-iterator"),y=i(m),b=e("babel-runtime/core-js/map"),g=i(b),k=e("babel-runtime/core-js/object/define-properties"),w=i(k),x=e("babel-runtime/core-js/object/get-prototype-of"),C=i(x),j=e("babel-runtime/helpers/classCallCheck"),E=i(j),S=e("babel-runtime/helpers/createClass"),T=i(S),R=e("babel-runtime/helpers/possibleConstructorReturn"),A=i(R),O=e("babel-runtime/helpers/inherits"),I=i(O),P=e("babel-runtime/core-js/json/stringify"),M=i(P),F=e("babel-runtime/helpers/typeof"),D=i(F),L=e("events"),N=i(L),U=e("./logger"),B=i(U),q=e("uuid"),z=i(q),W=e("backoff"),V=i(W),H=e("javascript-state-machine"),G=i(H),Q=n.WebSocket||n.MozWebSocket||e("ws"),K=function(e){function t(e){(0,E.default)(this,t);var r=(0,A.default)(this,(t.__proto__||(0,C.default)(t)).call(this));e.logLevel&&B.default.setLevel(e.logLevel);var n=V.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return n.on("ready",function(){r._retry()}),r.on("reply",function(e){r._processReply(e)}),(0,w.default)(r,{_config:{value:e},_transportReady:{value:!1,writable:!0},_disconnectedPromiseResolve:{value:null,writable:!0},_backoffDefault:{value:n},_backoff:{value:n,writable:!0},_fsm:{value:null,writable:!0},_watchTimer:{value:null,writable:!0},_timestamp:{value:0,writable:!0},_socket:{value:null,writable:!0},_activeToken:{value:null,writable:!0},activeToken:{enumerable:!0,get:function(){return r._activeToken}},state:{enumberable:!0,get:function(){return r._getState()}},isConnected:{enumberable:!0,get:function(){return r._isConnected()}},_activeRequests:{value:new g.default},_disconnectingTimer:{value:null,writable:!0},_isDeferredUpdate:{value:!1,writable:!0}}),r._fsm=G.default.create({initial:"disconnected",events:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"}],callbacks:{onconnecting:function(){r._startWatchdogTimer(),r._setupSocket(),r.emit("connecting")},onenterinitialising:function(){r._sendInit()},onleaveinitialising:function(){r._cancelInit()},onenterupdating:function(){r._sendUpdate()},onleaveupdating:function(){r._cancelUpdate()},onenterretrying:function(){r._initRetry(),r.emit("connecting")},onenterconnected:function(){r._resetBackoff(),r._onConnected()},onuserUpdateToken:function(){r._resetBackoff()},ontokenRejected:function(){r._resetBackoff(),r._closeSocket(),r._finalizeSocket()},onuserDisconnect:function(){r._closeSocket()},onenterdisconnecting:function(){r._startDisconnectTimer()},onleavedisconnecting:function(){r._cancelDisconnectTimer()},onenterwaitSocketClosed:function(){r._startDisconnectTimer()},onleavewaitSocketClosed:function(){r._cancelDisconnectTimer()},onenterwaitOffloadSocketClosed:function(){r._startDisconnectTimer()},onleavewaitOffloadSocketClosed:function(){r._cancelDisconnectTimer()},ondisconnected:function(){r._resetBackoff(),r._finalizeSocket()},onreceiveClose:function(e,t,n,i){B.default.debug("onreceiveClose: ",i),r._onCloseReceived(i)},onreceiveOffload:function(e,t,n,i){B.default.debug("onreceiveoffload: ",i),r._modifyBackoff(i.body),r._onCloseReceived(i.status)},onunsupported:function(){r._closeSocket(),r._finalizeSocket()},onerror:function(){r._closeSocket(),r._finalizeSocket()},onenterstate:function(e,t,n){r._changeState(e,t,n)}},error:function(){B.default.warn("FSM: unexpected transition",arguments)}}),r}return(0,I.default)(t,e),(0,T.default)(t,[{key:"_changeState",value:function(e,t,r){var n=this;B.default.debug("FSM: ",e,": ",t,">>",r),this.emit("stateChanged",this.state),this._isDeferredUpdate&&(this._isDeferredUpdate=!1,setTimeout(function(){n.updateToken()},0))}},{key:"_resetBackoff",value:function(){B.default.trace("_resetBackoff"),this._backoff=this._backoffDefault,this._backoff.reset()}},{key:"_modifyBackoff",value:function(e){var t=this;B.default.trace("_modifyBackoff",e);var r=e?e.backoff_policy:null;if(r){var n=r.reconnect_min_ms||2e3,i=r.reconnect_max_ms||12e4;B.default.debug("new backoff policy",n,i),this._backoff=V.default.exponential({randomisationFactor:.2,initialDelay:n,maxDelay:i}),this._backoff.on("ready",function(){t._retry()})}}},{key:"_startDisconnectTimer",value:function(){var e=this;B.default.trace("_startDisconnectTimer"),this._disconnectingTimer&&(clearTimeout(this._disconnectingTimer),this._disconnectingTimer=null),this._disconnectingTimer=setTimeout(function(){B.default.debug("disconnecting is timed out"),e._closeSocket()},3e3)}},{key:"_cancelDisconnectTimer",value:function(){B.default.trace("_cancelDisconnectTimer"),this._disconnectingTimer&&(clearTimeout(this._disconnectingTimer),this._disconnectingTimer=null)}},{key:"_processReply",value:function(e){B.default.debug("receive reply:",e);var t=this._activeRequests.get(e.id);if(t)switch(clearTimeout(t.timeout),this._activeRequests.delete(e.id),t.reqType){case"init":e.status.code>=200&&e.status.code<300?this._fsm.initSuccess(e.body):401===e.status.code||403===e.status.code?this._fsm.tokenRejected(e.status):429===e.status.code?(this._modifyBackoff(e.body),this._fsm.initError(e.status)):this._fsm.initError(e.status);break;case"update":e.status.code>=200&&e.status.code<300?this._fsm.updateSuccess(e.body):401===e.status.code||403===e.status.code?this._fsm.tokenRejected(e.status):429===e.status.code?(this._modifyBackoff(e.body),this._fsm.updateError(e.status)):this._fsm.updateError(e.status);break;default:B.default.error("unexpected reply")}}},{key:"_storeRequest",value:function(e,t,r){var n=this;B.default.trace("_storeRequest");var i={reqType:t,timeout:setTimeout(function(){B.default.debug("request",t,": ",e,"is timed out"),"init"!==t&&"update"!==t&&B.default.error("unknown request type",t),n._closeSocket()},r)};this._activeRequests.set(e,i)}},{key:"_isConnected",value:function(){return this.state===t.state.CONNECTED&&this._socket&&1===this._socket.readyState}},{key:"_getState",value:function(){if(!this._fsm)return t.state.DISCONNECTED;switch(this._fsm.current){case"connecting":case"initialising":case"retrying":case"error":return t.state.CONNECTING;case"updating":case"connected":return t.state.CONNECTED;case"rejected":return t.state.REJECTED;case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return t.state.DISCONNECTING;case"disconnected":default:return t.state.DISCONNECTED}}},{key:"_initRetry",value:function(){B.default.trace("_initRetry"),this._backoff.backoff()}},{key:"_retry",value:function(){B.default.trace("_retry"),this._socket=null,this._activeToken=null,this._fsm.userRetry()}},{key:"_onConnected",value:function(){this.emit("connected")}},{key:"_finalizeSocket",value:function(){if(B.default.trace("_finalizeSocket"),this._stopWatchdogTimer(),this._onDisconnected(),this._disconnectedPromiseResolve){var e=this._disconnectedPromiseResolve;this._disconnectedPromiseResolve=null,e()}}},{key:"_onDisconnected",value:function(){this._socket=null,this._activeToken=null,this.emit("disconnected")}},{key:"_setupSocket",value:function(){B.default.trace("_setupSocket:",this._config.token);var e=this,t=this._config.twilsockUri;B.default.debug("try to connect to:",t);var r=new Q(t);r.binaryType="arraybuffer",r.onopen=function(){B.default.info("socket opened"),e._fsm.socketConnected()},r.onclose=function(t){B.default.info("socket closed",t),e._fsm.socketClosed()},r.onerror=function(e){B.default.error("error: ",e)},r.onmessage=function(t){B.default.trace("data: ",t.data);var r=new Uint8Array(t.data),n=u(r);if("TWILSOCK"!==n.protocol||"V3.0"!==n.version)return B.default.error("unsupported protocol: "+n.protocol+" ver "+n.version),void e._fsm.unsupportedProtocol();var i=null;try{i=l(r.subarray(n.size,n.size+n.headerSize))}catch(r){return B.default.error("failed to parse message header",r,t),void e._fsm.protocolError()}B.default.trace("message received: ",i);var o=null;if(i.payload_size>0){var s=2+n.size+n.headerSize,c=i.payload_size;if(i.hasOwnProperty("payload_type")&&0!==i.payload_type.indexOf("application/json"))0===i.payload_type.indexOf("text/plain")&&(o=a(r.subarray(s,s+c)));else try{o=l(r.subarray(s,s+c))}catch(r){return B.default.error("failed to parse message body",r,t),void e._fsm.protocolError()}}e._updateActivityTimestamp(),"notification"===i.method?(e._confirmReceiving(i),e.emit("message",i.message_type,o)):"reply"===i.method?e.emit("reply",{id:i.id,status:i.status,header:i,body:o}):"ping"===i.method?e._confirmReceiving(i):"close"===i.method&&(B.default.trace("connection close initated by server"),e._confirmReceiving(i),308===i.status.code?(B.default.info("connection has been offloaded"),e._fsm.receiveOffload({status:i.status.status,body:o})):406===i.status.code?(B.default.error("connection has been rejected because server can not parse protocol"),e._fsm.receiveFatalClose()):417===i.status.code?(B.default.info("connection has been rejected because server could not understand client`s reply"),e._fsm.receiveFatalClose(i.status.status)):410===i.status.code?(B.default.info("connection has expired"),e._fsm.receiveClose(i.status.status)):401===i.status.code?(B.default.info("connection is not authenticate"),e._fsm.receiveClose(i.status.status)):(B.default.error("unexpected close: ",i.status),e._fsm.receiveOffload({status:i.status.status,body:null})))},this._activeToken=this._config.token,this._socket=r}},{key:"_sendInit",value:function(){B.default.trace("_sendInit");var e={id:z.default.v4(),method:"init",token:this._activeToken};this._sendPacket(e),this._storeRequest(e.id,"init",5e3)}},{key:"_sendUpdate",value:function(){B.default.trace("_sendUpdate");var e={id:z.default.v4(),method:"update",token:this._activeToken};this._sendPacket(e),this._storeRequest(e.id,"update",5e3)}},{key:"_cancelInit",value:function(){B.default.trace("_cancelInit");var e=!0,t=!1,r=void 0;try{for(var n,i=(0,y.default)(this._activeRequests);!(e=(n=i.next()).done);e=!0){var o=(0,v.default)(n.value,2),s=o[0],a=o[1];a&&"init"===a.reqType&&(clearTimeout(a.timeout),this._activeRequests.delete(s))}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}},{key:"_cancelUpdate",value:function(){B.default.trace("_cancelUpdate");var e=!0,t=!1,r=void 0;try{for(var n,i=(0,y.default)(this._activeRequests);!(e=(n=i.next()).done);e=!0){var o=(0,v.default)(n.value,2),s=o[0],a=o[1];a&&"update"===a.reqType&&(clearTimeout(a.timeout),this._activeRequests.delete(s))}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}},{key:"_confirmReceiving",value:function(e){B.default.trace("_confirmReceiving");var t={method:"reply",id:e.id,payload_type:"application/json",status:{code:200,status:"OK"}};try{this._sendPacket(t)}catch(e){B.default.debug("failed to confirm packet receiving",e)}}},{key:"_sendPacket",value:function(e,t){var r=c(t);e.payload_size=o(r);var n=(0,M.default)(e)+"\r\n",i="TWILSOCK V3.0 "+(o(n)-2)+"\r\n";B.default.debug("send request:",i+n+r);var a=s(i+n+r);try{this._socket.send(a.buffer)}catch(t){throw B.default.info("failed to send ",e,t),B.default.info(t.stack),t}}},{key:"_closeSocket",value:function(){B.default.trace("_closeSocket"),this._socket&&(this._socket.onopen=null,this._socket.onclose=null,this._socket.onerror=null,this._socket.onmessage=null,this._socket.close()),this._fsm.socketClosed()}},{key:"connect",value:function(){B.default.trace("connect"),this._fsm.userConnect()}},{key:"reconnect",value:function(){B.default.trace("reconnect"),this._resetBackoff(),this._fsm.userRetry()}},{key:"isRetrying",value:function(){return"retrying"===this._fsm.current}},{key:"disconnect",value:function(){var e=this;return B.default.trace("disconnect"),this._fsm.is("disconnected")?d.default.resolve():new d.default(function(t){e._disconnectedPromiseResolve=t,e._fsm.userDisconnect()})}},{key:"updateToken",value:function(){if(B.default.trace("updateToken:",this._config.token),
"initialising"===this._fsm.current||"updating"===this._fsm.current||"waitSocketClosed"===this._fsm.current||"waitOffloadSocketClosed"===this._fsm.current)return B.default.debug("defer updateToken because of",this._fsm.current,"is in progress"),void(this._isDeferredUpdate=!0);this._isDeferredUpdate=!1,this._activeToken=this._config.token,this._fsm.userUpdateToken()}},{key:"sendUpstreamMessage",value:function(e,t,r){var n=z.default.v4(),i={host:e.host,path:e.path,method:e.method};e.hasOwnProperty("params")&&(i.params=e.params);var o={method:"message",id:n,http_request:i};return t&&(o.http_request.headers=t),t&&t.hasOwnProperty("Content-Type")&&(o.payload_type=t["Content-Type"]),this._sendPacket(o,r),n}},{key:"send",value:function(e,t){return e.id=e.id||z.default.v4(),this._sendPacket(e,t),e.id}},{key:"_onCloseReceived",value:function(e){B.default.trace("_onCloseReceived"),B.default.info("connection closed by server, reason is",e),this._socket&&(this._socket.onopen=null,this._socket.onerror=null,this._socket.onmessage=null)}},{key:"_startWatchdogTimer",value:function(){var e=this;B.default.trace("_startWatchdogTimer"),this._timestamp=Date.now(),this._watchTimer=setInterval(function(){Date.now()-e._timestamp>43e3&&e._socket&&e._socket.close()},5e3)}},{key:"_stopWatchdogTimer",value:function(){B.default.trace("_stopWatchdogTimer"),clearInterval(this._watchTimer)}},{key:"_updateActivityTimestamp",value:function(){B.default.trace("_updateActivityTimestamp"),this._timestamp=Date.now()}}]),t}(N.default);r.default=K,K.state={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTING:"disconnecting",ERROR:"error",REJECTED:"rejected"},(0,h.default)(K.state),(0,h.default)(K),t.exports=r.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":230,"babel-runtime/core-js/get-iterator":25,"babel-runtime/core-js/json/stringify":27,"babel-runtime/core-js/map":28,"babel-runtime/core-js/object/define-properties":31,"babel-runtime/core-js/object/freeze":33,"babel-runtime/core-js/object/get-prototype-of":34,"babel-runtime/core-js/promise":37,"babel-runtime/helpers/classCallCheck":42,"babel-runtime/helpers/createClass":43,"babel-runtime/helpers/inherits":45,"babel-runtime/helpers/possibleConstructorReturn":46,"babel-runtime/helpers/slicedToArray":47,"babel-runtime/helpers/typeof":48,backoff:50,events:201,"javascript-state-machine":203,uuid:236,ws:62}],233:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],234:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],235:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),_(t)?n.showHidden=t:t&&r._extend(n,t),k(n.showHidden)&&(n.showHidden=!1),k(n.depth)&&(n.depth=2),k(n.colors)&&(n.colors=!1),k(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),u(n,e,n.depth)}function o(e,t){var r=i.styles[t];return r?"\x1b["+i.colors[r][0]+"m"+e+"\x1b["+i.colors[r][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function u(e,t,n){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return b(i)||(i=u(e,i,n)),i}var o=c(e,t);if(o)return o;var s=Object.keys(t),_=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),j(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(t);if(0===s.length){if(E(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(w(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(C(t))return e.stylize(Date.prototype.toString.call(t),"date");if(j(t))return l(t)}var m="",y=!1,g=["{","}"];if(d(t)&&(y=!0,g=["[","]"]),E(t)){m=" [Function"+(t.name?": "+t.name:"")+"]"}if(w(t)&&(m=" "+RegExp.prototype.toString.call(t)),C(t)&&(m=" "+Date.prototype.toUTCString.call(t)),j(t)&&(m=" "+l(t)),0===s.length&&(!y||0==t.length))return g[0]+m+g[1];if(n<0)return w(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var k;return k=y?f(e,t,n,_,s):s.map(function(r){return h(e,t,n,_,r,y)}),e.seen.pop(),p(k,m,g)}function c(e,t){if(k(t))return e.stylize("undefined","undefined");if(b(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return y(t)?e.stylize(""+t,"number"):_(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)O(t,String(s))?o.push(h(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(e,t,r,n,i,!0))}),o}function h(e,t,r,n,i,o){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),O(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=v(r)?u(e,c.value,null):u(e,c.value,r-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),k(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function d(e){return Array.isArray(e)}function _(e){return"boolean"==typeof e}function v(e){return null===e}function m(e){return null==e}function y(e){return"number"==typeof e}function b(e){return"string"==typeof e}function g(e){return"symbol"==typeof e}function k(e){return void 0===e}function w(e){return x(e)&&"[object RegExp]"===T(e)}function x(e){return"object"==typeof e&&null!==e}function C(e){return x(e)&&"[object Date]"===T(e)}function j(e){return x(e)&&("[object Error]"===T(e)||e instanceof Error)}function E(e){return"function"==typeof e}function S(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function T(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}function A(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),F[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var I=/%[sdj%]/g;r.format=function(e){if(!b(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,s=String(e).replace(I,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<o;a=n[++r])v(a)||!x(a)?s+=" "+a:s+=" "+i(a);return s},r.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(k(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return o};var P,M={};r.debuglog=function(e){if(k(P)&&(P=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!M[e])if(new RegExp("\\b"+e+"\\b","i").test(P)){var n=t.pid;M[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else M[e]=function(){};return M[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=_,r.isNull=v,r.isNullOrUndefined=m,r.isNumber=y,r.isString=b,r.isSymbol=g,r.isUndefined=k,r.isRegExp=w,r.isObject=x,r.isDate=C,r.isError=j,r.isFunction=E,r.isPrimitive=S,r.isBuffer=e("./support/isBuffer");var F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",A(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!x(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":234,_process:211,inherits:233}],236:[function(e,t,r){var n=e("./v1"),i=e("./v4"),o=i;o.v1=n,o.v4=i,t.exports=o},{"./v1":239,"./v4":240}],237:[function(e,t,r){function n(e,t){var r=t||0,n=i;return n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]}for(var i=[],o=0;o<256;++o)i[o]=(o+256).toString(16).substr(1);t.exports=n},{}],238:[function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],239:[function(e,t,r){function n(e,t,r){var n=t&&r||0,l=t||[];e=e||{};var f=e.node||i,h=void 0!==e.clockseq?e.clockseq:o;if(null==f||null==h){var p=s();null==f&&(f=i=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=o=16383&(p[6]<<8|p[7]))}var d=void 0!==e.msecs?e.msecs:(new Date).getTime(),_=void 0!==e.nsecs?e.nsecs:c+1,v=d-u+(_-c)/1e4;if(v<0&&void 0===e.clockseq&&(h=h+1&16383),(v<0||d>u)&&void 0===e.nsecs&&(_=0),_>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=d,c=_,o=h,d+=122192928e5;var m=(1e4*(268435455&d)+_)%4294967296;l[n++]=m>>>24&255,l[n++]=m>>>16&255,l[n++]=m>>>8&255,l[n++]=255&m;var y=d/4294967296*1e4&268435455;l[n++]=y>>>8&255,l[n++]=255&y,l[n++]=y>>>24&15|16,l[n++]=y>>>16&255,l[n++]=h>>>8|128,l[n++]=255&h;for(var b=0;b<6;++b)l[n+b]=f[b];return t||a(l)}var i,o,s=e("./lib/rng"),a=e("./lib/bytesToUuid"),u=0,c=0;t.exports=n},{"./lib/bytesToUuid":237,"./lib/rng":238}],240:[function(e,t,r){function n(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[n+a]=s[a];return t||o(s)}var i=e("./lib/rng"),o=e("./lib/bytesToUuid");t.exports=n},{"./lib/bytesToUuid":237,"./lib/rng":238}],241:[function(e,t,r){t.exports={h32:e("./xxhash"),h64:e("./xxhash64")}},{"./xxhash":242,"./xxhash64":243}],242:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||i>=57344?t.push(224|i>>12,128|i>>6&63,128|63&i):(r++,i=65536+((1023&i)<<10|1023&e.charCodeAt(r)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return new Uint8Array(t)}function i(){return 2==arguments.length?new i(arguments[1]).update(arguments[0]).digest():this instanceof i?void o.call(this,arguments[0]):new i(arguments[0])}function o(e){return this.seed=e instanceof s?e.clone():s(e),this.v1=this.seed.clone().add(a).add(u),this.v2=this.seed.clone().add(u),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(a),this.total_len=0,this.memsize=0,this.memory=null,this}/**
xxHash implementation in pure Javascript

Copyright (C) 2013, Pierre Curto
MIT license
*/
var s=e("cuint").UINT32;s.prototype.xxh_update=function(e,t){var r,n,i=u._low,o=u._high;n=e*i,r=n>>>16,r+=t*i,r&=65535,r+=e*o;var s=this._low+(65535&n),c=s>>>16;c+=this._high+(65535&r);var l=c<<16|65535&s;l=l<<13|l>>>19,s=65535&l,c=l>>>16,i=a._low,o=a._high,n=s*i,r=n>>>16,r+=c*i,r&=65535,r+=s*o,this._low=65535&n,this._high=65535&r};var a=s("2654435761"),u=s("2246822519"),c=s("3266489917"),l=s("668265263"),f=s("374761393");i.prototype.init=o,i.prototype.update=function(e){var t,i="string"==typeof e;i&&(e=n(e),i=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var o=0,s=e.length,a=o+s;if(0==s)return this;if(this.total_len+=s,0==this.memsize&&(this.memory=i?"":t?new Uint8Array(16):new r(16)),this.memsize+s<16)return i?this.memory+=e:t?this.memory.set(e.subarray(0,s),this.memsize):e.copy(this.memory,this.memsize,0,s),this.memsize+=s,this;if(this.memsize>0){i?this.memory+=e.slice(0,16-this.memsize):t?this.memory.set(e.subarray(0,16-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,16-this.memsize);var u=0;i?(this.v1.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v2.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v3.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v4.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2))):(this.v1.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v2.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v3.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v4.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2])),o+=16-this.memsize,this.memsize=0,i&&(this.memory="")}if(o<=a-16){var c=a-16;do{i?(this.v1.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2)),o+=4,this.v2.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2)),o+=4,this.v3.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2)),o+=4,this.v4.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2))):(this.v1.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2]),o+=4,this.v2.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2]),o+=4,this.v3.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2]),o+=4,this.v4.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2])),o+=4}while(o<=c)}return o<a&&(i?this.memory+=e.slice(o):t?this.memory.set(e.subarray(o,a),this.memsize):e.copy(this.memory,this.memsize,o,a),this.memsize=a-o),this},i.prototype.digest=function(){var e,t,r=this.memory,n="string"==typeof r,i=0,o=this.memsize,h=new s;for(e=this.total_len>=16?this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):this.seed.clone().add(f),e.add(h.fromNumber(this.total_len));i<=o-4;)n?h.fromBits(r.charCodeAt(i+1)<<8|r.charCodeAt(i),r.charCodeAt(i+3)<<8|r.charCodeAt(i+2)):h.fromBits(r[i+1]<<8|r[i],r[i+3]<<8|r[i+2]),e.add(h.multiply(c)).rotl(17).multiply(l),i+=4;for(;i<o;)h.fromBits(n?r.charCodeAt(i++):r[i++],0),e.add(h.multiply(f)).rotl(11).multiply(a);return t=e.clone().shiftRight(15),e.xor(t).multiply(u),t=e.clone().shiftRight(13),e.xor(t).multiply(c),t=e.clone().shiftRight(16),e.xor(t),this.init(this.seed),e},t.exports=i}).call(this,e("buffer").Buffer)},{buffer:63,cuint:198}],243:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||i>=57344?t.push(224|i>>12,128|i>>6&63,128|63&i):(r++,i=65536+((1023&i)<<10|1023&e.charCodeAt(r)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return new Uint8Array(t)}function i(){return 2==arguments.length?new i(arguments[1]).update(arguments[0]).digest():this instanceof i?void o.call(this,arguments[0]):new i(arguments[0])}function o(e){return this.seed=e instanceof s?e.clone():s(e),this.v1=this.seed.clone().add(a).add(u),this.v2=this.seed.clone().add(u),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(a),this.total_len=0,this.memsize=0,this.memory=null,this}/**
xxHash64 implementation in pure Javascript

Copyright (C) 2016, Pierre Curto
MIT license
*/
var s=e("cuint").UINT64,a=s("11400714785074694791"),u=s("14029467366897019727"),c=s("1609587929392839161"),l=s("9650029242287828579"),f=s("2870177450012600261");i.prototype.init=o,i.prototype.update=function(e){var t,i="string"==typeof e;i&&(e=n(e),i=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var o=0,c=e.length,l=o+c;if(0==c)return this;if(this.total_len+=c,0==this.memsize&&(this.memory=i?"":t?new Uint8Array(32):new r(32)),this.memsize+c<32)return i?this.memory+=e:t?this.memory.set(e.subarray(0,c),this.memsize):e.copy(this.memory,this.memsize,0,c),this.memsize+=c,this;if(this.memsize>0){i?this.memory+=e.slice(0,32-this.memsize):t?this.memory.set(e.subarray(0,32-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,32-this.memsize);var f=0;if(i){var h;h=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v1.add(h.multiply(u)).rotl(31).multiply(a),f+=8,h=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v2.add(h.multiply(u)).rotl(31).multiply(a),f+=8,h=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v3.add(h.multiply(u)).rotl(31).multiply(a),f+=8,h=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v4.add(h.multiply(u)).rotl(31).multiply(a)}else{var h;h=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v1.add(h.multiply(u)).rotl(31).multiply(a),f+=8,h=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v2.add(h.multiply(u)).rotl(31).multiply(a),f+=8,h=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v3.add(h.multiply(u)).rotl(31).multiply(a),f+=8,h=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v4.add(h.multiply(u)).rotl(31).multiply(a)}o+=32-this.memsize,this.memsize=0,i&&(this.memory="")}if(o<=l-32){var p=l-32;do{if(i){var h;h=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v1.add(h.multiply(u)).rotl(31).multiply(a),o+=8,h=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v2.add(h.multiply(u)).rotl(31).multiply(a),o+=8,h=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v3.add(h.multiply(u)).rotl(31).multiply(a),o+=8,h=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v4.add(h.multiply(u)).rotl(31).multiply(a)}else{var h;h=s(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v1.add(h.multiply(u)).rotl(31).multiply(a),o+=8,h=s(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v2.add(h.multiply(u)).rotl(31).multiply(a),o+=8,h=s(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v3.add(h.multiply(u)).rotl(31).multiply(a),o+=8,h=s(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v4.add(h.multiply(u)).rotl(31).multiply(a)}o+=8}while(o<=p)}return o<l&&(i?this.memory+=e.slice(o):t?this.memory.set(e.subarray(o,l),this.memsize):e.copy(this.memory,this.memsize,o,l),this.memsize=l-o),this},i.prototype.digest=function(){var e,t,r=this.memory,n="string"==typeof r,i=0,o=this.memsize,h=new s;for(this.total_len>=32?(e=this.v1.clone().rotl(1),e.add(this.v2.clone().rotl(7)),e.add(this.v3.clone().rotl(12)),e.add(this.v4.clone().rotl(18)),e.xor(this.v1.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l),e.xor(this.v2.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l),e.xor(this.v3.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l),e.xor(this.v4.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l)):e=this.seed.clone().add(f),e.add(h.fromNumber(this.total_len));i<=o-8;)n?h.fromBits(r.charCodeAt(i+1)<<8|r.charCodeAt(i),r.charCodeAt(i+3)<<8|r.charCodeAt(i+2),r.charCodeAt(i+5)<<8|r.charCodeAt(i+4),r.charCodeAt(i+7)<<8|r.charCodeAt(i+6)):h.fromBits(r[i+1]<<8|r[i],r[i+3]<<8|r[i+2],r[i+5]<<8|r[i+4],r[i+7]<<8|r[i+6]),h.multiply(u).rotl(31).multiply(a),e.xor(h).rotl(27).multiply(a).add(l),i+=8;for(i+4<=o&&(n?h.fromBits(r.charCodeAt(i+1)<<8|r.charCodeAt(i),r.charCodeAt(i+3)<<8|r.charCodeAt(i+2),0,0):h.fromBits(r[i+1]<<8|r[i],r[i+3]<<8|r[i+2],0,0),e.xor(h.multiply(a)).rotl(23).multiply(u).add(c),i+=4);i<o;)h.fromBits(n?r.charCodeAt(i++):r[i++],0,0,0),e.xor(h.multiply(f)).rotl(11).multiply(a);return t=e.clone().shiftRight(33),e.xor(t).multiply(u),t=e.clone().shiftRight(29),e.xor(t).multiply(c),t=e.clone().shiftRight(32),e.xor(t),this.init(this.seed),e},t.exports=i}).call(this,e("buffer").Buffer)},{buffer:63,cuint:198}],244:[function(e,t,r){t.exports={name:"twilio-sync",version:"0.7.5",description:"Twilio Sync client library",main:"lib/index.js",browser:"browser/index.js",scripts:{test:"gulp unit-test",prepare:"gulp build"},author:"Twilio",license:"MIT",dependencies:{"babel-runtime":"^6.23.0",karibu:"^1.0.1",loglevel:"^1.4.1","operation-retrier":"^1.1.2",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.2.6","twilio-notifications":"^0.4.4","twilio-transport":"^0.1.4",twilsock:"^0.3.5",uuid:"^3.0.1",xxhashjs:"^0.2.1"},devDependencies:{"@types/chai":"^3.4.35","@types/chai-as-promised":"0.0.29","@types/loglevel":"^1.4.29","@types/mocha":"^2.2.39","@types/node":"^7.0.5","@types/sinon":"^2.3.3","@types/sinon-chai":"^2.7.27","async-test-tools":"^1.0.6","babel-cli":"^6.23.0","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-array-includes":"^2.0.3","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.22.0",babelify:"^7.3.0",backoff:"^2.5.0",browserify:"^14.1.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^4.0.1","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-tslint":"^7.1.0","gulp-typescript":"^3.1.5","gulp-uglify":"^2.0.1","gulp-util":"^3.0.8","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3",jsonwebtoken:"^7.3.0",karma:"^1.5.0","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","run-sequence":"^1.2.2",sinon:"^2.3.3","sinon-chai":"^2.8.0","ts-node":"^3.0.0",tslint:"^4.5.1",twilio:"^3.10.0",typescript:"2.2.1",underscore:"^1.8.3","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},engines:{node:">=6"}}},{}]},{},[2])(2)});